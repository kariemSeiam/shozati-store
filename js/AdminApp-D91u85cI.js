import{r as e,j as a,a as t,a8 as r,P as l,w as s,a9 as n,aa as i,ab as o,ac as c,ad as d,ae as u,n as m,m as g,a1 as h,af as b,X as p,ag as x,q as y,ah as v,l as f,V as N,ai as w,aj as C,ak as k,J as S,al as P,am as E,an as j,a3 as $,ao as D,F as U,ap as L,E as F,$ as O,aq as z,ar as I,y as R,g as T,z as A,_ as G,as as B,at as q,au as _,av as M,aw as V,ax as J,a0 as K,M as W,ay as Q,az as X,aA as Y,aB as H,a2 as Z,aC as ee,aD as ae,aE as te,L as re,aF as le,aG as se}from"./vendor-react-Icp8Mr4y.js";const ne="https://shozati.pythonanywhere.com/api",ie=()=>{const[a,t]=e.useState(localStorage.getItem("adminToken")),[r,l]=e.useState(!1),[s,n]=e.useState(!1),[i,o]=e.useState(!1),[c,d]=e.useState(null),[u,m]=e.useState(null);e.useRef(null);const g=async()=>{o(!0),m(null);try{const e=await fetch(`${ne}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:"0000000000"})});if(!e.ok)throw new Error("Authentication failed");const a=await e.json();return t(a.token),localStorage.setItem("adminToken",a.token),a}catch(e){throw m(e.message),e}finally{o(!1)}},h=e.useCallback(()=>{localStorage.removeItem("adminToken"),t(null),l(!1)},[]);e.useEffect(()=>{(async()=>{if(!a&&!r)try{await g()}catch(e){}l(!0)})()},[a,r]);const b=e.useCallback(async(e,t={})=>{const r=async a=>{let r={Authorization:`Bearer ${a}`,...t.headers};t.body instanceof FormData||(r["Content-Type"]="application/json");const l=await fetch(`${ne}${e}`,{...t,headers:r}),s=l.headers.get("content-type");return s&&s.includes("application/json")?await l.json():await l.text()};try{return await r(a)}catch(l){if("AbortError"===l.name)return null;if(l.message.includes("Token"))try{const e=await g();return await r(e.token)}catch(s){throw new Error("Re-authentication failed")}throw l}},[a]);return{token:a,isInitialized:r,loading:s,isAuthenticating:i,error:c,authError:u,setLoading:n,setError:d,login:g,logout:h,apiCall:b}},oe=(a={})=>{const[t,r]=e.useState([]),[l,s]=e.useState(null),[n,i]=e.useState(0),[o,c]=e.useState(0),[d,u]=e.useState({}),[m,g]=e.useState(1),[h]=e.useState(a.perPage||150),[b,p]=e.useState({category:"all",search:"",minPrice:null,maxPrice:null,size:"",color:"",code:a.initialFilters?.code||"",sort:""}),[x,y]=e.useState({isLoading:!1,isCreating:!1,isUpdating:!1,isDeleting:!1,isUploadingImages:!1}),[v,f]=e.useState({fetchError:null,createError:null,updateError:null,deleteError:null,uploadError:null}),{apiCall:N}=ie(),w=e.useRef(null),C=e.useRef(new Map);e.useRef([]);const k=e.useCallback((e,a)=>{y(t=>({...t,[e]:a}))},[]),S=e.useCallback((e,a)=>{f(t=>({...t,[e]:a}))},[]),P=e.useCallback(()=>{C.current.clear()},[]),E=e.useCallback(async(e=m,a=b)=>{w.current&&w.current.abort(),w.current=new AbortController,k("isLoading",!0),S("fetchError",null);const t=JSON.stringify({page:e,...a});try{if(C.current.has(t)){const e=C.current.get(t);return r(e.products),i(e.total),c(e.pages),e}const l=new URLSearchParams({page:e,perPage:h,..."all"!==a.category&&{category:a.category},...a.search&&{search:a.search},...a.minPrice&&{minPrice:a.minPrice},...a.maxPrice&&{maxPrice:a.maxPrice},...a.size&&{size:a.size},...a.color&&{color:a.color},...a.code&&{code:a.code},sort:a.sort}),n=await N(`/admin/products?${l}`,{signal:w.current.signal});if(n)return r(n.products),i(n.total),c(n.pages),C.current.set(t,n),n;a.code&&1===n.products.length&&s(n.products[0])}catch(l){if("AbortError"===l.name)return;return S("fetchError",l.message),null}finally{k("isLoading",!1)}},[N,b,m,h,S,k]),j=e.useCallback(async(e,a,t,r)=>{k("isUploadingImages",!0),S("uploadError",null);try{const l=[];for(let s=0;s<t.length;s++){const n=new FormData;n.append("productCode",e),n.append("colorName",a),n.append("image",t[s]);const i=await N("/admin/products/upload-images",{method:"POST",body:n,headers:{},onUploadProgress:e=>{const a=e.loaded/e.total*100;r?.(s/t.length*100+a/t.length)}});i?.imageUrls?.[0]&&l.push(i.imageUrls[0])}return l}catch(l){return S("uploadError",l.message),[]}finally{k("isUploadingImages",!1)}},[N,S,k]),$=e.useCallback(async(e,a)=>{k("isCreating",!0),S("createError",null);try{const t=await N("/admin/products",{method:"POST",body:JSON.stringify({...e,variants:e.variants.map(e=>({...e,images:[]}))})});if(!t)throw new Error("Failed to create product");const r=await Promise.all(e.variants.map(async(e,r)=>{if(!a[r]?.length)return e;const l=await j(t.code,e.colorName,a[r],e=>{u(a=>({...a,[`${r}`]:e}))});return{...e,images:l}})),l=await N(`/admin/products/${t.id}`,{method:"PUT",body:JSON.stringify({...e,variants:r})});return C.current.clear(),await E(),l}catch(t){return S("createError",t.message),null}finally{k("isCreating",!1),u({})}},[N,E,S,k,j]),D=e.useCallback(async(e,a,t)=>{k("isUpdating",!0),S("updateError",null);try{const r=await Promise.all(a.variants.map(async(e,r)=>{if(!t[r]?.length)return e;const l=await j(a.code,e.colorName,t[r],e=>{u(a=>({...a,[`${r}`]:e}))});return{...e,images:[...e.images,...l]}})),l=await N(`/admin/products/${e}`,{method:"PUT",body:JSON.stringify({...a,variants:r})});return l&&(C.current.clear(),await E()),l}catch(r){return S("updateError",r.message),null}finally{k("isUpdating",!1),u({})}},[N,E,S,k,j]),U=e.useCallback(async e=>{k("isDeleting",!0),S("deleteError",null);try{const a=await N(`/admin/products/${e}`,{method:"DELETE"});return a&&(P(),await E()),a}catch(a){return S("deleteError",a.message),null}finally{k("isDeleting",!1)}},[N,P,E,S,k]),L=e.useCallback(async(e,a)=>{k("isUpdating",!0),S("updateError",null);try{const t=await N(`/admin/products/${e}/inventory`,{method:"PUT",body:JSON.stringify(a)});return t&&(P(),await E()),t}catch(t){return S("updateError",t.message),null}finally{k("isUpdating",!1)}},[N,P,E,S,k]),F=e.useCallback(e=>{p(a=>{const t={...a,...e};return JSON.stringify(a)!==JSON.stringify(t)&&g(1),t})},[]),O=e.useCallback(()=>{m<o&&g(e=>e+1)},[m,o]),z=e.useCallback(()=>{m>1&&g(e=>e-1)},[m]);return e.useEffect(()=>(E(),()=>{w.current&&w.current.abort()}),[E,m,b]),e.useEffect(()=>()=>{P(),w.current&&w.current.abort()},[P]),{products:t,selectedProduct:l,totalProducts:n,totalPages:o,page:m,perPage:h,filters:b,...x,...v,setSelectedProduct:s,setPage:g,updateFilters:F,fetchProducts:E,createProduct:$,updateProduct:D,deleteProduct:U,updateInventory:L,uploadProgress:d,uploadProductImages:j,nextPage:O,previousPage:z,clearCache:P}},ce=()=>{const{analytics:m,isLoading:g,error:h,refreshAnalytics:b}=(()=>{const[a,t]=e.useState({totalSales:0,orderCount:0,topProducts:[],revenueChart:[]}),[r,l]=e.useState("week"),[s,n]=e.useState({startDate:null,endDate:null}),[i,o]=e.useState(!1),[c,d]=e.useState(!1),[u,m]=e.useState(null),{apiCall:g}=ie(),h=e.useRef(null),b=e.useRef(!0),p=e.useCallback(async(e=r)=>{o(!0),m(null);try{const a=new URLSearchParams({period:e,...s.startDate&&{startDate:s.startDate.toISOString()},...s.endDate&&{endDate:s.endDate.toISOString()}}).toString(),r=await g(`/admin/analytics/dashboard?${a}`);return r&&t(r),r}catch(a){return m(a.message),null}finally{o(!1)}},[g,r,s]),x=e.useCallback(async()=>{if(!c){d(!0);try{await p()}finally{d(!1)}}},[p,c]),y=e.useCallback(e=>{b.current=e,!e&&h.current?(clearInterval(h.current),h.current=null):e&&!h.current&&(h.current=setInterval(x,3e5))},[x]),v=e.useCallback((e,a=null)=>{l(e),a&&n(a)},[]);return e.useEffect(()=>(b.current&&(h.current=setInterval(x,3e5)),p(),()=>{h.current&&clearInterval(h.current)}),[p,x]),e.useEffect(()=>{h.current&&clearInterval(h.current),b.current&&(h.current=setInterval(x,3e5))},[r,x]),{analytics:a,period:r,customDateRange:s,isLoading:i,isRefreshing:c,error:u,loadAnalytics:p,refreshAnalytics:x,toggleAutoRefresh:y,updatePeriod:v,setCustomDateRange:n}})(),p=e.useMemo(()=>{if(!m)return null;const e=(e,a)=>0===a?0:(e-a)/a*100;return{revenue:{current:m.totalSales,growth:e(m.revenueChart?.[m.revenueChart.length-1]?.revenue||0,m.revenueChart?.[m.revenueChart.length-2]?.revenue||0),color:"emerald"},orders:{current:m.orderCount,growth:e(m.orderCount,m.previousOrderCount||0),color:"blue"},avgOrderValue:{current:m.totalSales/m.orderCount,growth:e(m.totalSales/m.orderCount,m.previousAvgOrderValue||0),color:"amber"},customerRetention:{current:m.retention?.rate||0,growth:e(m.retention?.rate||0,m.retention?.previousRate||0),color:"purple"}}},[m]),x=e.useMemo(()=>{if(!m?.ordersByStatus)return[];const e={pending:"#FCD34D",processing:"#60A5FA",delivered:"#34D399",cancelled:"#F87171"};return Object.entries(m.ordersByStatus).map(([a,t])=>({status:a,count:t,color:e[a]}))},[m?.ordersByStatus]);return a("div",{className:"min-h-screen bg-gray-900 px-4 space-y-6",dir:"rtl",children:g?a(he,{}):h?a(be,{error:h,onRetry:b}):t("div",{className:"space-y-8",children:[t("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[a(de,{title:"إجمالي المبيعات",value:`${p.revenue.current?.toLocaleString("ar-EG")} ج.م`,icon:r,color:p.revenue.color}),a(de,{title:"عدد الطلبات",value:p.orders.current,icon:l,color:p.orders.color}),a(de,{title:"متوسط قيمة الطلب",value:`${p.avgOrderValue.current?.toLocaleString("ar-EG")} ج.م`,icon:s,color:p.avgOrderValue.color}),a(de,{title:"معدل الاحتفاظ بالعملاء",value:`${p.customerRetention.current?.toFixed(1)}%`,icon:n,color:p.customerRetention.color})]}),a(me,{products:m.topProducts}),a("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:a(ue,{title:"توزيع حالات الطلبات",chart:a("div",{className:"flex items-center justify-center h-[300px] bg-gray-800/30 rounded-xl",children:a(i,{width:"100%",height:"100%",children:t(o,{children:[a(c,{data:x,dataKey:"count",nameKey:"status",cx:"50%",cy:"50%",outerRadius:100,innerRadius:60,paddingAngle:5,children:x.map((e,t)=>a(d,{fill:e.color},t))}),a(u,{content:a(ge,{})})]})})}),footer:a("div",{className:"grid grid-cols-2 gap-4 mt-4",children:x.map(({status:e,count:r,color:l})=>t("div",{className:"flex items-center gap-2",children:[a("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l}}),a("span",{className:"text-sm text-gray-400",children:pe(e)}),a("span",{className:"text-sm font-bold text-white",children:r})]},e))})})})]})})},de=({title:e,value:r,trend:l,icon:s,color:n})=>{const i={emerald:{bg:"bg-emerald-500/10",text:"text-emerald-400",border:"border-emerald-500/20",iconBg:"bg-emerald-500/20"},blue:{bg:"bg-blue-500/10",text:"text-blue-400",border:"border-blue-500/20",iconBg:"bg-blue-500/20"},amber:{bg:"bg-amber-500/10",text:"text-amber-400",border:"border-amber-500/20",iconBg:"bg-amber-500/20"},purple:{bg:"bg-purple-500/10",text:"text-purple-400",border:"border-purple-500/20",iconBg:"bg-purple-500/20"}}[n],o=l>=0?h:b;return t("div",{className:`relative overflow-hidden rounded-2xl border p-6 bg-gray-800/50 backdrop-blur-xl hover:bg-gray-800/70 transition-all duration-300 hover:shadow-xl hover:shadow-black/20 ${i.border}`,dir:"rtl",children:[a("div",{className:"absolute top-4 left-4",children:a("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${i.iconBg}`,children:a(s,{className:`w-6 h-6 ${i.text}`})})}),t("div",{className:"mt-8",children:[a("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:e}),a("div",{className:"mt-2 flex items-baseline gap-2",children:a("span",{className:`text-3xl font-bold ${i.text}`,children:r})}),void 0!==l&&t("div",{className:"mt-3 flex items-center gap-2 px-3 py-1 rounded-full "+(l>=0?"bg-emerald-500/10 border border-emerald-500/20":"bg-red-500/10 border border-red-500/20"),children:[a(o,{className:"w-4 h-4"}),t("span",{className:"text-sm font-medium",children:[Math.abs(l).toFixed(1),"%"]})]})]})]})},ue=({title:e,chart:r,footer:l})=>t("div",{className:"bg-gray-800/50 backdrop-blur-xl rounded-2xl p-6 border border-gray-700/50 hover:border-gray-600/50 transition-all duration-300 hover:shadow-xl hover:shadow-black/20",children:[t("h3",{className:"text-xl font-bold text-white mb-6 flex items-center gap-3",children:[a("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e]}),r,l]}),me=({products:e})=>t("div",{className:"bg-gray-800/50 backdrop-blur-xl rounded-2xl p-6 border border-gray-700/50 hover:border-gray-600/50 transition-all duration-300 hover:shadow-xl hover:shadow-black/20",children:[t("h3",{className:"text-xl font-bold text-white mb-6 flex items-center gap-3",children:[a("div",{className:"w-2 h-2 rounded-full bg-emerald-400"}),"أفضل المنتجات مبيعاً"]}),a("div",{className:"space-y-4",children:e?.map((e,r)=>t("div",{className:"flex items-center gap-4 p-4 bg-gray-800/30 rounded-xl hover:bg-gray-700/50 transition-all duration-300 border border-gray-700/30 hover:border-gray-600/50",children:[a("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center",children:t("span",{className:"text-lg font-bold text-white",children:["#",r+1]})}),t("div",{className:"flex-1 min-w-0",children:[a("h4",{className:"font-bold text-white truncate mb-1",children:e.name}),t("div",{className:"flex justify-between items-center",children:[t("div",{className:"flex items-center gap-2",children:[a(l,{className:"w-4 h-4 text-gray-400"}),t("span",{className:"text-sm text-gray-400",children:[e.quantity," قطعة"]})]}),t("span",{className:"text-blue-400 font-bold",children:[e.revenue.toLocaleString("ar-EG")," جنيه"]})]})]})]},e.id))})]}),ge=({active:e,payload:r,label:l})=>e&&r?.length?t("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-3",children:[l&&a("p",{className:"text-gray-400 mb-2",children:l}),r.map((e,a)=>t("p",{className:"text-white",children:["number"==typeof e.value?e.value.toLocaleString("ar-EG"):e.value,"revenue"===e.name?" جنيه":""]},a))]}):null,he=()=>a("div",{className:"flex items-center justify-center py-12",children:t("div",{className:"text-center space-y-4 p-6 rounded-2xl bg-gray-800/50 backdrop-blur-xl border border-gray-700/50",children:[t("div",{className:"relative",children:[a(m,{className:"w-12 h-12 text-blue-400 animate-spin mx-auto"}),a("div",{className:"absolute inset-0 rounded-full bg-blue-500/20 animate-ping"})]}),a("p",{className:"text-gray-300 font-medium",children:"جاري تحميل البيانات..."})]})}),be=({error:e,onRetry:r})=>a("div",{className:"text-center py-12",children:t("div",{className:"inline-block p-6 rounded-2xl bg-gray-800/50 backdrop-blur-xl border border-gray-700/50 max-w-md",children:[t("div",{className:"relative mb-4",children:[a(g,{className:"w-16 h-16 text-red-400 mx-auto"}),a("div",{className:"absolute inset-0 rounded-full bg-red-500/20 animate-pulse"})]}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"عذراً، حدث خطأ ما"}),a("p",{className:"text-gray-400 mb-6 leading-relaxed",children:e}),a("button",{onClick:r,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl",children:"إعادة المحاولة"})]})}),pe=e=>{switch(e){case"pending":return"معلق";case"processing":return"قيد التنفيذ";case"delivered":return"تم التسليم";case"cancelled":return"ملغي";default:return"غير معروف"}},xe=({variant:e,variantIndex:r,onImageUpload:l,onImageRemove:s,isUploading:n,uploadProgress:i,error:o})=>{const c=i[r]||0;return t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-between items-center",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"الصور"}),n&&c>0&&t("span",{className:"text-sm text-blue-500",children:[Math.round(c),"% تم الرفع"]})]}),t("div",{className:"flex gap-4 overflow-x-auto hide-scrollbar pb-2",children:[e.images.map((l,n)=>t("div",{className:"relative flex-shrink-0 w-24 h-24 rounded-xl overflow-hidden group",children:[a("img",{src:l,alt:`${e.colorName} - ${n+1}`,className:"w-full h-full object-cover transition-transform \r group-hover:scale-105"}),a("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 \r to-transparent opacity-0 group-hover:opacity-100 \r transition-opacity"}),a("button",{type:"button",onClick:()=>s(r,n),className:"absolute top-1 right-1 p-1.5 bg-black/50 rounded-lg\r opacity-0 group-hover:opacity-100 transition-opacity\r hover:bg-red-500/20",children:a(p,{className:"w-4 h-4 text-white group-hover:text-red-500"})})]},n)),t("label",{className:"relative flex-shrink-0 w-24 h-24 flex items-center \n                    justify-center rounded-xl cursor-pointer group \n                    transition-all duration-300 border-2 border-dashed\n                    "+(n?"bg-blue-500/10 border-blue-500/30":"bg-gray-800/50 border-gray-700 hover:border-blue-500"),children:[a("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:async e=>{const a=Array.from(e.target.files);if(a?.length){try{await l(r,a)}catch(t){}e.target.value=""}},disabled:n}),n&&c>0?a("div",{className:"absolute inset-0 flex items-center justify-center",children:a("svg",{className:"w-12 h-12",viewBox:"0 0 36 36",children:a("path",{d:"M18 2.0845\r a 15.9155 15.9155 0 0 1 0 31.831\r a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeDasharray:`${c}, 100`,className:"text-blue-500"})})}):a(x,{className:"w-6 h-6 transition-colors duration-300\n                      "+(n?"text-blue-500 animate-pulse":"text-gray-400 group-hover:text-blue-500")})]})]}),o&&t("div",{className:"flex items-center gap-2 text-sm text-red-500",children:[a(g,{className:"w-4 h-4"}),a("p",{children:o})]})]})},ye=[{label:"أسود",value:"black",code:"#000000"},{label:"أبيض",value:"white",code:"#FFFFFF"},{label:"أحمر",value:"red",code:"#FF0000"},{label:"أخضر",value:"green",code:"#008000"},{label:"أزرق",value:"blue",code:"#0000FF"},{label:"أصفر",value:"yellow",code:"#FFFF00"},{label:"برتقالي",value:"orange",code:"#FFA500"},{label:"بنفسجي",value:"purple",code:"#800080"},{label:"وردي",value:"pink",code:"#FFC0CB"},{label:"رمادي",value:"gray",code:"#808080"},{label:"بني",value:"brown",code:"#A52A2A"},{label:"ذهبي",value:"gold",code:"#FFD700"},{label:"فضي",value:"silver",code:"#C0C0C0"}],ve=()=>{const{products:r,filters:l,isLoading:s,isDeleting:n,error:i,deleteError:o,fetchProducts:c,createProduct:d,updateProduct:u,deleteProduct:m,uploadProductImages:g,updateFilters:h}=oe(),[b,x]=e.useState("list"),[S,P]=e.useState(null),[E,j]=e.useState(!1),[$,D]=e.useState(!1),[U,L]=e.useState(!1),F=y.useMemo(()=>r?.length?r.reduce((e,a)=>(e.total++,"active"===a.status&&e.active++,a.variants.some(e=>e.sizes.every(e=>!e.inStock))&&e.outOfStock++,e.revenue+=a.salesCount*a.basePrice,e),{total:0,active:0,outOfStock:0,revenue:0}):{total:0,active:0,outOfStock:0,revenue:0},[r]),O=e=>{h({search:e})};return t("div",{className:"min-h-screen bg-gray-900 pb-20",dir:"rtl",children:[t("div",{className:"p-6 grid grid-cols-2 gap-6",children:[a(Se,{title:"إجمالي المنتجات",value:F.total,icon:v,color:"blue"}),a(Se,{title:"منتجات نشطة",value:F.active,icon:f,color:"emerald"})]}),t("div",{className:"sticky top-0 z-30 bg-gray-900/95 backdrop-blur-xl p-6 space-y-6 border-b border-gray-800/50 shadow-2xl shadow-black/20",children:[t("div",{className:"flex items-center justify-between gap-4",children:[t("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white  rounded-xl font-medium hover:bg-blue-600 transition-colors",children:[a(N,{className:"w-5 h-5"}),a("span",{children:"إضافة منتج"})]}),t("div",{className:"flex items-center gap-2",children:[a("button",{onClick:()=>x("grid"),className:"p-2 rounded-xl transition-colors\n                       "+("grid"===b?"bg-blue-500 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:a(w,{className:"w-5 h-5"})}),a("button",{onClick:()=>x("list"),className:"p-2 rounded-xl transition-colors\n                       "+("list"===b?"bg-blue-500 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:a(C,{className:"w-5 h-5"})})]})]}),a("div",{className:"flex gap-4",children:t("div",{className:"flex-1 relative",children:[a("input",{type:"text",value:l.search,onChange:e=>O(e.target.value),placeholder:"ابحث عن منتج...",className:"w-full h-12 bg-gray-800 rounded-xl px-12 text-white border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 text-right",dir:"rtl"}),a(k,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),l.search&&a("button",{onClick:()=>O(""),className:"absolute right-4 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-gray-700 transition-colors",children:a(p,{className:"w-4 h-4 text-gray-400"})})]})}),a("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar py-2",children:Ue.map(e=>t("button",{onClick:()=>(e=>{h({category:e})})(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm\n                       whitespace-nowrap transition-colors\n                       "+(l.category===e.id?"bg-blue-500 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"),children:[a(e.icon,{className:"w-4 h-4"}),a("span",{children:e.label})]},e.id))})]}),a("div",{className:"p-4 "+("grid"===b?"grid grid-cols-2 gap-4":"space-y-4"),children:s?a(je,{}):i?a($e,{message:i}):0===r.length?a(De,{}):r.map(e=>a("grid"===b?Pe:Ne,{product:e,onEdit:()=>{P(e),D(!0)},onDelete:()=>{P(e),L(!0)}},e.id))}),E&&a(fe,{onClose:()=>j(!1),onSubmit:async(e,a)=>{try{await d(e,a)&&(j(!1),await c())}catch(t){}},uploadImages:g,ediState:$}),$&&S&&a(fe,{product:S,onClose:()=>{D(!1),P(null)},onSubmit:(e,a)=>(async(e,a,t)=>{try{await u(e,a,t)&&(D(!1),P(null),await c())}catch(r){}})(S.id,e,a),uploadImages:g,editeState:$}),U&&S&&a(Ee,{product:S,onClose:()=>{L(!1),P(null)},onConfirm:()=>(async e=>{await m(e)&&(L(!1),P(null),await c())})(S.id),isDeleting:n,error:o})]})},fe=({product:r,onClose:l,onSubmit:s,uploadImages:n,ediState:i=!0})=>{const[o,c]=e.useState({id:"",name:"",code:"",category:"",description:"",basePrice:"",discountPrice:"",status:"active",features:[],tag:"",tagColor:"",variants:[{id:"",product_id:"",colorName:"",colorCode:"#000000",images:[],sizes:[{size:"",quantity:0}]}],_imageFiles:{}}),[d,u]=e.useState({}),[m,h]=e.useState(!1),{handleFormImageUpload:b,clearImageFiles:x,uploadErrors:y,isUploading:v,uploadProgress:w}=(a=>{const[t,r]=e.useState({}),[l,s]=e.useState(!1),[n,i]=e.useState({});return{handleFormImageUpload:e.useCallback(async(e,t,l)=>{if(!l?.length)return t;s(!0),r({}),i(a=>({...a,[e]:0}));try{const r=t.variants[e].colorName;if(!r.trim())throw new Error("يجب إدخال اسم اللون قبل رفع الصور");if(!t.code)return{...t,_imageFiles:{...t._imageFiles,[e]:l}};const s=await a(t.code,r,l,a=>{i(t=>({...t,[e]:a}))});return{...t,variants:t.variants.map((a,t)=>t===e?{...a,images:[...a.images,...s]}:a)}}catch(n){throw r(a=>({...a,[e]:n.message})),n}finally{s(!1),i(a=>({...a,[e]:0}))}},[a]),clearImageFiles:e.useCallback(e=>{const{_imageFiles:a,...t}=e;return{cleanData:t,imageFiles:a||{}}},[]),uploadErrors:t,isUploading:l,uploadProgress:n,setUploadErrors:r,setUploadProgress:i}})(n);e.useEffect(()=>{r&&c({id:r.id||"",name:r.name,code:r.code,category:r.category,description:r.description||"",basePrice:r.basePrice.toString(),discountPrice:r.discountPrice?.toString()||"",status:r.status,tag:r.tag,_imageFiles:{},tagColor:r.tagColor,features:r.features,variants:r.variants.map(e=>({product_id:r.id,id:e.id,colorName:e.colorName,colorCode:e.colorCode,images:e.images,sizes:e.sizes.map(e=>({size:e.size,quantity:e.quantity}))}))})},[r]);const C=e=>{const{name:a,value:t}=e.target;c(e=>({...e,[a]:t})),u(e=>({...e,[a]:""}))},k=(e,a,t)=>{c(r=>({...r,variants:r.variants.map((r,l)=>l===e?{...r,[a]:t}:r)}))},S=(e,a,t,r)=>{c(l=>({...l,variants:l.variants.map((l,s)=>s===e?{...l,sizes:l.sizes.map((e,l)=>l===a?{...e,[t]:r}:e)}:l)}))},P=async(e,a)=>{try{const t=await b(e,o,a);c(t)}catch(t){}},E=(e,a)=>{c(t=>({...t,variants:t.variants.map((t,r)=>r===e?{...t,images:t.images.filter((e,t)=>t!==a)}:t)}))};return t("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:l}),a("div",{className:"relative bg-gray-900 rounded-2xl w-full max-w-3xl  max-h-[95vh] overflow-y-auto hide-scrollbar",children:t("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return o.name.trim()||(e.name="اسم المنتج مطلوب"),o.category||(e.category="الفئة مطلوبة"),o.basePrice||(e.basePrice="السعر الأساسي مطلوب"),isNaN(parseFloat(o.basePrice))&&(e.basePrice="السعر يجب أن يكون رقماً"),o.discountPrice&&isNaN(parseFloat(o.discountPrice))&&(e.discountPrice="سعر الخصم يجب أن يكون رقماً"),o.variants.forEach((a,t)=>{a.colorName||(e[`variant${t}Color`]="اللون مطلوب"),a.sizes.forEach((a,r)=>{a.size||(e[`variant${t}Size${r}`]="المقاس مطلوب"),isNaN(parseInt(a.quantity))&&(e[`variant${t}Quantity${r}`]="الكمية يجب أن تكون رقماً")})}),u(e),0===Object.keys(e).length})()){h(!0);try{const{cleanData:e,imageFiles:a}=x(o),t={...e,id:e.id,name:e.name,code:e.code,category:e.category,description:e.description||"",basePrice:e.basePrice.toString(),discountPrice:e.discountPrice?.toString()||"",status:e.status,tag:e.tag,imageFiles:e.imageFiles,tagColor:e.tagColor,...e.features?.length?{features:e.features}:{},variants:e.variants.map(a=>({id:a.id,product_id:e.id,colorName:a.colorName,colorCode:a.colorCode,images:a.images,sizes:a.sizes.map(e=>({size:e.size,quantity:parseInt(e.quantity)}))}))};await s(t,a),h(!1),l()}catch(a){u(e=>({...e,submit:a.message}))}finally{h(!1)}}},className:"space-y-6 p-6",children:[t("div",{className:"flex justify-between items-center",dir:"ltr",children:[a("button",{type:"button",onClick:l,className:"p-2 hover:bg-gray-800 rounded-xl transition-colors",children:a(p,{className:"w-6 h-6 text-gray-400"})}),a("h2",{className:"text-xl font-bold text-white",children:r?"تعديل منتج":"إضافة منتج"})]}),t("div",{className:"space-y-4",children:[a(we,{label:"اسم المنتج",name:"name",value:o.name,onChange:C,error:d.name}),a(ke,{label:"الفئة",name:"category",value:o.category,onChange:C,error:d.category,options:[{value:"men",label:"رجالي"},{value:"women",label:"حريمي"},{value:"bags",label:"حقائب"}]}),a(Ce,{label:"الوصف",name:"description",value:o.description,onChange:C,error:d.description}),t("div",{className:"grid grid-cols-2 gap-4",children:[a(we,{label:"السعر الأساسي",name:"basePrice",type:"number",value:o.basePrice,onChange:C,error:d.basePrice}),a(we,{label:"سعر الخصم (اختياري)",name:"discountPrice",type:"number",value:o.discountPrice,onChange:C,error:d.discountPrice})]}),a(ke,{label:"الحالة",name:"status",value:o.status,onChange:C,error:d.status,options:[{value:"active",label:"نشط"},{value:"inactive",label:"غير نشط"}]})]}),a("div",{children:t("div",{className:"grid grid-cols-2 gap-4",children:[a(we,{label:"العلامة (اختياري)",name:"tag",type:"text",value:o.tag,onChange:e=>c({...o,tag:e.target.value}),error:d.discountPrice}),a(ke,{label:"لون العلامة",name:"tagColor",value:o.tagColor,onChange:e=>c({...o,tagColor:e.target.value}),error:d.status,options:[{label:"أزرق",value:"#3B82F6"},{label:"أخضر",value:"#10B981"},{label:"أحمر",value:"#EF4444"},{label:"أصفر",value:"#F59E0B"},{label:"بنفسجي",value:"#8B5CF6"},{label:"رمادي",value:"#64748B"},{label:"وردي",value:"#EC4899"},{label:"سماوي",value:"#0EA5E9"}]})]})}),t("div",{className:"space-y-4",children:[t("div",{className:"flex justify-between items-center",children:[a("h3",{className:"text-lg font-bold text-white",children:"المميزات (اختياري)"}),a("button",{type:"button",onClick:()=>c(e=>({...e,features:[...e.features,""]})),className:"p-2 bg-blue-500/10 text-blue-500 rounded-xl hover:bg-blue-500/20 transition-colors",children:a(N,{className:"w-5 h-5"})})]}),o.features?.map((e,r)=>t("div",{className:"flex gap-2",children:[a(we,{value:e,onChange:e=>((e,a)=>{c(t=>({...t,features:t.features.map((t,r)=>r===e?a:t)}))})(r,e.target.value),placeholder:"أدخل ميزة المنتج..."}),a("button",{type:"button",onClick:()=>(e=>c(a=>({...a,features:a.features.filter((a,t)=>t!==e)})))(r),className:"p-2 bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500/20 transition-colors",children:a($,{className:"w-5 h-5"})})]},r))]}),t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[a("h3",{className:"text-lg font-bold text-white",children:"الألوان والمقاسات"}),a("button",{type:"button",onClick:()=>c(e=>({...e,variants:[...e.variants,{id:"",product_id:"",colorName:"",colorCode:"#000000",images:[],sizes:[{size:"",quantity:0}]}]})),className:"p-2 bg-blue-500/10 text-blue-500 rounded-xl hover:bg-blue-500/20 transition-colors",children:a(N,{className:"w-5 h-5"})})]}),o.variants.map((e,r)=>t("div",{className:"bg-gray-800/30 rounded-xl p-4 space-y-4",children:[t("div",{className:"flex justify-between items-start pb-4",children:[t("div",{className:"grid grid-cols-2 gap-4 flex-1",children:[a(ke,{label:"اللون",value:e.colorName,onChange:e=>{const a=ye.find(a=>a.value===e.target.value);k(r,"colorName",e.target.value),k(r,"colorCode",a?.code||"#000000")},error:d[`variant${r}Color`],options:ye}),a(we,{label:"كود اللون",type:"color",value:e.colorCode,onChange:e=>k(r,"colorCode",e.target.value)})]}),o.variants.length>1&&a("button",{type:"button",onClick:()=>{return e=r,c(a=>({...a,variants:a.variants.filter((a,t)=>t!==e)}));var e},className:"p-2 bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500/20 transition-colors mr-4",children:a($,{className:"w-5 h-5"})})]}),i&&a(xe,{variant:e,variantIndex:r,onImageUpload:P,onImageRemove:E,isUploading:v,uploadProgress:w,error:y[r]}),t("div",{className:"space-y-4",children:[t("div",{className:"flex justify-between items-center",children:[a("h4",{className:"font-medium text-white",children:"المقاسات"}),a("button",{type:"button",onClick:()=>(e=>c(a=>({...a,variants:a.variants.map((a,t)=>t===e?{...a,sizes:[...a.sizes,{size:"",quantity:0}]}:a)})))(r),className:"p-2 bg-blue-500/10 text-blue-500 rounded-xl hover:bg-blue-500/20 transition-colors",children:a(N,{className:"w-5 h-5"})})]}),a("div",{className:"space-y-3",children:e.sizes.map((l,s)=>t("div",{className:"flex gap-4",children:[a("div",{className:"flex-1",children:a(we,{placeholder:"المقاس",value:l.size,onChange:e=>S(r,s,"size",e.target.value),error:d[`variant${r}Size${s}`]})}),a("div",{className:"flex-1",children:a(we,{type:"number",placeholder:"الكمية",value:l.quantity,onChange:e=>S(r,s,"quantity",e.target.value),error:d[`variant${r}Quantity${s}`]})}),e.sizes.length>1&&a("button",{type:"button",onClick:()=>((e,a)=>c(t=>({...t,variants:t.variants.map((t,r)=>r===e?{...t,sizes:t.sizes.filter((e,t)=>t!==a)}:t)})))(r,s),className:"p-2 bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500/20 transition-colors",children:a($,{className:"w-5 h-5"})})]},s))})]})]},r))]}),d.submit&&t("div",{className:"bg-red-500/10 text-red-500 p-4 rounded-xl flex items-center gap-2",children:[a(g,{className:"w-5 h-5"}),a("p",{children:d.submit})]}),t("div",{className:"flex justify-end gap-4",children:[a("button",{type:"button",onClick:l,className:"px-6 py-2 bg-gray-800 text-gray-400 rounded-xl hover:bg-gray-700 transition-colors",children:"إلغاء"}),a("button",{type:"submit",disabled:m||v,className:"px-6 py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:t(U,m?{children:[a("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),a("span",{children:"جاري الحفظ..."})]}:{children:[a(f,{className:"w-5 h-5"}),a("span",{children:"حفظ"})]})})]})]})})]})},Ne=({product:e,onEdit:r,onDelete:s})=>{e.variants[0]?.images[0];const n=e.variants.reduce((e,a)=>e+a.sizes.reduce((e,a)=>e+a.quantity,0),0),i=e.variants.length,o=e.variants.reduce((e,a)=>e+a.sizes.length,0);return t("div",{className:"group bg-gray-800/30 rounded-2xl p-4  border border-gray-700/50 hover:border-blue-500/30 transition-all duration-300",dir:"ltr",children:[t("div",{className:"flex gap-4",dir:"rtl",children:[t("div",{className:"flex-1 min-w-0",children:[t("div",{className:"flex justify-between items-start gap-4",dir:"ltr",children:[a("div",{className:"px-2 py-1 rounded-full text-xs font-medium\n                         "+("active"===e.status?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"),children:"active"===e.status?"نشط":"غير نشط"}),t("div",{className:"text-right",children:[a("h3",{className:"font-bold text-white group-hover:text-blue-500  transition-colors",children:e.name}),t("p",{className:"text-sm text-gray-400",dir:"rtl",children:["كود: ",e.code]})]})]}),t("div",{className:"mt-2 flex flex-wrap items-center gap-x-6 gap-y-2",children:[t("div",{className:"flex items-center gap-2",children:[a(D,{className:"w-4 h-4 text-blue-500"}),t("span",{className:"text-blue-500 font-bold",children:[e.basePrice.toLocaleString("ar-EG")," جنيه"]}),e.discountPrice&&t("span",{className:"text-sm text-gray-500 line-through",children:[e.discountPrice.toLocaleString("ar-EG")," جنيه"]})]}),t("div",{className:"flex items-center gap-2",children:[a(l,{className:"w-4 h-4 text-gray-400"}),t("span",{className:"text-gray-400",children:["المخزون: ",n]})]}),t("div",{className:"flex items-center gap-2",children:[a("div",{className:"w-4 h-4 rounded-full border-2 border-amber-500",style:{backgroundColor:e.variants[0]?.colorCode}}),t("span",{className:"text-gray-400",children:[i," لون, ",o," مقاس"]})]})]}),e.features?.length>0&&t("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.features.slice(0,3).map((e,t)=>a("span",{className:"px-2 py-1 rounded-lg bg-gray-800 text-gray-400  text-sm",children:e},t)),e.features.length>3&&t("span",{className:"px-2 py-1 rounded-lg bg-gray-800 text-gray-400  text-sm",children:["+",e.features.length-3]})]})]}),t("div",{className:"flex flex-col gap-2",children:[a("button",{onClick:r,className:"p-2 rounded-xl bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 transition-colors",children:a(j,{className:"w-5 h-5"})}),a("button",{onClick:s,className:"p-2 rounded-xl bg-red-500/10 text-red-500 hover:bg-red-500/20 transition-colors",children:a($,{className:"w-5 h-5"})})]})]}),a("div",{className:"mt-4 pt-4 border-t border-gray-700/50",children:a("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar pb-2",children:e.variants.map((e,r)=>t("div",{className:"flex-shrink-0 group/variant cursor-pointer",children:[t("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:[a("img",{src:e.images[0],alt:e.colorName,className:"w-full h-full object-cover transform transition-transform duration-500 group-hover/variant:scale-110"}),a("div",{className:"absolute inset-0 bg-gradient-to-t  from-black/50 to-transparent"}),a("div",{className:"absolute bottom-1 right-1 w-3 h-3 rounded-full",style:{backgroundColor:e.colorCode}})]}),t("div",{className:"mt-1 text-center",children:[a("p",{className:"text-sm text-gray-400",children:e.colorName}),t("p",{className:"text-xs text-gray-500",children:[e.sizes.length," مقاس"]})]})]},r))})})]})},we=y.forwardRef(({label:e,error:r,type:l="text",className:s="",...n},i)=>t("div",{className:"space-y-1",children:[e&&a("label",{className:"block text-sm font-medium text-gray-400",children:e}),a("input",{ref:i,type:l,className:`w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\n                   border transition-colors duration-300\n                   placeholder:text-gray-500 text-right\n                   ${r?"border-red-500/50 focus:border-red-500":"border-gray-700/50 focus:border-blue-500"}\n                   ${"color"===l?"h-12 p-1":""}\n                   ${s}`,dir:"rtl",...n}),r&&t("div",{className:"flex items-center gap-2 mt-1 text-red-500 text-sm",children:[a(g,{className:"w-4 h-4"}),a("span",{children:r})]})]}));we.displayName="Input";const Ce=({label:e,error:r,className:l="",...s})=>t("div",{className:"space-y-1",children:[e&&a("label",{className:"block text-sm font-medium text-gray-400",children:e}),a("textarea",{className:`w-full h-32 bg-gray-800/50 rounded-xl p-4 text-white\n                   border transition-colors duration-300 resize-none text-right\n                   placeholder:text-gray-500\n                   ${r?"border-red-500/50 focus:border-red-500":"border-gray-700/50 focus:border-blue-500"}\n                   ${l}`,dir:"rtl",...s}),r&&t("div",{className:"flex items-center gap-2 mt-1 text-red-500 text-sm",children:[a(g,{className:"w-4 h-4"}),a("span",{children:r})]})]}),ke=({label:e,error:r,options:l=[],className:s="",...n})=>t("div",{className:"space-y-1 ",children:[e&&a("label",{className:"block text-sm font-medium text-gray-400",children:e}),t("select",{className:`w-full h-12 bg-gray-800/50 rounded-xl px-8 text-white\n                   border transition-colors duration-300 text-right\n                   ${r?"border-red-500/50 focus:border-red-500":"border-gray-700/50 focus:border-blue-500"}\n                   ${s}`,dir:"rtl",...n,children:[a("option",{value:"",children:"اختر..."}),l.map(({value:e,label:t})=>a("option",{value:e,children:t},e))]}),r&&t("div",{className:"flex items-center gap-2 mt-1 text-red-500 text-sm",children:[a(g,{className:"w-4 h-4"}),a("span",{children:r})]})]}),Se=({title:e,value:r,icon:l,color:s})=>{const n={blue:{bg:"bg-blue-500/10",text:"text-blue-400",border:"border-blue-500/20",iconBg:"bg-blue-500/20"},emerald:{bg:"bg-emerald-500/10",text:"text-emerald-400",border:"border-emerald-500/20",iconBg:"bg-emerald-500/20"},amber:{bg:"bg-amber-500/10",text:"text-amber-400",border:"border-amber-500/20",iconBg:"bg-amber-500/20"},purple:{bg:"bg-purple-500/10",text:"text-purple-400",border:"border-purple-500/20",iconBg:"bg-purple-500/20"}}[s];return t("div",{className:`relative overflow-hidden rounded-2xl p-6 bg-gray-800/50 backdrop-blur-xl hover:bg-gray-800/70 transition-all duration-300 hover:shadow-xl hover:shadow-black/20 ${n.border}`,children:[a("div",{className:"absolute top-4 right-4",children:a("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${n.iconBg}`,children:a(l,{className:`w-6 h-6 ${n.text}`})})}),t("div",{className:"mt-8",children:[a("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:e}),a("div",{className:"mt-2",children:a("span",{className:`text-3xl font-bold ${n.text}`,children:r})})]})]})},Pe=({product:e,onEdit:r,onDelete:l})=>{const s=e.variants[0]?.images[0],n=e.variants.reduce((e,a)=>e+a.sizes.reduce((e,a)=>e+a.quantity,0),0);return a("div",{className:"group bg-gray-800/30 rounded-2xl p-4 space-y-4 border border-gray-700/50 hover:border-blue-500/30 transition-all duration-300",children:t("div",{className:"relative aspect-square rounded-xl overflow-hidden",children:[a("img",{src:s,alt:e.name,className:"w-full h-full object-cover transform transition-transform duration-500 group-hover:scale-110"}),a("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"}),a("div",{className:"absolute top-2 right-2",children:a("span",{className:"px-2 py-1 rounded-full text-xs font-medium\n                        "+("active"===e.status?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"),children:"active"===e.status?"نشط":"غير نشط"})}),t("div",{className:"absolute bottom-2 left-2 flex gap-2 opacity-0  group-hover:opacity-100 transition-opacity",children:[a("button",{onClick:r,className:"p-2 rounded-xl bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 transition-colors",children:a(j,{className:"w-5 h-5"})}),a("button",{onClick:l,className:"p-2 rounded-xl bg-red-500/20 text-red-500 hover:bg-red-500/30 transition-colors",children:a($,{className:"w-5 h-5"})})]}),t("div",{className:"flex items-center gap-4",children:[t("span",{className:"text-sm text-gray-400",children:["المخزون: ",n]}),t("span",{className:"text-blue-500 font-bold",children:[e.basePrice.toLocaleString("ar-EG")," جنيه"]})]})]})})},Ee=({product:e,onClose:r,onConfirm:l})=>t("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),t("div",{className:"relative bg-gray-900 rounded-2xl w-full max-w-md p-6 space-y-4",children:[a("h2",{className:"text-xl font-bold text-white text-center",children:"تأكيد الحذف"}),t("p",{className:"text-gray-400 text-center",children:['هل أنت متأكد من حذف المنتج "',e.name,'"؟',a("br",{}),"لا يمكن التراجع عن هذا الإجراء."]}),t("div",{className:"flex gap-4",children:[a("button",{onClick:r,className:"flex-1 px-4 py-2 bg-gray-800 text-gray-400 rounded-xl hover:bg-gray-700 transition-colors",children:"إلغاء"}),a("button",{onClick:l,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",children:"حذف"})]})]})]}),je=()=>a("div",{className:"col-span-full flex items-center justify-center py-12",children:t("div",{className:"space-y-4 text-center",children:[a("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500  border-t-transparent rounded-full mx-auto"}),a("p",{className:"text-gray-400",children:"جاري تحميل المنتجات..."})]})}),$e=({message:e})=>t("div",{className:"col-span-full text-center py-12",children:[a(g,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"حدث خطأ"}),a("p",{className:"text-gray-400",children:e})]}),De=()=>t("div",{className:"col-span-full text-center py-12",children:[a(E,{className:"w-16 h-16 text-gray-700 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"لا توجد منتجات"}),a("p",{className:"text-gray-400",children:"لم يتم العثور على منتجات تطابق معايير البحث"})]}),Ue=[{id:"all",label:"الكل",icon:v},{id:"men",label:"رجالي",icon:S},{id:"women",label:"حريمي",icon:P}],Le=()=>{const{orders:s,selectedOrder:n,page:i,totalPages:o,filters:c,isLoading:d,error:u,setSelectedOrder:m,updateFilters:g,updateOrderStatus:h,nextPage:b,previousPage:p}=(()=>{const[a,t]=e.useState([]),[r,l]=e.useState(0),[s,n]=e.useState(null),[i,o]=e.useState(1),[c,d]=e.useState(0),[u,m]=e.useState(20),[g,h]=e.useState({status:"all",startDate:null,endDate:null,search:""}),[b,p]=e.useState(!1),[x,y]=e.useState(!1),[v,f]=e.useState(null),[N,w]=e.useState(null),{apiCall:C}=ie(),k=e.useRef([]),S=e.useCallback(async(e=i,a=g)=>{p(!0),f(null);try{const r=new URLSearchParams({page:e,perPage:u,...a,...a.startDate&&{startDate:a.startDate.toISOString()},...a.endDate&&{endDate:a.endDate.toISOString()}}).toString(),s=await C(`/admin/orders?${r}`);return s?.orders&&(t(s.orders),l(s.total),d(s.pages),k.current=s.orders),s}catch(r){return f(r.message),null}finally{p(!1)}},[C,i,u,g]),P=e.useCallback(async(e,r)=>{y(!0),w(null);const l=[...a];try{t(a.map(a=>a.id===e?{...a,status:r}:a));const s=await C(`/admin/orders/${e}/status`,{method:"PUT",body:JSON.stringify({status:r})});if(!s)throw t(l),new Error("Failed to update order status");return await S(),s}catch(s){return w(s.message),t(l),null}finally{y(!1)}},[C,a,S]),E=e.useCallback(e=>{h(a=>({...a,...e})),o(1)},[]),j=e.useCallback(()=>{i<c&&o(e=>e+1)},[i,c]),$=e.useCallback(()=>{i>1&&o(e=>e-1)},[i]);return e.useEffect(()=>{S()},[i,g,S]),{orders:a,totalOrders:r,selectedOrder:s,page:i,totalPages:c,perPage:u,filters:g,isLoading:b,isUpdatingStatus:x,error:v,updateStatusError:N,setSelectedOrder:n,setPage:o,setPerPage:m,updateFilters:E,loadOrders:S,updateOrderStatus:P,nextPage:j,previousPage:$}})(),[x,y]=e.useState(!1),v=e.useMemo(()=>{if(!s.length)return null;const e=s.reduce((e,a)=>e+a.total,0),a=s.reduce((e,a)=>(e[a.status]=(e[a.status]||0)+1,e),{}),t=e/s.length;return{totalRevenue:e,totalOrders:s.length,pendingOrders:a.pending||0,processingOrders:a.processing||0,avgOrderValue:t}},[s]);return t("div",{className:"min-h-screen bg-secondary-900 pb-20",children:[t("div",{className:"p-4 pt-0 grid grid-cols-2 gap-4",children:[a(Fe,{title:"إجمالي المبيعات",value:(v?.totalRevenue?.toLocaleString("ar-EG")||0)+" جنيه",icon:r,color:"emerald"}),a(Fe,{title:"عدد الطلبات",value:v?.totalOrders||0,icon:l,color:"blue"}),a(Fe,{title:"متوسط قيمة الطلب",value:(v?.avgOrderValue?.toLocaleString("ar-EG")||0)+" جنيه",icon:L,color:"amber"}),a(Fe,{title:"طلبات معلقة",value:v?.pendingOrders||0,icon:F,color:"red"})]}),t("div",{className:"sticky top-0 z-30 bg-secondary-900/95 backdrop-blur-sm p-4 space-y-4",children:[a(Oe,{value:c.search,onChange:e=>g({search:e})}),a(ze,{activeStatus:c.status,onStatusChange:e=>g({status:e})})]}),a("div",{className:"p-4 space-y-4",children:d?a(Ge,{}):u?a(Be,{message:u}):0===s.length?a(qe,{}):s.map(e=>a(Ie,{order:e,onClick:()=>{m(e),y(!0)}},e.id))}),n&&a(Re,{order:n,isOpen:x,onClose:()=>{y(!1),m(null)},onUpdateStatus:h}),o>1&&a(_e,{page:i,totalPages:o,onNext:b,onPrevious:p})]})},Fe=({title:e,value:r,icon:l,color:s})=>t("div",{className:`relative overflow-hidden hide-scrollbar rounded-2xl p-4 \n                  bg-${s}-500/10 border border-${s}-500/20`,dir:"rtl",children:[a("div",{className:"absolute top-4 left-4",children:a(l,{className:`w-6 h-6 text-${s}-500`})}),t("div",{className:"mt-6",children:[a("h3",{className:"text-sm font-medium text-gray-400",children:e}),a("div",{className:"mt-2",children:a("span",{className:`text-2xl font-bold text-${s}-500`,children:r})})]})]}),Oe=({value:e,onChange:r})=>t("div",{className:"relative",children:[a("input",{type:"text",value:e,onChange:e=>r(e.target.value),placeholder:"ابحث برقم الطلب أو رقم الهاتف...",className:"w-full h-12 bg-gray-800/50 rounded-xl px-12 text-white text-right border border-gray-700/50 focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/50 placeholder:text-gray-500",dir:"rtl"}),a(k,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e&&a("button",{onClick:()=>r(""),className:"absolute right-4 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-gray-700/50 transition-colors",children:a(p,{className:"w-4 h-4 text-gray-400"})})]}),ze=({activeStatus:e,onStatusChange:r})=>a("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar py-2",dir:"rtl",children:[{id:"all",label:"الكل",icon:l},{id:"pending",label:"معلق",icon:F},{id:"processing",label:"قيد التنفيذ",icon:O},{id:"delivered",label:"تم التسليم",icon:z},{id:"cancelled",label:"ملغي",icon:I}].map(({id:l,label:s,icon:n})=>t("button",{onClick:()=>r(l),className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm\n                     whitespace-nowrap transition-colors\n                     "+(e===l?"bg-blue-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"),children:[a(n,{className:"w-4 h-4"}),a("span",{children:s})]},l))}),Ie=({order:e,onClick:r})=>{const s={pending:{icon:F,color:"text-yellow-500",bgColor:"bg-yellow-500/10",label:"معلق"},processing:{icon:O,color:"text-blue-500",bgColor:"bg-blue-500/10",label:"قيد التنفيذ"},delivered:{icon:z,color:"text-green-500",bgColor:"bg-green-500/10",label:"تم التسليم"},cancelled:{icon:I,color:"text-red-500",bgColor:"bg-red-500/10",label:"ملغي"}}[e.status]||{icon:l,color:"text-gray-500",bgColor:"bg-gray-500/10",label:"غير معروف"},n=s.icon,i=e.userPhone||e.user?.phone_number,o=e.userName||e.user?.name,c=e.total||0,d=e.createdAt||e.created_at;return t("div",{onClick:r,className:"group bg-gray-800/30 rounded-2xl p-4 space-y-4 cursor-pointer border border-gray-700/50 hover:border-blue-500/30 transition-all duration-300 relative overflow-hidden hide-scrollbar",children:[a("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-800/0 to-gray-800/50 opacity-0  group-hover:opacity-100 transition-opacity duration-500"}),t("div",{className:"relative",children:[t("div",{className:"flex justify-between items-start gap-4",children:[t("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full\n                          ${s.color} ${s.bgColor} border border-transparent\n                          transition-all duration-300 group-hover:border-current/20`,children:[a(n,{className:"w-4 h-4 "+("processing"===status?"group-hover:animate-spin":"")}),a("span",{className:"text-sm font-medium",children:s.label})]}),t("div",{className:"text-right flex-1 min-w-0",children:[o&&a("h3",{className:"font-bold text-white truncate group-hover:text-blue-500 transition-colors duration-300",children:o}),i&&a("p",{className:"text-sm text-gray-400 mt-0.5 dir-ltr",children:i}),d&&a("p",{className:"text-xs text-gray-500 mt-1",children:new Date(d).toLocaleString("ar-EG",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})})]})]}),t("div",{className:"flex items-center justify-between pt-4 border-t border-gray-700/50 mt-4",children:[a("div",{className:"flex gap-2",children:i&&t(U,{children:[a("button",{onClick:e=>{e.stopPropagation(),i&&window.open(`https://wa.me/${i}`,"_blank")},className:"p-2 rounded-xl bg-gray-800/50 hover:bg-green-500/10 border border-transparent hover:border-green-500/30 transition-all duration-300 group/btn",title:"واتساب",children:a(R,{className:"w-5 h-5 text-green-500 transition-transform duration-300 group-hover/btn:scale-110"})}),a("button",{onClick:e=>{e.stopPropagation(),i&&window.open(`tel:${i}`,"_blank")},className:"p-2 rounded-xl bg-gray-800/50 hover:bg-blue-500/10 border border-transparent hover:border-blue-500/30 transition-all duration-300 group/btn",title:"اتصال",children:a(T,{className:"w-5 h-5 text-blue-500 transition-transform duration-300 group-hover/btn:scale-110"})}),a("button",{onClick:async e=>{if(e.stopPropagation(),i)try{await navigator.clipboard.writeText(i)}catch(a){}},className:"p-2 rounded-xl bg-gray-800/50 hover:bg-blue-500/10 border border-transparent hover:border-blue-500/30 transition-all duration-300 group/btn",title:"نسخ رقم الهاتف",children:a(A,{className:"w-5 h-5 text-blue-500 transition-transform duration-300 group-hover/btn:scale-110"})})]})}),t("div",{className:"flex items-center gap-2",children:[t("div",{className:"text-right",children:[t("span",{className:"block font-bold text-blue-500 text-lg",children:[c.toLocaleString("ar-EG")," جنيه"]}),e.items?.length>0&&t("span",{className:"text-xs text-gray-400",children:[e.items.length," منتج"]})]}),a(l,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors duration-300"})]})]})]})]})},Re=({order:e,isOpen:r,onClose:l,onUpdateStatus:s})=>{if(!e)return null;const n=e.userPhone||e.user?.phone_number,i=e.items||[],o=e.total||0,c=e.subtotal||0,d=e.tracking||[];return t("div",{className:"fixed inset-0 z-50 transition-opacity duration-300\n                      "+(r?"opacity-100":"opacity-0 pointer-events-none"),children:[a("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:l}),a("div",{className:"fixed inset-x-0 bottom-0 transform transition-transform duration-500 \n                        "+(r?"translate-y-0":"translate-y-full"),children:a("div",{className:"bg-gradient-to-b from-gray-900/95 to-gray-900 backdrop-blur-xl rounded-t-[2.5rem] border-t border-gray-800/50 shadow-2xl max-h-[90vh] overflow-y-auto hide-scrollbar",children:t("div",{className:"px-6 py-8 space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[a("button",{onClick:l,className:"p-2 -m-2 rounded-full hover:bg-gray-800/50 transition-colors",children:a(G,{className:"w-6 h-6 text-gray-400"})}),a("div",{className:"text-center flex-1",children:t("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm bg-gray-800/50",children:[a(Te,{status:e.status,className:"w-4 h-4"}),a("span",{children:Ae(e.status)})]})}),a("button",{onClick:async()=>{const a=`\n  طلب من: ${n}\n  المنتجات:\n  ${i.map(e=>`• ${e.productName||e.name}\n     ${e.quantity}× - المقاس: ${e.size} - اللون: ${e.variant}\n     السعر: ${(e.price*e.quantity).toLocaleString("ar-EG")} جنيه`).join("\n")}\n  \n  الإجمالي: ${o.toLocaleString("ar-EG")} جنيه\n  التاريخ: ${new Date(e.createdAt).toLocaleString("ar-EG")}`.trim();try{navigator.share?await navigator.share({text:a}):await navigator.clipboard.writeText(a)}catch(t){t.name}},className:"p-2 -m-2 rounded-full hover:bg-gray-800/50 transition-colors",children:a(B,{className:"w-6 h-6 text-gray-400"})})]}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4",children:[t("div",{className:"flex items-center justify-between",children:[a("h4",{className:"text-lg font-bold text-white",children:"معلومات العميل"}),a("span",{className:"text-sm text-gray-400",dir:"ltr",children:n})]}),t("div",{className:"flex gap-2 mt-4",children:[t("button",{onClick:()=>window.open(`https://wa.me/${n}`,"_blank"),className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-gray-800/50 hover:bg-green-500/10 border border-transparent hover:border-green-500/30 transition-all duration-300",children:[a(R,{className:"w-5 h-5 text-green-500"}),a("span",{className:"text-sm text-gray-400",children:"واتساب"})]}),t("button",{onClick:()=>window.open(`tel:${n}`,"_blank"),className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-gray-800/50 hover:bg-blue-500/10 border border-transparent hover:border-blue-500/30 transition-all duration-300",children:[a(T,{className:"w-5 h-5 text-blue-500"}),a("span",{className:"text-sm text-gray-400",children:"اتصال"})]})]})]}),t("div",{className:"space-y-4",children:[t("div",{className:"flex items-center justify-between",dir:"rtl",children:[a("h4",{className:"text-lg font-bold text-white",children:"المنتجات"}),t("span",{className:"text-sm text-gray-400",children:[i.length," منتج"]})]}),a("div",{className:"space-y-3",children:i.map((e,r)=>t("div",{className:"bg-gray-800/30 rounded-xl p-3 flex gap-3",children:[t("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden hide-scrollbar group",children:[a("img",{src:e.image,alt:e.productName,className:"w-full h-full object-cover group-hover:scale-110 transition-transform"}),a("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"}),t("span",{className:"absolute bottom-1 right-1 text-xs bg-black/50 text-white px-1.5 py-0.5 rounded-full",children:[e.quantity,"×"]})]}),t("div",{className:"flex-1 min-w-0",children:[t("div",{className:"flex justify-between items-start gap-2",children:[t("span",{className:"text-blue-500 font-bold whitespace-nowrap",children:[(e.price*e.quantity).toLocaleString("ar-EG")," جنيه"]}),a("h4",{className:"font-medium text-white text-right truncate",children:e.productName||e.name})]}),t("div",{className:"mt-1 flex justify-end items-center gap-3",children:[t("span",{className:"text-sm text-gray-400",children:["المقاس: ",e.size]}),t("span",{className:"text-sm text-gray-400",children:["اللون: ",e.variant]})]})]})]},r))})]}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4 space-y-3",children:[t("div",{className:"flex justify-between items-center",children:[t("span",{className:"text-blue-500 font-bold",children:[c.toLocaleString("ar-EG")," جنيه"]}),a("span",{className:"text-gray-400",children:"المجموع"})]}),0!=e.shipping&&t("div",{className:"flex justify-between items-center",children:[t("span",{className:"text-green-500 font-bold",children:[e.shipping.toLocaleString("ar-EG")," جنيه"]}),a("span",{className:"text-gray-400",children:"الشحن"})]}),a("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-700 to-transparent"}),t("div",{className:"flex justify-between items-center",children:[t("span",{className:"text-xl font-bold text-white",children:[o.toLocaleString("ar-EG")," جنيه"]}),a("span",{className:"text-lg font-bold text-white",children:"الإجمالي"})]})]}),d.length>0&&t("div",{className:"space-y-4",children:[a("h4",{className:"text-lg font-bold text-white",dir:"rtl",children:"تتبع الطلب"}),a("div",{className:"relative space-y-4",children:d.map((e,r)=>t("div",{className:"flex items-start gap-4",children:[r!==d.length-1&&a("div",{className:"absolute top-8 bottom-0 left-4 w-px  bg-gradient-to-b from-gray-700 to-transparent"}),a("div",{className:"relative z-10 w-8 h-8 rounded-full flex items-center justify-center\n                                      "+(e.completed?"bg-blue-500":"bg-gray-700"),children:a(Te,{status:e.status,className:"w-4 h-4 text-white"})}),t("div",{className:"flex-1",children:[t("div",{className:"flex justify-between items-center",children:[a("span",{className:"text-sm text-gray-400",children:new Date(e.timestamp).toLocaleString("ar-EG")}),a("span",{className:"font-medium text-white",children:Ae(e.status)})]}),e.description&&a("p",{className:"text-sm text-gray-500 mt-1",children:e.description})]})]},r))})]}),a("div",{className:"grid grid-cols-2 gap-3",children:[{status:"pending",label:"تعليق",icon:F,color:"yellow"},{status:"processing",label:"معالجة",icon:O,color:"blue"},{status:"delivered",label:"تسليم",icon:z,color:"green"},{status:"cancelled",label:"إلغاء",icon:I,color:"red"}].map(({status:r,label:l,icon:n,color:i})=>t("button",{onClick:()=>s(e.id,r),disabled:e.status===r,className:"flex items-center justify-center gap-2 p-3 rounded-xl font-medium \n                               transition-all duration-300 group\n                               "+(e.status===r?"bg-gray-800/50 text-gray-500 cursor-not-allowed":`bg-gray-800/30 hover:bg-${i}-500/10 \n                                    border border-transparent hover:border-${i}-500/30`),children:[a(n,{className:"w-5 h-5 "+(e.status===r?"text-gray-500":`text-${i}-500 \n                                        ${"processing"===r?"group-hover:animate-spin":""}`)}),a("span",{className:"text-sm "+(e.status===r?"text-gray-500":`text-gray-400 group-hover:text-${i}-500`),children:l})]},r))})]})})})]})},Te=({status:e})=>a({pending:F,processing:O,delivered:z,cancelled:I}[e]||l,{className:"w-5 h-5"}),Ae=e=>({pending:"معلق",processing:"قيد التنفيذ",delivered:"تم التسليم",cancelled:"ملغي"}[e]||"غير معروف"),Ge=()=>a("div",{className:"flex items-center justify-center py-12",children:a("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500  border-t-transparent rounded-full"})}),Be=({message:e})=>t("div",{className:"text-center py-12",children:[a(g,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"حدث خطأ"}),a("p",{className:"text-gray-400",children:e})]}),qe=()=>t("div",{className:"text-center py-12",children:[a(l,{className:"w-16 h-16 text-gray-700 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"لا توجد طلبات"}),a("p",{className:"text-gray-400",children:"لم يتم العثور على طلبات تطابق معايير البحث"})]}),_e=({page:e,totalPages:r,onNext:l,onPrevious:s})=>a("div",{className:"fixed bottom-0 inset-x-0 bg-gray-900/95 backdrop-blur-xl  border-t border-gray-800/50 p-4",children:t("div",{className:"flex justify-between items-center max-w-lg mx-auto",children:[a("button",{onClick:s,disabled:e<=1,className:"p-2 rounded-xl bg-gray-800/50 text-gray-400 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700/50 transition-colors",children:"السابق"}),t("span",{className:"text-gray-400",children:["صفحة ",e," من ",r]}),a("button",{onClick:l,disabled:e>=r,className:"p-2 rounded-xl bg-gray-800/50 text-gray-400 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700/50 transition-colors",children:"التالي"})]})}),Me=()=>{const{customers:s,totalCustomers:m,selectedCustomer:g,page:h,totalPages:b,search:p,isLoading:x,setSelectedCustomer:y,setSearch:v,nextPage:f,previousPage:N}=(()=>{const[a,t]=e.useState([]),[r,l]=e.useState(0),[s,n]=e.useState(null),[i,o]=e.useState(1),[c,d]=e.useState(0),[u,m]=e.useState(20),[g,h]=e.useState(""),[b,p]=e.useState(""),[x,y]=e.useState(!1),[v,f]=e.useState(!1),[N,w]=e.useState(null),[C,k]=e.useState(null),{apiCall:S}=ie(),P=e.useRef(null);e.useEffect(()=>(P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{p(g),o(1)},300),()=>{P.current&&clearTimeout(P.current)}),[g]);const E=e.useCallback(async(e=i,a=b)=>{y(!0),w(null);try{const r=new URLSearchParams({page:e,perPage:u,search:a}).toString(),s=await S(`/admin/customers?${r}`);return s?.customers&&(t(s.customers),l(s.total),d(s.pages)),s}catch(r){return w(r.message),null}finally{y(!1)}},[S,i,u,b]),j=e.useCallback(async e=>{f(!0),k(null);try{const a=await S(`/admin/customers/${e}`);return a&&n(a),a}catch(a){return k(a.message),null}finally{f(!1)}},[S]),$=e.useCallback(()=>{i<c&&o(e=>e+1)},[i,c]),D=e.useCallback(()=>{i>1&&o(e=>e-1)},[i]);return e.useEffect(()=>{E()},[i,b,E]),{customers:a,totalCustomers:r,selectedCustomer:s,page:i,totalPages:c,perPage:u,search:g,isLoading:x,isLoadingDetails:v,error:N,detailsError:C,setSelectedCustomer:n,setPage:o,setPerPage:m,setSearch:h,loadCustomers:E,loadCustomerDetails:j,nextPage:$,previousPage:D}})(),[w,C]=e.useState(!1),[S,P]=e.useState({spendingRange:[],orderCount:[],location:[],dateRange:[]});S.spendingRange;const E=e.useMemo(()=>{if(!s.length)return null;const e={low:{min:0,max:1e3,count:0,total:0},medium:{min:1001,max:5e3,count:0,total:0},high:{min:5001,max:1/0,count:0,total:0}},a={},t={new:{min:0,max:1,count:0},regular:{min:2,max:5,count:0},loyal:{min:6,max:1/0,count:0}},r={};return s.forEach(l=>{const s=l.totalSpent||0;if(s<=e.low.max?(e.low.count++,e.low.total+=s):s<=e.medium.max?(e.medium.count++,e.medium.total+=s):(e.high.count++,e.high.total+=s),l.addresses?.[0]?.governorate){const e=l.addresses[0].governorate;a[e]=(a[e]||0)+1}const n=l.orderCount||0;n<=t.new.max?t.new.count++:n<=t.regular.max?t.regular.count++:t.loyal.count++;const i=Math.floor((new Date-new Date(l.createdAt))/2592e6),o=3*Math.floor(i/3);r[o]=(r[o]||0)+1}),{spendingRanges:e,locationData:Object.entries(a).map(([e,a])=>({name:e,value:a})),orderFrequency:t,customerAges:Object.entries(r).map(([e,a])=>({months:`${e}-${parseInt(e)+3} شهور`,count:a})).sort((e,a)=>parseInt(e.months)-parseInt(a.months))}},[s]),j=e.useMemo(()=>s.length?s.filter(e=>{const a=0===S.spendingRange.length||S.spendingRange.some(a=>{switch(a){case"low":return e.totalSpent<=1e3;case"medium":return e.totalSpent>1e3&&e.totalSpent<=5e3;case"high":return e.totalSpent>5e3;default:return!0}}),t=0===S.orderCount.length||S.orderCount.some(a=>{switch(a){case"new":return e.orderCount<=1;case"regular":return e.orderCount>1&&e.orderCount<=5;case"loyal":return e.orderCount>5;default:return!0}}),r=0===S.location.length||S.location.includes(e.addresses?.[0]?.governorate),l=0===S.dateRange.length||S.dateRange.some(a=>"recent"!==a||(new Date-new Date(e.createdAt))/864e5<=30);return a&&t&&r&&l}):[],[s,S]);return t("div",{className:"min-h-screen bg-secondary-900 pb-20",children:[t("div",{className:"p-4 space-y-6 pt-0",children:[t("div",{className:"grid grid-cols-2 gap-4",children:[a(Ve,{title:"إجمالي العملاء",value:m,icon:n,color:"emerald"}),a(Ve,{title:"عملاء جدد",value:E?.orderFrequency.new.count||0,subtitle:"آخر 30 يوم",icon:n,color:"blue"})]}),E&&t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[a("h3",{className:"text-lg font-bold text-white mb-4",children:"تصنيف العملاء"}),a("div",{className:"h-64",children:a(i,{width:"100%",height:"100%",children:t(o,{children:[t(c,{data:[{name:"عملاء جدد",value:E.orderFrequency.new.count},{name:"عملاء منتظمون",value:E.orderFrequency.regular.count},{name:"عملاء مخلصون",value:E.orderFrequency.loyal.count}],cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",children:[a(d,{fill:"#10B981"}),a(d,{fill:"#3B82F6"}),a(d,{fill:"#F59E0B"})]}),a(u,{})]})})})]}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4 border border-gray-700/50",children:[a("h3",{className:"text-lg font-bold text-white mb-4",children:"التوزيع الجغرافي"}),a("div",{className:"h-64",children:a(i,{width:"100%",height:"100%",children:t(q,{data:E.locationData,children:[a(_,{dataKey:"name"}),a(M,{}),a(u,{}),a(V,{dataKey:"value",fill:"#3B82F6"})]})})})]})]})]}),t("div",{className:"sticky top-0 z-30 bg-secondary-900/95 backdrop-blur-sm p-4 space-y-4",children:[t("div",{className:"relative",children:[a("input",{type:"text",value:p,onChange:e=>v(e.target.value),placeholder:"ابحث برقم الهاتف أو العنوان...",className:"w-full h-12 bg-gray-800/50 rounded-xl px-12 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50\r placeholder:text-gray-500 text-right",dir:"rtl"}),a(k,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]}),t("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:[a(Ke,{label:"مستوى الإنفاق",options:[{value:"low",label:"منخفض (≤ 1000)"},{value:"medium",label:"(1000-5000)"},{value:"high",label:"مرتفع (> 5000)"}],values:S.spendingRange,onChange:e=>P(a=>({...a,spendingRange:e})),icon:r}),a(Ke,{label:"عدد الطلبات",options:[{value:"new",label:"جديد (≤ 1)"},{value:"regular",label:"منتظم (2-5)"},{value:"loyal",label:"مخلص (> 5)"}],values:S.orderCount,onChange:e=>P(a=>({...a,orderCount:e})),icon:l}),E&&a(Ke,{label:"المنطقة",options:[...E.locationData.map(e=>({value:e.name,label:e.name}))],values:S.location,onChange:e=>P(a=>({...a,location:e})),icon:J}),a(Ke,{label:"تاريخ التسجيل",options:[{value:"recent",label:"آخر 30 يوم"}],values:S.dateRange,onChange:e=>P(a=>({...a,dateRange:e})),icon:K})]})]}),a("div",{className:"p-4 space-y-4",dir:"rtl",children:x?a(Xe,{}):0===j.length?a(Ye,{}):j.map(e=>a(Je,{customer:e,onClick:()=>{y(e),C(!0)}},e.id))}),g&&a(We,{customer:g,isOpen:w,onClose:()=>{C(!1),y(null)},analytics:E}),b>1&&a(Qe,{page:h,totalPages:b,onNext:f,onPrevious:N})]})},Ve=({title:e,value:r,icon:l,trend:s,subtitle:n,color:i="emerald"})=>t("div",{className:`relative overflow-hidden rounded-2xl border p-4 ${{emerald:"bg-emerald-500/10 text-emerald-500 border-emerald-500/20",blue:"bg-blue-500/10 text-blue-500 border-blue-500/20",amber:"bg-amber-500/10 text-amber-500 border-amber-500/20"}[i]}`,dir:"rtl",children:[a("div",{className:"absolute top-4 left-4",children:a(l,{className:"w-6 h-6"})}),t("div",{className:"mt-6",children:[a("h3",{className:"text-sm font-medium text-gray-400",children:e}),t("div",{className:"mt-2 flex items-baseline gap-2",children:[a("span",{className:"text-2xl font-bold",children:r}),n&&a("span",{className:"text-sm text-gray-400",children:n})]}),s&&t("div",{className:"mt-2 flex items-center gap-1",children:[a(h,{className:"w-4 h-4"}),t("span",{className:"text-sm",children:[s,"% زيادة"]})]})]})]}),Je=({customer:e,onClick:r})=>{const s=(()=>{const a=e.orderCount||0;return a>5?{label:"عميل مخلص",color:"text-amber-500"}:a>1?{label:"عميل منتظم",color:"text-blue-500"}:{label:"عميل جديد",color:"text-emerald-500"}})();return t("div",{onClick:r,className:"bg-gradient-to-br from-gray-800/40 to-gray-800/20 \r rounded-2xl p-4 border border-gray-700/50 space-y-4 \r hover:border-blue-500/30 transition-all duration-300 cursor-pointer",dir:"ltr",children:[t("div",{className:"flex justify-between items-start",children:[t("div",{className:"flex gap-2",children:[a("button",{onClick:a=>{a.stopPropagation(),window.open(`https://wa.me/${e.phone}`,"_blank")},className:"p-2 rounded-xl bg-gray-800/50 hover:bg-green-500/10\r border border-transparent hover:border-green-500/30\r transition-all duration-300",children:a(R,{className:"w-5 h-5 text-green-500"})}),a("a",{href:`tel:${e.phone}`,onClick:e=>e.stopPropagation(),className:"p-2 rounded-xl bg-gray-800/50 hover:bg-blue-500/10\r border border-transparent hover:border-blue-500/30\r transition-all duration-300",children:a(T,{className:"w-5 h-5 text-blue-500"})}),a("button",{onClick:async a=>{a.stopPropagation();try{await navigator.clipboard.writeText(e.phone)}catch(t){}},className:"p-2 rounded-xl bg-gray-800/50 hover:bg-blue-500/10\r border border-transparent hover:border-blue-500/30\r transition-all duration-300",children:a(A,{className:"w-5 h-5 text-blue-500"})})]}),t("div",{className:"text-right",children:[t("div",{className:"flex items-center justify-end gap-2",children:[a("h3",{className:"text-lg font-bold text-white",dir:"ltr",children:e.phone}),a("span",{className:`text-sm ${s.color}`,children:s.label})]}),a("p",{className:"text-sm text-gray-400",children:new Date(e.createdAt).toLocaleDateString("ar-EG")})]})]}),e.addresses?.[0]&&t("div",{className:"flex items-start gap-3",dir:"rtl",children:[a(W,{className:"w-5 h-5 text-blue-500 mt-0.5"}),t("div",{className:"flex-1 text-right",children:[a("p",{className:"text-white",children:e.addresses[0].governorate}),a("p",{className:"text-sm text-gray-400",children:e.addresses[0].district}),e.addresses[0].details&&a("p",{className:"text-sm text-gray-500",children:e.addresses[0].details})]})]}),t("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-700/50",children:[t("div",{className:"space-y-1",dir:"rtl",children:[t("div",{className:"flex items-center gap-2",dir:"rtl",children:[a(l,{className:"w-4 h-4 text-blue-500"}),a("span",{className:"text-sm text-gray-400",children:"الطلبات"})]}),a("p",{className:"text-lg font-bold text-white pr-4",children:e.orderCount||0})]}),t("div",{className:"space-y-1 text-right",children:[t("div",{className:"flex items-center justify-end gap-2",children:[a("span",{className:"text-sm text-gray-400",children:"إجمالي المشتريات"}),a(D,{className:"w-4 h-4 text-blue-500"})]}),t("p",{className:"text-lg font-bold text-blue-500 pr-4",children:[(e.totalSpent||0).toLocaleString("ar-EG")," جنيه"]})]})]})]})},Ke=({label:r,options:l,values:s=[],onChange:n,icon:i})=>{const[o,c]=e.useState(!1),d=e.useRef(null);e.useEffect(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const u=e=>{const a=s.includes(e)?s.filter(a=>a!==e):[...s,e];n(a)},m=()=>{n([]),c(!1)},g=e=>a("div",{className:"w-5 h-5 rounded border flex items-center justify-center\n                      transition-colors duration-200\n                      "+(e?"border-blue-500 bg-blue-500":"border-gray-600"),children:e&&a("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});return t("div",{className:"relative",ref:d,children:[t("button",{onClick:()=>c(!o),className:"flex items-center gap-2 px-4 py-2 rounded-xl\n                     transition-all duration-200 whitespace-nowrap\n                     "+(o?"bg-blue-500/20 text-blue-500 border border-blue-500/30":s.length>0?"bg-blue-500/10 text-blue-500 border border-blue-500/20":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"),children:[i&&a(i,{className:"w-4 h-4"}),t("div",{className:"flex items-center gap-2",children:[a("span",{children:r}),0===s.length?null:a("span",{className:"px-2 py-0.5 text-xs rounded-full bg-blue-500/20 border border-blue-500/20",children:s.length})]})]}),t("div",{className:"fixed inset-0 z-50 md:hidden transition-opacity duration-300\n                      "+(o?"opacity-100":"opacity-0 pointer-events-none"),children:[a("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>c(!1)}),a("div",{className:"fixed inset-x-0 bottom-0 transform transition-transform duration-500 ease-out\n                        "+(o?"translate-y-0":"translate-y-full"),children:t("div",{className:"bg-gradient-to-b from-gray-900/95 to-gray-900 backdrop-blur-xl\r rounded-t-[2.5rem] border-t border-gray-800/50 shadow-2xl\r max-h-[80vh] overflow-y-auto",children:[a("div",{className:"absolute inset-x-0 top-0 h-7 flex justify-center items-start",children:a("div",{className:"w-12 h-1 rounded-full bg-gray-700/50 mt-3"})}),t("div",{className:"px-6 pt-8 pb-6",children:[a("h3",{className:"text-lg font-bold text-white mb-4",children:r}),a("div",{className:"grid grid-cols-1 gap-2",children:l.map(e=>t("button",{onClick:()=>u(e.value),className:"flex items-center gap-3 p-4 rounded-xl\n                               transition-all duration-200\n                               "+(s.includes(e.value)?"bg-blue-500/20 text-blue-500 border border-blue-500/30":"bg-gray-800/30 text-gray-400 hover:bg-gray-700/50"),children:[g(s.includes(e.value)),a("span",{className:"flex-1 text-right",children:e.label})]},e.value))}),t("div",{className:"mt-4 flex gap-2",children:[a("button",{onClick:m,className:"flex-1 py-3 rounded-xl bg-gray-800/50 text-gray-400\r hover:bg-gray-700/50 transition-colors",children:"إعادة تعيين"}),a("button",{onClick:()=>c(!1),className:"flex-1 py-3 rounded-xl bg-blue-500 text-white\r hover:bg-blue-600 transition-colors",children:"تطبيق"})]})]})]})})]}),o&&t("div",{className:"absolute top-full left-0 mt-2 w-64 bg-gray-800\r rounded-xl shadow-xl border border-gray-700/50 \r hidden md:block",children:[a("div",{className:"py-2",children:l.map(e=>t("button",{onClick:()=>u(e.value),className:"w-full flex items-center gap-3 px-4 py-3\n                           transition-colors\n                           "+(s.includes(e.value)?"text-blue-500 bg-blue-500/10":"text-gray-400 hover:bg-gray-700/50"),children:[g(s.includes(e.value)),a("span",{className:"flex-1 text-right",children:e.label})]},e.value))}),t("div",{className:"border-t border-gray-700/50 p-2 flex gap-2",children:[a("button",{onClick:m,className:"flex-1 py-2 rounded-lg bg-gray-800/50 text-gray-400\r hover:bg-gray-700/50 transition-colors text-sm",children:"إعادة تعيين"}),a("button",{onClick:()=>c(!1),className:"flex-1 py-2 rounded-lg bg-blue-500 text-white\r hover:bg-blue-600 transition-colors text-sm",children:"تطبيق"})]})]})]})},We=({customer:e,isOpen:r,onClose:s,analytics:n})=>e?t("div",{className:"fixed inset-0 z-50 transition-opacity duration-300\n                  "+(r?"opacity-100":"opacity-0 pointer-events-none"),children:[a("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),a("div",{className:"fixed inset-x-0 bottom-0 transform transition-transform duration-500\n                    "+(r?"translate-y-0":"translate-y-full"),children:a("div",{className:"bg-gradient-to-b from-gray-900/95 to-gray-900 backdrop-blur-xl\r rounded-t-[2.5rem] border-t border-gray-800/50 shadow-2xl\r max-h-[90vh] overflow-y-auto",dir:"rtl",children:t("div",{className:"px-6 py-8 space-y-6",children:[t("div",{className:"flex justify-between items-start",dir:"ltr",children:[a("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-800/50 transition-colors",children:"×"}),t("div",{className:"text-right",children:[a("h2",{className:"text-xl font-bold text-white",children:"تفاصيل العميل"}),t("p",{className:"text-sm text-gray-400",children:["عميل منذ ",(()=>{const a=Math.floor((new Date-new Date(e.createdAt))/2592e6);if(a<1)return"أقل من شهر";if(1===a)return"شهر واحد";if(a<12)return`${a} أشهر`;const t=Math.floor(a/12);return`${t} ${1===t?"سنة":"سنوات"}`})()]})]})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[a(Ve,{title:"إجمالي الطلبات",value:e.orderCount||0,icon:l,color:"blue"}),a(Ve,{title:"إجمالي المشتريات",value:`${(e.totalSpent||0).toLocaleString("ar-EG")} جنيه`,icon:D,color:"emerald"})]}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4 space-y-4",children:[a("h3",{className:"font-bold text-white",children:"معلومات الاتصال"}),t("div",{className:"flex items-center gap-3",children:[a(T,{className:"w-5 h-5 text-blue-500"}),a("span",{className:"text-white",dir:"ltr",children:e.phone})]}),t("div",{className:"flex gap-2",children:[t("button",{onClick:()=>window.open(`https://wa.me/${e.phone}`,"_blank"),className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl\r bg-green-500/10 text-green-500 hover:bg-green-500/20\r transition-colors",children:[a(R,{className:"w-5 h-5"}),a("span",{children:"واتساب"})]}),t("button",{onClick:()=>window.open(`tel:${e.phone}`),className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl\r bg-blue-500/10 text-blue-500 hover:bg-blue-500/20\r transition-colors",children:[a(T,{className:"w-5 h-5"}),a("span",{children:"اتصال"})]})]})]}),e.addresses?.length>0&&t("div",{className:"space-y-4",children:[a("h3",{className:"font-bold text-white",children:"العناوين"}),e.addresses.map((e,r)=>t("div",{className:"bg-gray-800/30 rounded-xl p-4 space-y-2",children:[a("p",{className:"text-white",children:e.governorate}),a("p",{className:"text-gray-400",children:e.district}),e.details&&a("p",{className:"text-sm text-gray-500",children:e.details})]},r))]})]})})})]}):null,Qe=({page:e,totalPages:r,onNext:l,onPrevious:s})=>a("div",{className:"fixed bottom-0 inset-x-0 bg-gray-900/95 backdrop-blur-xl \r border-t border-gray-800/50 p-4",children:t("div",{className:"flex justify-between items-center",children:[a("button",{onClick:s,disabled:1===e,className:"p-2 rounded-xl bg-gray-800/50 text-gray-400\r disabled:opacity-50 disabled:cursor-not-allowed",children:a(Q,{className:"w-5 h-5"})}),t("span",{className:"text-gray-400",children:["صفحة ",e," من ",r]}),a("button",{onClick:l,disabled:e===r,className:"p-2 rounded-xl bg-gray-800/50 text-gray-400\r disabled:opacity-50 disabled:cursor-not-allowed",children:a(X,{className:"w-5 h-5"})})]})}),Xe=()=>a("div",{className:"flex items-center justify-center py-12",children:a(m,{className:"w-8 h-8 text-blue-500 animate-spin"})}),Ye=()=>t("div",{className:"text-center py-12",children:[a(n,{className:"w-16 h-16 text-gray-700 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"لا يوجد عملاء"}),a("p",{className:"text-gray-400",children:"لم يتم العثور على عملاء يطابقون معايير البحث"})]}),He=()=>{const{slides:r,loading:l,errors:s,createSlide:n,updateSlide:i,deleteSlide:o,toggleSlideStatus:c,resetError:d}=(()=>{const[a,t]=e.useState([]),[r,l]=e.useState(null),[s,n]=e.useState({slides:!1,create:!1,update:!1,delete:!1,status:!1}),[i,o]=e.useState({slides:null,create:null,update:null,delete:null}),{apiCall:c}=ie(),d=e.useRef([]),u=e.useCallback(e=>{o(a=>({...a,[e]:null}))},[]),m=e.useCallback(e=>{const a=["title","productId"].filter(a=>!e[a]);return a.length>0?{isValid:!1,error:`Missing required fields: ${a.join(", ")}`}:{isValid:!0}},[]),g=e.useCallback(e=>{const a=new FormData;return Object.entries(e).forEach(([e,t])=>{null!=t&&("image"===e&&t instanceof File?a.append("image",t):"image"!==e&&a.append(e,t))}),a},[]),h=e.useCallback(async()=>{n(e=>({...e,slides:!0})),u("slides");try{const e=await c("/admin/slides");return e&&(t(e),d.current=e),e}catch(e){return o(a=>({...a,slides:e.message})),null}finally{n(e=>({...e,slides:!1}))}},[c,u]),b=e.useCallback(async e=>{n(e=>({...e,create:!0})),u("create");const a=m(e);if(!a.isValid)return o(e=>({...e,create:a.error})),n(e=>({...e,create:!1})),null;try{const a=g(e),t=await c("/admin/slides",{method:"POST",body:a});return t&&await h(),t}catch(t){return o(e=>({...e,create:t.message})),null}finally{n(e=>({...e,create:!1}))}},[c,h,m,g,u]),p=e.useCallback(async(e,r)=>{n(e=>({...e,update:!0})),u("update");const l=[...a],s=a.findIndex(a=>a.id===e);try{let n,i={};if(r.image instanceof File?n=g(r):(n=JSON.stringify(r),i={"Content-Type":"application/json"}),-1!==s&&!(r.image instanceof File)){const e={...a[s],...r},l=[...a];l[s]=e,t(l)}const o=await c(`/admin/slides/${e}`,{method:"PUT",headers:i,body:n});return o?(await h(),o):(t(l),null)}catch(i){return t(l),o(e=>({...e,update:i.message})),null}finally{n(e=>({...e,update:!1}))}},[c,a,h,g,u]),x=e.useCallback(async e=>{n(e=>({...e,delete:!0})),u("delete");const r=[...a];try{t(a.filter(a=>a.id!==e));const l=await c(`/admin/slides/${e}`,{method:"DELETE"});if(!l)throw t(r),new Error("Failed to delete slide");return l}catch(l){return t(r),o(e=>({...e,delete:l.message})),null}finally{n(e=>({...e,delete:!1}))}},[c,a,u]),y=e.useCallback(async e=>{n(e=>({...e,status:!0})),u("update");const r=a.findIndex(a=>a.id===e);if(-1===r)return;const l=a[r],s="active"===l.status?"inactive":"active",i=[...a];try{const n=[...a];n[r]={...l,status:s},t(n);const o=await c(`/admin/slides/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(!o)throw t(i),new Error("Failed to update slide status");return o}catch(d){return t(i),o(e=>({...e,update:d.message})),null}finally{n(e=>({...e,status:!1}))}},[c,a,u]);return e.useEffect(()=>{h()},[h]),{slides:a,selectedSlide:r,loading:s,errors:i,setSelectedSlide:l,loadSlides:h,createSlide:b,updateSlide:p,deleteSlide:x,toggleSlideStatus:y,resetError:u}})(),{products:u,loading:m}=oe(),[g,h]=e.useState(!1);return t("div",{className:"min-h-screen bg-secondary-900 p-4 pt-0 pb-20",dir:"rtl",children:[a("div",{className:"sticky top-0 z-30 -mx-4 bg-secondary-900/95 backdrop-blur-xl px-4 py-3 \r border-b border-secondary-800/50 pt-0",children:t("div",{className:"flex items-center justify-between",children:[a("h1",{className:"text-xl font-bold text-white",children:"إدارة العروض"}),t("button",{onClick:()=>{h(!0),d("create")},className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-blue-500 \r hover:bg-blue-600 transition-colors text-white",children:[a(N,{className:"w-5 h-5"}),a("span",{children:"إضافة عرض"})]})]})}),l.slides?a(sa,{}):s.slides?a(na,{message:s.slides}):0===r.length?a(ia,{}):a("div",{className:"space-y-4 mt-6",children:r.map(e=>a(ea,{slide:e,onDelete:o,onUpdate:i,onToggleStatus:c,products:u,loading:l,errors:s,resetError:d},e.id))}),g&&a(aa,{onClose:()=>{h(!1),d("create")},onCreate:async e=>{await n(e)&&h(!1)},products:u,isLoading:l.create||m,error:s.create})]})},Ze=({checked:e,onChange:r,disabled:l})=>t("button",{onClick:r,disabled:l,className:"relative inline-flex items-center gap-3",children:[a("div",{className:`\n        w-10 h-5 rounded-full transition-colors duration-200 ml-[-48px]\n        ${e?"bg-blue-500":"bg-gray-700"}\n        ${l?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n      `,children:a("div",{className:`\n          absolute w-5 h-5 ml-6 bg-white rounded-full shadow transition-transform duration-200 transform\n          ${e?"translate-x-4 rtl:-translate-x-6":"translate-x-1 rtl:-translate-x-1"}\n          ${l?"cursor-not-allowed":"cursor-pointer"}\n        `,children:l&&a("div",{className:"absolute inset-0 flex items-center justify-center",children:a(m,{className:"w-3 h-3 text-blue-500 animate-spin"})})})}),a("span",{className:`\n        text-sm transition-colors duration-200\n        ${e?"text-blue-500":"text-gray-400"}\n        ${l?"opacity-50":""}\n      `,children:e?"نشط":"غير نشط"})]}),ea=({slide:r,onDelete:s,onUpdate:n,onToggleStatus:i,products:o,loading:c,errors:d,resetError:u})=>{const[m,g]=e.useState(!1),[h,b]=e.useState(!1),p=o.find(e=>e.id===r.productId);return t("div",{className:"bg-gray-800/30 rounded-2xl border border-gray-700/50 overflow-hidden",children:[a("div",{className:"p-4",children:t("div",{className:"flex items-start gap-4",children:[a("div",{className:"relative w-24 h-24 rounded-xl overflow-hidden group",children:a("img",{src:r.imageUrl,alt:r.title,className:"w-full h-full object-cover transition-transform duration-300\r group-hover:scale-110"})}),t("div",{className:"flex-1 min-w-0",children:[a("h3",{className:"font-bold text-white text-lg truncate",children:r.title}),p&&t("div",{className:"flex items-center gap-2 mt-1",children:[a(l,{className:"w-4 h-4 text-blue-500"}),a("span",{className:"text-sm text-gray-400",children:p.name})]}),a("div",{className:"mt-6",dir:"ltr",children:a(Ze,{checked:"active"===r.status,onChange:()=>i(r.id),disabled:c.status})})]}),a("button",{onClick:()=>g(!m),className:"p-2 rounded-xl hover:bg-gray-700/50 transition-colors",children:a(m?H:G,{className:"w-5 h-5 text-gray-400"})})]})}),m&&t("div",{className:"border-t border-gray-700/50 p-4 space-y-4",children:[r.description&&a("p",{className:"text-gray-400 text-sm",children:r.description}),t("div",{className:"flex gap-2",children:[a("button",{onClick:()=>{b(!0),u("update")},className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl\r bg-blue-500/10 text-blue-500 hover:bg-blue-500/20\r transition-colors",children:"تعديل"}),a("button",{onClick:async()=>{await s(r.id)&&g(!1)},disabled:c.delete,className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl\r bg-red-500/10 text-red-500 hover:bg-red-500/20\r transition-colors disabled:opacity-50",children:c.delete?"جاري الحذف...":"حذف"})]}),d.delete&&a("p",{className:"text-sm text-red-500 text-center",children:d.delete})]}),h&&a(la,{slide:r,onClose:()=>{b(!1),u("update")},onUpdate:async e=>{await n(r.id,e)&&b(!1)},products:o,isLoading:c.update,error:d.update})]})},aa=({onClose:r,onCreate:l,products:s,isLoading:n,error:i})=>{const[o,c]=e.useState({title:"",description:"",productId:"",image:null}),[d,u]=e.useState(null),[g,h]=e.useState("");return a("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm",children:a("div",{className:"fixed inset-x-0 bottom-0 transform transition-transform duration-300",children:t("div",{className:"bg-gray-900/95 backdrop-blur-xl rounded-t-[2.5rem] border-t \r border-gray-800/50 p-6 max-h-[90vh] overflow-y-auto",children:[a("h2",{className:"text-xl font-bold text-white mb-6",children:"إضافة عرض جديد"}),(i||g)&&a("div",{className:"mb-4 p-3 rounded-xl bg-red-500/10 text-red-500",children:i||g}),t("form",{onSubmit:async e=>{e.preventDefault(),o.image?o.title.trim()&&o.productId?await l(o)&&r():h("Please fill in all required fields"):h("Please select an image")},className:"space-y-6",children:[t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"الصورة"}),a(ta,{imagePreview:d,onChange:e=>{const a=e.target.files[0];if(a){if(!a.type.startsWith("image/"))return void h("Please select a valid image file");if(a.size>5242880)return void h("Image size should be less than 5MB");c(e=>({...e,image:a})),u(URL.createObjectURL(a)),h("")}},inputId:"create-slide-image"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"العنوان"}),a("input",{type:"text",value:o.title,onChange:e=>c(a=>({...a,title:e.target.value})),className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50",placeholder:"عنوان العرض"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"الوصف"}),a("textarea",{value:o.description,onChange:e=>c(a=>({...a,description:e.target.value})),className:"w-full h-24 bg-gray-800/50 rounded-xl p-4 text-white\r border border-gray-700/50 focus:border-blue-500/50 resize-none",placeholder:"وصف العرض"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"المنتج"}),a(ra,{value:o.productId,onChange:e=>c(a=>({...a,productId:e})),products:s})]}),t("div",{className:"flex gap-3 pt-4",children:[a("button",{type:"button",onClick:r,className:"flex-1 h-12 rounded-xl bg-gray-800/50 text-gray-400\r hover:bg-gray-700/50 transition-colors",children:"إلغاء"}),a("button",{type:"submit",disabled:n,className:"flex-1 h-12 rounded-xl bg-blue-500 text-white\r hover:bg-blue-600 transition-colors disabled:opacity-50",children:n?t("span",{className:"flex items-center justify-center gap-2",children:[a(m,{className:"w-5 h-5 animate-spin"}),"جاري الإنشاء..."]}):"إنشاء"})]})]})]})})})},ta=({imagePreview:e,onChange:r,inputId:l})=>t("div",{className:"relative",children:[a("input",{type:"file",accept:"image/*",onChange:r,className:"hidden",id:l}),a("label",{htmlFor:l,className:"block w-full aspect-video rounded-xl border-2 border-dashed\r border-gray-700/50 hover:border-blue-500/50 transition-colors\r cursor-pointer overflow-hidden",children:e?a("img",{src:e,alt:"Preview",className:"w-full h-full object-cover"}):t("div",{className:"flex flex-col items-center justify-center h-full",children:[a(Y,{className:"w-8 h-8 text-gray-400 mb-2"}),a("span",{className:"text-sm text-gray-400",children:"اختر صورة أو اسحبها هنا"})]})})]}),ra=({value:e,onChange:r,products:l})=>t("div",{className:"relative",children:[t("select",{value:e,onChange:e=>r(e.target.value),className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r appearance-none",children:[a("option",{value:"",children:"اختر منتج"}),l.map(e=>a("option",{value:e.id,children:e.name},e.id))]}),a(G,{className:"absolute left-4 top-1/2 -translate-y-1/2 \r w-5 h-5 text-gray-400 pointer-events-none"})]}),la=({slide:r,onClose:l,onUpdate:s,products:n,isLoading:i,error:o})=>{const[c,d]=e.useState({title:r.title,description:r.description||"",productId:r.productId,image:null}),[u,g]=e.useState(null),[h,b]=e.useState("");return a("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm",children:a("div",{className:"fixed inset-x-0 bottom-0 transform transition-transform duration-300",children:t("div",{className:"bg-gray-900/95 backdrop-blur-xl rounded-t-[2.5rem] border-t \r border-gray-800/50 p-6 max-h-[90vh] overflow-y-auto",children:[a("h2",{className:"text-xl font-bold text-white mb-6",children:"تعديل العرض"}),(o||h)&&a("div",{className:"mb-4 p-3 rounded-xl bg-red-500/10 text-red-500",children:o||h}),t("form",{onSubmit:async e=>{e.preventDefault(),c.title.trim()&&c.productId?await s(c)&&l():b("Please fill in all required fields")},className:"space-y-6",children:[t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"الصورة"}),a(ta,{imagePreview:u||r.imageUrl,onChange:e=>{const a=e.target.files[0];if(a){if(!a.type.startsWith("image/"))return void b("Please select a valid image file");if(a.size>5242880)return void b("Image size should be less than 5MB");d(e=>({...e,image:a})),g(URL.createObjectURL(a)),b("")}},inputId:"edit-slide-image"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"العنوان"}),a("input",{type:"text",value:c.title,onChange:e=>d(a=>({...a,title:e.target.value})),className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50",placeholder:"عنوان العرض"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"الوصف"}),a("textarea",{value:c.description,onChange:e=>d(a=>({...a,description:e.target.value})),className:"w-full h-24 bg-gray-800/50 rounded-xl p-4 text-white\r border border-gray-700/50 focus:border-blue-500/50 resize-none",placeholder:"وصف العرض"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"المنتج"}),a(ra,{value:c.productId,onChange:e=>d(a=>({...a,productId:e})),products:n})]}),c.productId&&a("div",{className:"bg-gray-800/30 rounded-xl p-4",children:a(oa,{product:n.find(e=>e.id===c.productId)})}),t("div",{className:"flex gap-3 pt-4",children:[a("button",{type:"button",onClick:l,className:"flex-1 h-12 rounded-xl bg-gray-800/50 text-gray-400\r hover:bg-gray-700/50 transition-colors",children:"إلغاء"}),a("button",{type:"submit",disabled:i,className:"flex-1 h-12 rounded-xl bg-blue-500 text-white\r hover:bg-blue-600 transition-colors disabled:opacity-50",children:i?t("span",{className:"flex items-center justify-center gap-2",children:[a(m,{className:"w-5 h-5 animate-spin"}),"جاري الحفظ..."]}):"حفظ"})]})]})]})})})},sa=()=>a("div",{className:"flex items-center justify-center py-12",children:t("div",{className:"text-center space-y-4",children:[a(m,{className:"w-8 h-8 text-blue-500 animate-spin mx-auto"}),a("p",{className:"text-gray-400",children:"جاري تحميل العروض..."})]})}),na=({message:e})=>t("div",{className:"text-center py-12",children:[a(g,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"حدث خطأ"}),a("p",{className:"text-gray-400",children:e})]}),ia=()=>t("div",{className:"text-center py-12",children:[a(Y,{className:"w-16 h-16 text-gray-700 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"لا توجد عروض"}),a("p",{className:"text-gray-400",children:"ابدأ بإضافة عروض جديدة لعرضها للعملاء"})]}),oa=({product:e})=>{if(!e)return null;const r=e.variants[0],l=r?.images[0];return t("div",{className:"flex items-start gap-3",children:[l&&a("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:a("img",{src:l,alt:e.name,className:"w-full h-full object-cover"})}),t("div",{className:"flex-1 min-w-0",children:[a("h4",{className:"font-medium text-white truncate",children:e.name}),t("div",{className:"flex items-center gap-4 mt-1",children:[t("span",{className:"text-sm text-gray-400",children:[e.variants.length," ",1===e.variants.length?"لون":"ألوان"]}),t("span",{className:"text-sm text-gray-400",children:[e.variants.reduce((e,a)=>e+a.sizes.length,0)," مقاسات"]})]})]})]})},ca=()=>{const{coupons:l,selectedCoupon:s,couponStats:i,page:o,totalPages:c,filters:d,isLoading:u,isCreating:m,isUpdating:g,isDeleting:h,isLoadingStats:b,error:x,setSelectedCoupon:y,updateFilters:v,createCoupon:f,updateCoupon:w,deleteCoupon:C,nextPage:S,previousPage:P}=(()=>{const[a,t]=e.useState([]),[r,l]=e.useState(0),[s,n]=e.useState(null),[i,o]=e.useState(null),[c,d]=e.useState(1),[u,m]=e.useState(0),[g,h]=e.useState(20),[b,p]=e.useState({status:"",search:"",type:"all",isSpecific:null}),x={ALL:"all",ACTIVE:"active",EXPIRED:"expired",PERCENTAGE:"percentage",FIXED:"fixed"},[y,v]=e.useState(!1),[f,N]=e.useState(!1),[w,C]=e.useState(!1),[k,S]=e.useState(!1),[P,E]=e.useState(!1),[j,$]=e.useState(null),[D,U]=e.useState(null),{apiCall:L}=ie(),F=e.useCallback(async(e=c)=>{v(!0),$(null);try{const a={...b,type:b.type===x.ALL?"":b.type},r=new URLSearchParams({page:e,perPage:g,...a}).toString(),s=await L(`/admin/coupons?${r}`);return s&&(t(s.coupons),l(s.total),m(s.pages)),s}catch(a){return $(a.message),null}finally{v(!1)}},[L,c,g,b]),O=async()=>{E(!0),U(null);try{const e=await L("/admin/coupons/stats");return e&&o(e),e}catch(e){return U(e.message),null}finally{E(!1)}},z=e.useCallback(e=>{p(a=>({...a,...e})),d(1)},[]),I=e.useCallback(()=>{c<u&&d(e=>e+1)},[c,u]),R=e.useCallback(()=>{c>1&&d(e=>e-1)},[c]);return e.useEffect(()=>{F()},[c,b,F]),e.useEffect(()=>{O();const e=setInterval(O,3e5);return()=>clearInterval(e)},[]),{coupons:a,totalCoupons:r,selectedCoupon:s,couponStats:i,COUPON_TYPES:x,page:c,totalPages:u,perPage:g,filters:b,isLoading:y,isCreating:f,isUpdating:w,isDeleting:k,isLoadingStats:P,error:j,statsError:D,setSelectedCoupon:n,setPage:d,setPerPage:h,updateFilters:z,loadCoupons:F,createCoupon:async e=>{N(!0),$(null);try{const a=await L("/admin/coupons",{method:"POST",body:JSON.stringify(e)});return await F(),a}catch(a){throw $(a.message),a}finally{N(!1)}},updateCoupon:async(e,a)=>{C(!0),$(null);try{const t=await L(`/admin/coupons/${e}`,{method:"PUT",body:JSON.stringify(a)});return await F(),t}catch(t){throw $(t.message),t}finally{C(!1)}},deleteCoupon:async e=>{S(!0),$(null);try{const a=await L(`/admin/coupons/${e}`,{method:"DELETE"});return await F(),a}catch(a){throw $(a.message),a}finally{S(!1)}},loadCouponStats:O,nextPage:I,previousPage:R}})(),[E,j]=e.useState(!1),[$,D]=e.useState(!1);return t("div",{className:"min-h-screen bg-secondary-900 pb-20",children:[i&&t("div",{className:"p-4 grid grid-cols-2 gap-4",children:[a(da,{title:"القسائم النشطة",value:i.activeCoupons,icon:Z,color:"emerald"}),a(da,{title:"إجمالي التوفير",value:`${i.totalDiscountGiven.toLocaleString("ar-EG")} جنيه`,icon:r,color:"blue"}),a(da,{title:"معدل الاستخدام",value:`${(i.totalUsedCoupons/i.totalCoupons*100).toFixed(1)}%`,icon:L,color:"amber"}),a(da,{title:"قسائم منتهية",value:i.expiredCoupons,icon:I,color:"red"})]}),t("div",{className:"sticky top-0 z-30 bg-secondary-900/95 backdrop-blur-sm p-4 space-y-4",children:[t("div",{className:"relative",children:[a("input",{type:"text",value:d.search,onChange:e=>v({search:e.target.value}),placeholder:"ابحث برمز القسيمة أو رقم الهاتف...",className:"w-full h-12 bg-gray-800/50 rounded-xl px-12 text-white text-right\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50\r placeholder:text-gray-500",dir:"rtl"}),a(k,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),d.search&&a("button",{onClick:()=>v({search:""}),className:"absolute right-4 top-1/2 -translate-y-1/2 p-1 rounded-full\r hover:bg-gray-700/50 transition-colors",children:a(p,{className:"w-4 h-4 text-gray-400"})})]}),a("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar py-2",dir:"rtl",children:[{id:"all",label:"الكل",icon:Z},{id:"active",label:"نشط",icon:z},{id:"expired",label:"منتهي",icon:F},{id:"percentage",label:"نسبة مئوية",icon:ee},{id:"fixed",label:"قيمة ثابتة",icon:ae},{id:"specific",label:"مستخدمين محددين",icon:n}].map(({id:e,label:r,icon:l})=>t("button",{onClick:()=>v({type:e}),className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm\n                       whitespace-nowrap transition-colors\n                       "+(d.type===e?"bg-blue-500 text-white":"bg-gray-800/50 text-gray-400 hover:bg-gray-700/50"),children:[a(l,{className:"w-4 h-4"}),a("span",{children:r})]},e))}),t("div",{className:"flex gap-2",children:[t("button",{onClick:()=>j(!0),className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl\r bg-blue-500 text-white font-medium hover:bg-blue-600\r transition-colors",children:[a(N,{className:"w-5 h-5"}),a("span",{children:"إنشاء قسيمة"})]}),a("button",{onClick:()=>D(!0),className:"p-3 rounded-xl bg-gray-800/50 text-gray-400\r hover:bg-gray-700/50 transition-colors",children:a(te,{className:"w-5 h-5"})})]})]}),a("div",{className:"p-4 space-y-4",children:u?a(pa,{}):x?a(xa,{message:x}):0===l.length?a(ya,{}):l.map(e=>a(ua,{coupon:e,onClick:()=>y(e),onEdit:()=>{},onDelete:()=>C(e.id)},e.id))}),E&&a(ma,{isOpen:E,onClose:()=>j(!1),onCreate:f,isCreating:m}),s&&a(ga,{coupon:s,isOpen:!!s,onClose:()=>y(null),onUpdate:w,onDelete:C,isUpdating:g,isDeleting:h}),$&&a(ha,{stats:i,isOpen:$,onClose:()=>D(!1),isLoading:b}),c>1&&a("div",{className:"fixed bottom-0 inset-x-0 bg-gray-900/95 backdrop-blur-xl \r border-t border-gray-800/50 p-4",children:t("div",{className:"flex justify-between items-center max-w-lg mx-auto",children:[a("button",{onClick:P,disabled:o<=1,className:"p-2 rounded-xl bg-gray-800/50 text-gray-400\r disabled:opacity-50 disabled:cursor-not-allowed\r hover:bg-gray-700/50 transition-colors",children:"السابق"}),t("span",{className:"text-gray-400",children:["صفحة ",o," من ",c]}),a("button",{onClick:S,disabled:o>=c,className:"p-2 rounded-xl bg-gray-800/50 text-gray-400\r disabled:opacity-50 disabled:cursor-not-allowed\r hover:bg-gray-700/50 transition-colors",children:"التالي"})]})})]})},da=({title:e,value:r,icon:l,color:s})=>t("div",{className:`relative overflow-hidden rounded-2xl p-4 \n                 bg-${s}-500/10 border border-${s}-500/20`,children:[a("div",{className:"absolute top-4 right-4",children:a(l,{className:`w-6 h-6 text-${s}-500`})}),t("div",{className:"mt-6",children:[a("h3",{className:"text-sm font-medium text-gray-400",children:e}),a("div",{className:"mt-2",children:a("span",{className:`text-2xl font-bold text-${s}-500`,children:r})})]})]}),ua=({coupon:e,onClick:r,onEdit:l,onDelete:s})=>{const i=new Date(e.endDate)<new Date,o="active"===e.status&&!i;return t("div",{onClick:r,className:"group bg-gray-800/30 rounded-2xl p-4 space-y-4 cursor-pointer\r border border-gray-700/50 hover:border-blue-500/30\r transition-all duration-300",children:[t("div",{className:"flex justify-between items-start",children:[t("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm\n                      "+(o?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:[a(o?z:F,{className:"w-4 h-4"}),a("span",{children:o?"نشط":"منتهي"})]}),t("div",{className:"text-right",children:[t("div",{className:"flex items-center gap-2",children:[a("button",{onClick:async a=>{a.stopPropagation();try{await navigator.clipboard.writeText(e.code)}catch(t){}},className:"p-1 rounded-lg bg-gray-800/50 hover:bg-blue-500/10\r border border-transparent hover:border-blue-500/30\r transition-all duration-300",children:a(A,{className:"w-4 h-4 text-blue-500"})}),a("h3",{className:"font-bold text-white group-hover:text-blue-500\r transition-colors",children:e.code})]}),a("p",{className:"text-sm text-gray-400 mt-1",children:new Date(e.endDate).toLocaleDateString("ar-EG")})]})]}),t("div",{className:"flex items-center justify-between pt-4 border-t border-gray-700/50",children:[t("div",{className:"flex items-center gap-2",children:["percentage"===e.discountType?a(ee,{className:"w-5 h-5 text-blue-500"}):a(ae,{className:"w-5 h-5 text-blue-500"}),t("span",{className:"text-white font-medium",children:[e.discountValue,"percentage"===e.discountType?"%":" جنيه"]})]}),t("div",{className:"flex items-center gap-2 text-gray-400",children:[a(n,{className:"w-5 h-5"}),t("span",{children:[e.usedCount,"/",e.maxUses||"∞"]})]})]})]})},ma=({isOpen:r,onClose:l,onCreate:s,isCreating:n})=>{const[i,o]=e.useState({code:"",discountType:"percentage",discountValue:"",maxUses:"",startDate:(new Date).toISOString().split("T")[0],endDate:"",specificUsers:[]});return a(ba,{isOpen:r,onClose:l,children:t("div",{className:"p-6 space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[a("button",{onClick:l,className:"p-2 -m-2 rounded-full hover:bg-gray-800/50 transition-colors",children:a(G,{className:"w-6 h-6 text-gray-400"})}),a("h2",{className:"text-xl font-bold text-white",children:"إنشاء قسيمة جديدة"}),a("div",{className:"w-10"})]}),t("form",{onSubmit:async e=>{e.preventDefault();try{await s(i),l()}catch(a){}},className:"space-y-6",children:[t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"رمز القسيمة"}),a("input",{type:"text",value:i.code,onChange:e=>o({...i,code:e.target.value.toUpperCase()}),placeholder:"SALE2025",className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50",dir:"ltr"}),a("p",{className:"text-xs text-gray-500",children:"اتركه فارغاً لإنشاء رمز تلقائي"})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"نوع الخصم"}),t("select",{value:i.discountType,onChange:e=>o({...i,discountType:e.target.value}),className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50",children:[a("option",{value:"percentage",children:"نسبة مئوية"}),a("option",{value:"fixed",children:"قيمة ثابتة"})]})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"قيمة الخصم"}),t("div",{className:"relative",children:[a("input",{type:"number",value:i.discountValue,onChange:e=>o({...i,discountValue:e.target.value}),placeholder:"percentage"===i.discountType?"10":"100",className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50"}),a("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:"percentage"===i.discountType?"%":"جنيه"})]})]})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"الحد الأقصى للاستخدام"}),a("input",{type:"number",value:i.maxUses,onChange:e=>o({...i,maxUses:e.target.value}),placeholder:"اتركه فارغاً للاستخدام غير المحدود",className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50"})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"تاريخ البدء"}),a("input",{type:"date",value:i.startDate,onChange:e=>o({...i,startDate:e.target.value}),className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50"})]}),t("div",{className:"space-y-2",children:[a("label",{className:"block text-sm font-medium text-gray-400",children:"تاريخ الانتهاء"}),a("input",{type:"date",value:i.endDate,onChange:e=>o({...i,endDate:e.target.value}),className:"w-full h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50"})]})]}),t("div",{className:"space-y-4",children:[t("div",{className:"flex justify-between items-center",children:[a("h3",{className:"text-sm font-medium text-gray-400",children:"مستخدمين محددين"}),a("button",{type:"button",onClick:()=>o({...i,specificUsers:[...i.specificUsers,{phone:"",maxUses:""}]}),className:"text-sm text-blue-500 hover:text-blue-400 transition-colors",children:"إضافة مستخدم"})]}),i.specificUsers.map((e,r)=>t("div",{className:"flex gap-4",children:[a("input",{type:"tel",value:e.phone,onChange:e=>{const a=[...i.specificUsers];a[r].phone=e.target.value,o({...i,specificUsers:a})},placeholder:"رقم الهاتف",className:"flex-1 h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50",dir:"ltr"}),a("input",{type:"number",value:e.maxUses,onChange:e=>{const a=[...i.specificUsers];a[r].maxUses=e.target.value,o({...i,specificUsers:a})},placeholder:"عدد مرات الاستخدام",className:"w-32 h-12 bg-gray-800/50 rounded-xl px-4 text-white\r border border-gray-700/50 focus:border-blue-500/50\r focus:ring-2 focus:ring-blue-500/50"}),a("button",{type:"button",onClick:()=>{const e=i.specificUsers.filter((e,a)=>a!==r);o({...i,specificUsers:e})},className:"p-3 rounded-xl bg-red-500/10 text-red-500\r hover:bg-red-500/20 transition-colors",children:a(p,{className:"w-6 h-6"})})]},r))]}),a("button",{type:"submit",disabled:n,className:"w-full p-4 rounded-xl bg-blue-500 text-white font-medium\r hover:bg-blue-600 transition-colors disabled:opacity-50\r disabled:cursor-not-allowed",children:n?t("div",{className:"flex items-center justify-center gap-2",children:[a(m,{className:"w-5 h-5 animate-spin"}),a("span",{children:"جاري الإنشاء..."})]}):"إنشاء القسيمة"})]})]})})},ga=({coupon:r,isOpen:l,onClose:s,onUpdate:i,onDelete:o,isUpdating:c,isDeleting:d})=>{const[u,g]=e.useState(!1),[h,b]=e.useState(r);return a(ba,{isOpen:l,onClose:s,children:t("div",{className:"p-6 space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[a("button",{onClick:s,className:"p-2 -m-2 rounded-full hover:bg-gray-800/50 transition-colors",children:a(G,{className:"w-6 h-6 text-gray-400"})}),a("h2",{className:"text-xl font-bold text-white",children:"تفاصيل القسيمة"}),a("button",{onClick:()=>g(!u),className:"p-2 -m-2 rounded-full hover:bg-gray-800/50 transition-colors",children:a(j,{className:"w-6 h-6 text-gray-400"})})]}),u?a("form",{onSubmit:async e=>{e.preventDefault();try{await i(r.id,h),g(!1)}catch(a){}},className:"space-y-6",children:t("div",{className:"flex gap-4",children:[a("button",{type:"submit",disabled:c,className:"flex-1 p-4 rounded-xl bg-blue-500 text-white font-medium\r hover:bg-blue-600 transition-colors disabled:opacity-50\r disabled:cursor-not-allowed",children:c?t("div",{className:"flex items-center justify-center gap-2",children:[a(m,{className:"w-5 h-5 animate-spin"}),a("span",{children:"جاري التحديث..."})]}):"حفظ التغييرات"}),a("button",{type:"button",onClick:()=>g(!1),className:"p-4 rounded-xl bg-gray-800/50 text-gray-400\r hover:bg-gray-700/50 transition-colors",children:"إلغاء"})]})}):t(U,{children:[a("div",{className:"bg-gray-800/30 rounded-2xl p-4",children:t("div",{className:"flex justify-between items-center",children:[a("button",{onClick:async()=>{try{await navigator.clipboard.writeText(r.code)}catch(e){}},className:"p-2 rounded-xl bg-gray-800/50 hover:bg-blue-500/10\r border border-transparent hover:border-blue-500/30\r transition-all duration-300",children:a(A,{className:"w-5 h-5 text-blue-500"})}),t("div",{className:"text-right",children:[a("h3",{className:"text-2xl font-bold text-white",children:r.code}),a("p",{className:"text-sm text-gray-400 mt-1",children:"رمز القسيمة"})]})]})}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"bg-gray-800/30 rounded-2xl p-4",children:[t("div",{className:"flex items-center gap-2",children:["percentage"===r.discountType?a(ee,{className:"w-5 h-5 text-blue-500"}):a(ae,{className:"w-5 h-5 text-blue-500"}),t("span",{className:"text-lg font-bold text-white",children:[r.discountValue,"percentage"===r.discountType?"%":" جنيه"]})]}),a("p",{className:"text-sm text-gray-400 mt-1",children:"قيمة الخصم"})]}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4",children:[t("div",{className:"flex items-center gap-2",children:[a(n,{className:"w-5 h-5 text-blue-500"}),t("span",{className:"text-lg font-bold text-white",children:[r.usedCount,"/",r.maxUses||"∞"]})]}),a("p",{className:"text-sm text-gray-400 mt-1",children:"عدد مرات الاستخدام"})]})]}),a("div",{className:"bg-gray-800/30 rounded-2xl p-4 space-y-4",children:t("div",{className:"flex items-start gap-3",children:[a(K,{className:"w-5 h-5 text-blue-500 mt-1"}),t("div",{className:"flex-1",children:[a("h4",{className:"font-medium text-white",children:"المدة الزمنية"}),t("div",{className:"mt-2 space-y-2",children:[t("div",{className:"flex justify-between text-sm",children:[a("span",{className:"text-gray-400",children:"تاريخ البدء:"}),a("span",{className:"text-white",children:new Date(r.startDate).toLocaleDateString("ar-EG")})]}),t("div",{className:"flex justify-between text-sm",children:[a("span",{className:"text-gray-400",children:"تاريخ الانتهاء:"}),a("span",{className:"text-white",children:new Date(r.endDate).toLocaleDateString("ar-EG")})]})]})]})]})}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4 space-y-4",children:[a("h4",{className:"font-medium text-white",children:"إحصائيات الاستخدام"}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"space-y-1",children:[a("p",{className:"text-sm text-gray-400",children:"إجمالي التوفير"}),t("p",{className:"text-lg font-bold text-blue-500",children:[r.totalDiscountGiven?.toLocaleString("ar-EG")," جنيه"]})]}),t("div",{className:"space-y-1",children:[a("p",{className:"text-sm text-gray-400",children:"متوسط التوفير"}),t("p",{className:"text-lg font-bold text-blue-500",children:[(r.totalDiscountGiven/r.usedCount||0).toLocaleString("ar-EG")," جنيه"]})]})]})]}),r.recentUsage?.length>0&&t("div",{className:"space-y-4",children:[a("h4",{className:"font-medium text-white",children:"آخر الاستخدامات"}),a("div",{className:"space-y-3",children:r.recentUsage.map((e,r)=>t("div",{className:"bg-gray-800/30 rounded-xl p-3 flex justify-between items-center",children:[t("span",{className:"text-blue-500 font-medium",children:[e.discountAmount.toLocaleString("ar-EG")," جنيه"]}),t("div",{className:"text-right",children:[a("p",{className:"text-sm text-white",children:e.orderId}),a("p",{className:"text-xs text-gray-400",children:new Date(e.usedAt).toLocaleString("ar-EG")})]})]},r))})]}),r.specificUsers?.length>0&&t("div",{className:"space-y-4",children:[a("h4",{className:"font-medium text-white",children:"المستخدمون المحددون"}),a("div",{className:"space-y-3",children:r.specificUsers.map((e,r)=>t("div",{className:"bg-gray-800/30 rounded-xl p-3 flex justify-between items-center",children:[t("div",{className:"flex items-center gap-2",children:[a(n,{className:"w-5 h-5 text-blue-500"}),t("span",{className:"text-white",children:[e.usedCount,"/",e.maxUses||"∞"]})]}),a("span",{className:"text-gray-400 dir-ltr",children:e.phone})]},r))})]}),a("button",{onClick:async()=>{if(window.confirm("هل أنت متأكد من حذف هذه القسيمة؟"))try{await o(r.id),s()}catch(e){}},disabled:d,className:"w-full p-4 rounded-xl bg-red-500/10 text-red-500\r hover:bg-red-500/20 transition-colors disabled:opacity-50\r disabled:cursor-not-allowed",children:d?t("div",{className:"flex items-center justify-center gap-2",children:[a(m,{className:"w-5 h-5 animate-spin"}),a("span",{children:"جاري الحذف..."})]}):"حذف القسيمة"})]})]})})},ha=({stats:e,isOpen:r,onClose:l,isLoading:s})=>e||s?a(ba,{isOpen:r,onClose:l,children:t("div",{className:"p-6 space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[a("button",{onClick:l,className:"p-2 -m-2 rounded-full hover:bg-gray-800/50 transition-colors",children:a(G,{className:"w-6 h-6 text-gray-400"})}),a("h2",{className:"text-xl font-bold text-white",children:"إحصائيات القسائم"}),a("div",{className:"w-10"})]}),s?a(pa,{}):t(U,{children:[t("div",{className:"grid grid-cols-2 gap-4",children:[a(da,{title:"القسائم النشطة",value:e.activeCoupons,icon:z,color:"emerald"}),a(da,{title:"إجمالي التوفير",value:`${e.totalDiscountGiven.toLocaleString("ar-EG")} جنيه`,icon:D,color:"blue"}),a(da,{title:"معدل الاستخدام",value:`${(e.totalUsedCoupons/e.totalCoupons*100).toFixed(1)}%`,icon:L,color:"amber"}),a(da,{title:"قسائم منتهية",value:e.expiredCoupons,icon:I,color:"red"})]}),t("div",{className:"bg-gray-800/30 rounded-2xl p-4 space-y-4",children:[a("h4",{className:"font-medium text-white",children:"توزيع أنواع القسائم"}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-between items-center",children:[a("span",{className:"text-gray-400",children:"نسبة مئوية"}),a("span",{className:"text-white",children:e.couponsByType.percentage})]}),a("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:a("div",{className:"h-full bg-blue-500 rounded-full",style:{width:e.couponsByType.percentage/e.totalCoupons*100+"%"}})})]}),t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-between items-center",children:[a("span",{className:"text-gray-400",children:"قيمة ثابتة"}),a("span",{className:"text-white",children:e.couponsByType.fixed})]}),a("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:a("div",{className:"h-full bg-green-500 rounded-full",style:{width:e.couponsByType.fixed/e.totalCoupons*100+"%"}})})]})]})]}),e.recentActivities?.length>0&&t("div",{className:"space-y-4",children:[a("h4",{className:"font-medium text-white",children:"آخر النشاطات"}),a("div",{className:"space-y-3",children:e.recentActivities.map((e,r)=>t("div",{className:"bg-gray-800/30 rounded-xl p-3 flex justify-between items-center",children:[t("span",{className:"text-blue-500 font-medium",children:[e.discountAmount.toLocaleString("ar-EG")," جنيه"]}),t("div",{className:"text-right",children:[a("p",{className:"text-sm text-white",children:e.couponCode}),a("p",{className:"text-xs text-gray-400 dir-ltr",children:e.userPhone}),a("p",{className:"text-xs text-gray-500",children:new Date(e.usedAt).toLocaleString("ar-EG")})]})]},r))})]})]})]})}):null,ba=y.memo(({isOpen:r,onClose:l,children:s})=>(e.useEffect(()=>(document.body.style.overflow=r?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[r]),r?t("div",{className:"fixed inset-0 z-50",children:[a("div",{className:"absolute inset-0 bg-black/60",onClick:l,style:{backdropFilter:"blur(4px)"}}),a("div",{className:"fixed inset-x-0 bottom-0",style:{transform:"translateY(0)",willChange:"transform"},children:t("div",{className:"bg-gradient-to-b from-secondary-900/95 to-secondary-900 \r rounded-t-[2.5rem] border-t border-secondary-800/50 shadow-2xl\r max-h-[90vh] overflow-y-auto hide-scrollbar",children:[a("div",{className:"flex justify-center pt-3 pb-1",children:a("div",{className:"w-12 h-1 rounded-full bg-secondary-700/50"})}),s]})})]}):null)),pa=()=>a("div",{className:"flex items-center justify-center py-12",children:t("div",{className:"space-y-4 text-center",children:[a(m,{className:"w-8 h-8 text-blue-500 animate-spin mx-auto"}),a("p",{className:"text-gray-400",children:"جاري تحميل القسائم..."})]})}),xa=({message:e})=>t("div",{className:"text-center py-12",children:[a(g,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"حدث خطأ"}),a("p",{className:"text-gray-400",children:e})]}),ya=()=>t("div",{className:"text-center py-12",children:[a(Z,{className:"w-16 h-16 text-gray-700 mx-auto mb-4"}),a("h3",{className:"text-xl font-bold text-white mb-2",children:"لا توجد قسائم"}),a("p",{className:"text-gray-400",children:"قم بإنشاء قسيمة جديدة للبدء"})]}),va=()=>{const[r,l]=e.useState("analytics"),{token:s,isInitialized:n,loading:i,error:o}=ie();return!n||i?a("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:t("div",{className:"text-center space-y-6 p-8 rounded-2xl bg-gray-800/50 backdrop-blur-xl border border-gray-700/50",children:[t("div",{className:"relative",children:[a(m,{className:"w-16 h-16 text-blue-500 animate-spin mx-auto"}),a("div",{className:"absolute inset-0 rounded-full bg-blue-500/20 animate-ping"})]}),a("p",{className:"text-gray-300 text-lg font-medium",children:"جاري تحميل لوحة التحكم..."})]})}):o?a("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:t("div",{className:"text-center space-y-6 p-8 rounded-2xl bg-gray-800/50 backdrop-blur-xl border border-gray-700/50 max-w-md",children:[t("div",{className:"relative",children:[a(g,{className:"w-20 h-20 text-red-500 mx-auto"}),a("div",{className:"absolute inset-0 rounded-full bg-red-500/20 animate-pulse"})]}),a("h1",{className:"text-2xl font-bold text-white",children:"عذراً، حدث خطأ ما"}),a("p",{className:"text-gray-400 leading-relaxed",children:o})]})}):s?t("div",{className:"min-h-screen bg-gray-900 text-white relative",children:[a("nav",{className:"fixed top-0 inset-x-0 z-50 bg-gray-900/95 backdrop-blur-xl \r border-b border-gray-800/50 shadow-2xl shadow-black/20",children:a("div",{className:"px-4 py-4",children:a("div",{className:"flex justify-between items-center",children:[{id:"analytics",icon:te,label:"التحليلات"},{id:"products",icon:E,label:"المنتجات"},{id:"orders",icon:le,label:"الطلبات"},{id:"customers",icon:se,label:"العملاء"},{id:"slides",icon:Y,label:"العروض"},{id:"coupons",icon:Z,label:"كوبون"}].map(({id:e,icon:s,label:n})=>t("button",{onClick:()=>l(e),className:"flex flex-col items-center gap-2 py-3 px-4 rounded-xl\n                         transition-all duration-300 relative group\n                         "+(r===e?"text-blue-400 bg-blue-500/10 border border-blue-500/20":"text-gray-400 hover:text-gray-300 hover:bg-gray-800/50"),children:[t("div",{className:"relative",children:[a(s,{className:"w-6 h-6 transition-all duration-300\n                                "+(r===e?"scale-110 text-blue-400":"group-hover:scale-110")}),r===e&&a("div",{className:"absolute -inset-1 bg-blue-500/20 rounded-full blur-sm"})]}),a("span",{className:"text-xs font-medium transition-all duration-300\n                              "+(r===e?"text-blue-400 transform scale-105":"text-gray-400 group-hover:text-gray-300"),children:n}),r===e&&a("span",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-8 h-0.5 \r rounded-full bg-gradient-to-r from-blue-400 to-blue-600"})]},e))})})}),a("main",{className:"pt-32 pb-8 bg-gradient-to-b from-gray-900 via-gray-900 to-gray-950",children:(()=>{switch(r){case"analytics":return a(ce,{});case"products":return a(ve,{});case"orders":return a(Le,{});case"customers":return a(Me,{});case"slides":return a(He,{});case"coupons":return a(ca,{});default:return a(te,{})}})()})]}):a("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:t("div",{className:"text-center space-y-6 p-8 rounded-2xl bg-gray-800/50 backdrop-blur-xl border border-gray-700/50 max-w-md",children:[a("div",{className:"w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:a(re,{className:"w-10 h-10 text-white"})}),a("h1",{className:"text-2xl font-bold text-white",children:"تسجيل الدخول مطلوب"}),a("p",{className:"text-gray-400 leading-relaxed",children:"يرجى تسجيل الدخول للوصول إلى لوحة التحكم"})]})})};export{va as default};
