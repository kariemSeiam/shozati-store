import{r as e,ac as t,P as a,ad as r,ae as s,x as l,K as i,af as n,ag as o,ah as c,ai as d,aj as u,a1 as m,ak as h,g as p,c as g,L as y,al as b,am as f,f as x,an as v,ao as w,ap as N,S as k,aq as C,ar as S,M as P,y as O,as as j,at as I,t as T,X as E,au as A,av as $,l as z,aw as L,ax as F,ay as M,h as D,az as q,aA as H,z as R,u as X,J as U,A as _,Z as V,p as Y,aB as J,aC as B,aD as G,aE as Q}from"./vendor-react-Dx-tgV8r.js";import{j as W,a as Z,F as K}from"./admin-D3pT9HIN.js";const ee="https://shozati.pythonanywhere.com/api",te="token",ae="userPhone",re="authData",se=e=>{localStorage.setItem(re,JSON.stringify(e))},le=()=>localStorage.getItem(te),ie=()=>localStorage.getItem(ae),ne=()=>{localStorage.removeItem(te),localStorage.removeItem(ae),localStorage.removeItem(re)},oe=(e=!1)=>{const t={"Content-Type":"application/json"};if(e){const e=le();e&&(t.Authorization=`Bearer ${e}`)}return t},ce=new Map,de=async(e,t={},a=!1)=>{const r=((e,t)=>{const{method:a="GET",body:r}=t;return`${a}-${e}-${r?JSON.stringify(r):""}`})(e,t),s=ce.get(r),l=Date.now();if(s&&l-s.timestamp<1e3)return s.data;try{const s=await fetch(`${ee}${e}`,{...t,credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",...t.headers,...oe(a)},mode:"cors"});if(!s.ok){const e=await s.json();throw new Error(e.message||"Network response was not ok")}const i=await s.json();return ce.set(r,{data:i,timestamp:l}),i}catch(i){throw"Token is invalid or expired"===i.message&&(ne(),window.location.href="/login"),i}},ue=e.createContext({isAuthenticated:!1,userInfo:null,phone:null,login:()=>{},logout:()=>{},updateProfile:()=>{},addAddress:()=>{},updateAddress:()=>{},loading:!0}),me=e.createContext({cart:[],isCartOpen:!1,setIsCartOpen:()=>{},addToCart:()=>{},removeFromCart:()=>{},updateQuantity:()=>{},emptyCart:()=>{},cartTotal:0}),he=e=>e?.response?.data?.message?e.response.data.message:"An error occurred. Please try again.",pe=()=>{const[a,r]=e.useState(!1),[s,l]=e.useState(null),[i,n]=e.useState(null),{isAuthenticated:o}=e.useContext(ue),c=e.useRef(null),d=e.useRef({validations:new Map,expiryTime:3e5}),u=e.useCallback(()=>{n(null)},[]),m=e.useCallback((e,t)=>{const a=`${e}-${t}`,r=d.current.validations.get(a);return!!r&&!(Date.now()-r.timestamp>d.current.expiryTime&&(d.current.validations.delete(a),1))},[]),h=e.useCallback((e,t)=>{const a=`${e}-${t}`;return d.current.validations.get(a)?.data},[]),p=e.useCallback((e,t,a)=>{const r=`${e}-${t}`;d.current.validations.set(r,{data:a,timestamp:Date.now()})},[]),g=e.useCallback(async(e,a)=>{if(!o)return t.error("Please login first"),null;if(!e||!a)return n("Invalid coupon or subtotal"),null;if(c.current&&c.current.abort(),m(e,a)){const t=h(e,a);return l(t),t}r(!0),n(null);try{const t=new AbortController;c.current=t;const r=await de("/coupons/validate",{method:"POST",body:JSON.stringify({code:e.trim(),subtotal:a}),signal:t.signal},!0);return p(e,a,r),n(r),l(r),n(null),r}catch(s){if("AbortError"===s.name)return null;const e=s.message||"Failed to validate coupon";return n(e),l(null),t.error(e),null}finally{r(!1),c.current=null}},[o,m,h,p]),y=e.useCallback(e=>s?"percentage"===s.discountType?Math.round(e*s.discountValue/100*100)/100:Math.min(s.discountValue,e):0,[s]),b=e.useCallback(()=>{l(null),n(null)},[]);return e.useEffect(()=>{o||(b(),d.current.validations.clear())},[o,b]),{currentCoupon:s,validatingCoupon:a,error:i,validateCoupon:g,calculateDiscount:y,clearCoupon:b,clearError:u}},ge=(t={})=>{const[a,r]=e.useState([]),[s,l]=e.useState(null),[i,n]=e.useState(0),[o,c]=e.useState(0),[d,u]=e.useState(1),[m]=e.useState(150),[h,p]=e.useState({category:"all",search:"",minPrice:null,maxPrice:null,size:"",color:"",code:"",sort:"popular"}),[g,y]=e.useState({isLoading:!1,isCreating:!1,isUpdating:!1,isDeleting:!1,isUploadingImages:!1}),[b,f]=e.useState({fetchError:null,createError:null,updateError:null,deleteError:null,uploadError:null}),x=e.useRef(null),v=e.useRef(new Map),w=e.useCallback((e,t)=>{y(a=>({...a,[e]:t}))},[]),N=e.useCallback((e,t)=>{f(a=>({...a,[e]:t}))},[]),k=e.useCallback(async(e,t={})=>{x.current&&x.current.abort(),x.current=new AbortController;const a={"Content-Type":"application/json",...t.headers||{}};try{const r=e.startsWith("/")?e.slice(1):e,s=`${ee}/${r}`,l=await fetch(s,{...t,headers:a,signal:x.current.signal});if(!l.ok){const e=await l.json().catch(()=>({message:"Unknown error occurred"}));throw new Error(e.message||"API request failed")}return await l.json()}catch(r){if("AbortError"===r.name)return null;throw r}},[]),C=e.useCallback((e,t)=>JSON.stringify({page:e,...t}),[]),S=e.useCallback(async(e=d,t=h)=>{w("isLoading",!0),N("fetchError",null);const a=C(e,t);try{if(v.current.has(a)){const e=v.current.get(a);return r(e.products),n(e.total),c(e.pages),e}const s=new URLSearchParams({page:e,..."all"!==t.category&&{category:t.category},...t.search&&{search:t.search},...t.minPrice&&{minPrice:t.minPrice},...t.maxPrice&&{maxPrice:t.maxPrice},...t.size&&{size:t.size},...t.color&&{color:t.color},...t.code&&{code:t.code},...t.sort&&{sort:t.sort}}).toString(),l=await k(`products?${s}`);if(l)return r(l.products),n(l.total),c(l.pages),v.current.set(a,l),l}catch(s){return N("fetchError",s.message),null}finally{w("isLoading",!1)}},[k,h,C,d,N,w]),P=e.useCallback(async e=>{w("isCreating",!0),N("createError",null);try{const t=await k("/admin/products",{method:"POST",body:JSON.stringify(e)});return t&&(v.current.clear(),await S()),t}catch(t){return N("createError",t.message),null}finally{w("isCreating",!1)}},[k,S,N,w]),O=e.useCallback(async(e,t)=>{w("isUpdating",!0),N("updateError",null);try{const a=await k(`admin/products/${e}`,{method:"PUT",body:JSON.stringify(t)});return a&&(v.current.clear(),await S()),a}catch(a){return N("updateError",a.message),null}finally{w("isUpdating",!1)}},[k,S,N,w]),j=e.useCallback(async e=>{w("isDeleting",!0),N("deleteError",null);try{const t=await k(`admin/products/${e}`,{method:"DELETE"});return t&&(v.current.clear(),await S()),t}catch(t){return N("deleteError",t.message),null}finally{w("isDeleting",!1)}},[k,S,N,w]),I=e.useCallback(async(e,t,a)=>{w("isUploadingImages",!0),N("uploadError",null);try{const r=new FormData;r.append("productCode",e),r.append("colorName",t),a.forEach(e=>{r.append("images",e)});const s=await k("/admin/products/upload-images",{method:"POST",body:r,headers:{"Content-Type":void 0}});return s?.imageUrls||[]}catch(r){return N("uploadError",r.message),[]}finally{w("isUploadingImages",!1)}},[k,N,w]),T=e.useCallback(async(e,t)=>{w("isUpdating",!0),N("updateError",null);try{const a=await k(`admin/products/${e}/inventory`,{method:"PUT",body:JSON.stringify(t)});return a&&(v.current.clear(),await S()),a}catch(a){return N("updateError",a.message),null}finally{w("isUpdating",!1)}},[k,S,N,w]),E=e.useCallback(e=>{p(t=>{const a={...t,...e};return JSON.stringify(t)!==JSON.stringify(a)&&u(1),a})},[]),A=e.useCallback(()=>{d<o&&u(e=>e+1)},[d,o]),$=e.useCallback(()=>{d>1&&u(e=>e-1)},[d]);return e.useEffect(()=>{S()},[S,d,h]),e.useEffect(()=>()=>{x.current&&x.current.abort(),v.current.clear()},[]),{products:a,selectedProduct:s,totalProducts:i,totalPages:o,page:d,perPage:m,filters:h,...g,...b,setSelectedProduct:l,setPage:u,updateFilters:E,fetchProducts:S,createProduct:P,updateProduct:O,deleteProduct:j,uploadProductImages:I,updateInventory:T,nextPage:A,previousPage:$}},ye=()=>{const[a,r]=e.useState([]),[s,l]=e.useState(!1),[i,n]=e.useState(null),[o,c]=e.useState({currentPage:1,totalPages:1,hasMore:!1}),{isAuthenticated:d}=e.useContext(ue),u=e.useCallback(async(e=1)=>{if(!d)return r([]),void l(!1);try{l(!0);const t=await de(`/orders?page=${e}`,{},!0);r(a=>e>1?[...a,...t.orders]:t.orders),c({currentPage:t.currentPage,totalPages:t.pages,hasMore:t.currentPage<t.pages})}catch(a){n(he(a)),t.error("Failed to load orders")}finally{l(!1)}},[d]),m=e.useCallback(async e=>{if(!d)return t.error("Please login first"),{success:!1,error:"Authentication required"};try{const t=await de("/orders",{method:"POST",body:JSON.stringify(e)},!0);return r(e=>[t.order,...e]),{success:!0,order:t.order}}catch(a){return t.error(he(a)),{success:!1,error:he(a)}}},[d]),h=e.useCallback(async e=>{if(!d)return t.error("Please login first"),!1;try{return await de(`/orders/${e}/cancel`,{method:"POST"},!0),r(t=>t.map(t=>t.id===e?{...t,status:"cancelled"}:t)),!0}catch(a){return t.error(he(a)),!1}},[d]);return e.useEffect(()=>{d?u():(r([]),l(!1))},[u,d]),{orders:a,loading:s,error:i,pagination:o,createOrder:m,cancelOrder:h,fetchOrders:u}},be=()=>{const[a,r]=e.useState([]),[s,l]=e.useState(!0),[i,n]=e.useState(null),o=e.useCallback(async()=>{try{l(!0);const e=await de("/slides",!1);r(e)}catch(e){n(he(e)),t.error("Failed to load slides")}finally{l(!1)}},[]);return e.useEffect(()=>{o()},[o]),{slides:a,loading:s,error:i}},fe=()=>{const[a,r]=e.useState([]),[s,l]=e.useState(!1),[i,n]=e.useState(null),{isAuthenticated:o}=e.useContext(ue),[c,d]=e.useState(new Map),u=e.useRef(new Set),m=e.useRef(new Map),[h,p]=e.useState({currentPage:1,totalPages:1,totalItems:0,perPage:20}),g=e.useRef({favorites:{data:null,timestamp:0,promise:null,expiryTime:3e5,lastPage:1},status:new Map}),y=e.useCallback(()=>{const{data:e,timestamp:t,expiryTime:a}=g.current.favorites;return e&&Date.now()-t<a},[]),b=e.useCallback(e=>{if(!o||!e)return!1;const t=c.get(e);if(void 0!==t)return t;if(a.some(t=>t.id===e))return!0;const r=g.current.status.get(e);return!!(r&&Date.now()-r.timestamp<g.current.favorites.expiryTime)&&r.status},[o,a,c]),f=e.useCallback(async(e=1)=>{if(o){if(y()&&g.current.favorites.lastPage===e)return g.current.favorites.data;if(g.current.favorites.promise&&g.current.favorites.lastPage===e)return g.current.favorites.promise;try{l(!0);const t=de(`/favorites?page=${e}&perPage=${h.perPage}`,{},!0);g.current.favorites.promise=t;const a=await t;p({currentPage:e,totalPages:a.pages,totalItems:a.total,perPage:h.perPage});const s=a.favorites.map(e=>({...e,isFavorite:c.get(e.id)??!0}));return g.current.favorites={...g.current.favorites,data:s,timestamp:Date.now(),promise:null,lastPage:e},r(s),s}catch(a){throw n(a.message),t.error("Failed to load favorites"),a}finally{l(!1),g.current.favorites.promise=null}}else r([])},[o,h.perPage,y,c]),x=e.useCallback(async e=>{if(!o)return t.error("Please login first"),!1;if(u.current.has(e))return!1;try{u.current.add(e);const a=b(e);d(t=>new Map(t).set(e,!a));const s=await de("/favorites",{method:"POST",body:JSON.stringify({product_id:e})},!0),l=!a;return r(t=>{const a=l?[...t,{id:e,isFavorite:!0}]:t.filter(t=>t.id!==e);return g.current.favorites.data=a,a}),g.current.status.set(e,{status:l,timestamp:Date.now()}),t.success(s.message),!0}catch(a){return d(t=>{const a=new Map(t);return a.delete(e),a}),t.error(a.message),!1}finally{u.current.delete(e),d(t=>{const a=new Map(t);return a.delete(e),a})}},[o,b]),v=e.useCallback(async e=>{if(!o||!e||m.current.has(e))return b(e);try{const t=de(`/favorites/${e}/status`,{},!0);m.current.set(e,t);const a=await t;return g.current.status.set(e,{status:a.isFavorite,timestamp:Date.now()}),a.isFavorite}catch(t){return b(e)}finally{m.current.delete(e)}},[o,b]),w=e.useCallback(()=>(g.current.favorites.timestamp=0,f(h.currentPage)),[f,h.currentPage]);return e.useEffect(()=>{o||(g.current={favorites:{data:null,timestamp:0,promise:null,expiryTime:3e5,lastPage:1},status:new Map},r([]),p({currentPage:1,totalPages:1,totalItems:0,perPage:20}))},[o]),e.useEffect(()=>{o&&f(1)},[o,f]),{favorites:a,loading:s,error:i,pagination:h,fetchFavorites:f,forceFetchFavorites:w,getFavoriteStatus:b,checkFavoriteStatus:v,toggleFavorite:x,isPending:e=>u.current.has(e)}},xe=({children:a})=>{const[r,s]=e.useState(!1),[l,i]=e.useState(null),[n,o]=e.useState(ie()),[c,d]=e.useState(!0);e.useEffect(()=>{const e=le(),t=ie(),a=(()=>{try{return JSON.parse(localStorage.getItem(re))}catch{return null}})();e&&a?(i(a),o(t),s(!0),(async(e=!0)=>{try{const e=await de("/profile",{},!0);i(e),s(!0),se({...e,phone:n})}catch(t){if(ne(),s(!1),e){const e=ie();e&&await u(e)}}finally{d(!1)}})()):t?u(t):(ne(),d(!1))},[]);const u=async e=>{try{const l=await de("/auth/login",{method:"POST",body:JSON.stringify({phone:e})},!1);if(!l.token)throw new Error("Login failed - no token received");a=l.token,localStorage.setItem(te,a),(e=>{localStorage.setItem(ae,e)})(e),o(e);try{const[t,a,r]=await Promise.all([de("/profile",{},!0),de("/orders",{},!0),de("/favorites",{},!0)]),l={...t,ordersCount:a.total||0,favoritesCount:r.total||0,orders:a.orders||[],favorites:r.favorites||[],addresses:t.addresses||[],phone:e};return i(l),se(l),s(!0),!0}catch(r){const a={...l.user,ordersCount:0,favoritesCount:0,orders:[],favorites:[],addresses:[],phone:e};return i(a),se(a),s(!0),t.warning("Logged in, but some data could not be loaded"),!0}}catch(l){return ne(),s(!1),i(null),o(null),t.error(he(l)),!1}var a};return W(ue.Provider,{value:{isAuthenticated:r,userInfo:l,phone:n,login:u,logout:()=>{ne(),s(!1),i(null),o(null)},updateProfile:async e=>{try{const t=await de("/profile",{method:"PUT",body:JSON.stringify(e)},!0),a={...l,...t.user};return i(a),se(a),!0}catch(a){return t.error(he(a)),!1}},addAddress:async e=>{try{const t=await de("/addresses",{method:"POST",body:JSON.stringify(e)},!0),a={...l,addresses:[...l.addresses||[],t.address]};return i(a),se(a),!0}catch(a){return t.error(he(a)),!1}},updateAddress:async(e,a)=>{try{const t=await de(`/addresses/${e}`,{method:"PUT",body:JSON.stringify(a)},!0),r={...l,addresses:l.addresses.map(a=>a.id===e?t.address:a)};return i(r),se(r),!0}catch(r){return t.error(he(r)),!1}},loading:c},children:a})},ve=({children:t})=>{const[a,r]=e.useState(()=>{const e=localStorage.getItem("cart");return e?JSON.parse(e):[]}),[s,l]=e.useState(!1);e.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(a))},[a]);const i=a.reduce((e,t)=>e+t.price*t.quantity,0),n=e=>{r(t=>t.filter(t=>t.cartItemId!==e))};return W(me.Provider,{value:{cart:a,isCartOpen:s,setIsCartOpen:l,addToCart:(e,t,a,s=1)=>{r(r=>{const l=((e,t,a)=>`${e}-${t}-${a}`)(e.id,t.id,a);return r.find(e=>e.cartItemId===l)?r.map(e=>e.cartItemId===l?{...e,quantity:e.quantity+s}:e):[...r,{id:e.id,cartItemId:l,name:e.name,price:e.discountPrice||e.basePrice,image:t.images[0],variantId:t.id,colorName:t.colorName,size:a,quantity:s}]}),l(!0)},removeFromCart:n,updateQuantity:(e,t)=>{t<1?n(e):r(a=>a.map(a=>a.cartItemId===e?{...a,quantity:t}:a))},emptyCart:()=>{r([]),l(!1)},cartTotal:i},children:t})},we={hidden:{opacity:0},visible:{opacity:1}},Ne={hidden:{y:"100%"},visible:{y:0,transition:{type:"tween",duration:.25,ease:[.25,.46,.45,.94]}}},ke=e.memo(({onClose:e,title:t,hideSupport:a,onSupportClick:r})=>W("div",{className:"pt-8 px-4 pb-4 border-b border-gray-200 flex-shrink-0",children:Z("div",{className:"flex items-center justify-between",children:[W("button",{onClick:e,className:"p-2 rounded-xl bg-gray-50 text-slate-600 hover:bg-gray-100 hover:text-slate-800 transition-all duration-200",children:W(E,{className:"w-5 h-5"})}),W("h3",{className:"text-xl font-bold text-slate-800",children:t}),a?W("div",{className:"w-9 h-9"}):W("button",{onClick:r,className:"p-2 rounded-xl bg-gray-50 text-slate-600 hover:bg-gray-100 hover:text-slate-800 transition-all duration-200",children:W(P,{className:"w-5 h-5"})})]})})),Ce=e.memo(({isOpen:t,onClose:a,title:r,children:s,maxHeight:l="90vh",hideSupport:i=!1})=>{const[n,o]=e.useState(!1),c=e.useCallback(()=>{o(!0)},[]),d=e.useCallback(e=>{e.target===e.currentTarget&&a()},[a]);return t?Z(K,{children:[W(v,{mode:"wait",children:W(w.div,{variants:we,initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.2},className:"fixed inset-0 bg-slate-900/20 z-50",onClick:d,style:{backdropFilter:"blur(2px)"},children:W(w.div,{variants:Ne,initial:"hidden",animate:"visible",exit:"hidden",className:"fixed inset-x-0 bottom-0",style:{willChange:"transform"},children:Z("div",{className:"bg-white rounded-t-3xl flex flex-col overflow-hidden shadow-xl",style:{maxHeight:l,background:"linear-gradient(180deg, #f8fafc 0%, #ffffff 100%)"},children:[W("div",{className:"flex justify-center pt-3 pb-1",children:W("div",{className:"w-12 h-1 rounded-full bg-gray-300"})}),W(ke,{onClose:a,title:r,hideSupport:i,onSupportClick:c}),W("div",{className:"overflow-y-auto overscroll-contain hide-scrollbar flex-1",style:{contain:"layout style paint"},children:s})]})})},"backdrop")}),n&&W(Pe,{isOpen:n,onClose:()=>o(!1)})]}):null}),Se=({isOpen:h,onClose:p,onOpenOrders:g,onOpenFavorites:y,onOpenLogin:b,onOpenLocation:f})=>{const{userInfo:x,updateProfile:v,addAddress:w,updateAddress:N,logout:k}=e.useContext(ue),[C,S]=e.useState(!1),[P,O]=e.useState(!1),[j,I]=e.useState(!1),[T,E]=e.useState(!1),[A,$]=e.useState(!1),{isAuthenticated:z,login:L}=e.useContext(ue),[F,M]=e.useState(!1),D=x?.addresses?.[0],q=e.useMemo(()=>[{icon:a,label:"طلباتي",count:x?.ordersCount||0,onClick:g,color:"from-sky-400/20 to-sky-500/20"},{icon:r,label:"المفضلة",count:x?.favoritesCount||0,onClick:y,color:"from-rose-400/20 to-rose-500/20"}],[x?.ordersCount,x?.favoritesCount,g,y]),H=e.useMemo(()=>[{id:"name",icon:s,title:"الاسم",value:x?.name||"اضغط لإضافة اسم",onEdit:()=>S(!0)},{id:"phone",icon:l,title:"رقم الهاتف",value:x?.phone||"",onEdit:()=>I(!0)},{id:"location",icon:i,title:"عنوان التوصيل",value:D?`${D.district}، ${D.governorate}`:"اضغط لإضافة عنوان",details:D?.details,onEdit:()=>O(!0)}],[x,D]),R=e.useCallback(async e=>{try{$(!0),await v(e)}finally{$(!1)}},[v]),X=e.useCallback(async e=>{try{$(!0),x?.addresses?.length>0?await N(x.addresses[0].id,{...e,is_default:!0}):await w({...e,is_default:!0})}finally{$(!1)}},[x?.addresses,N,w]),U=e.useCallback(()=>{k(),p(),t.success("تم تسجيل الخروج بنجاح")},[k,p]);return Z(K,{children:[W(Ce,{isOpen:h,onClose:p,title:"الملف الشخصي",children:Z("div",{className:"divide-y divide-slate-100/30",children:[Z("div",{className:"relative px-4 pt-8 pb-6 overflow-hidden",children:[W("div",{className:"absolute inset-0 bg-gradient-to-b from-sky-50/80 to-white"}),W("div",{className:"absolute top-0 left-0 w-full h-32 bg-gradient-to-r from-sky-500/10 to-indigo-500/10  transform -skew-y-6"}),W("div",{className:"absolute top-20 right-0 w-32 h-32 bg-gradient-to-br from-sky-400/20 to-transparent  rounded-full blur-2xl"}),W("div",{className:"absolute top-10 left-0 w-24 h-24 bg-gradient-to-br from-indigo-400/20 to-transparent  rounded-full blur-xl"}),Z("div",{className:"relative flex flex-col items-center",children:[Z("div",{className:"relative group",children:[W("div",{className:"absolute inset-0 bg-gradient-to-r from-sky-400 to-indigo-400  rounded-full blur-xl opacity-20 group-hover:opacity-30 transition-opacity"}),W("div",{className:"absolute inset-0 rounded-full border border-sky-200/40  animate-[spin_8s_linear_infinite]"}),W("div",{className:"absolute inset-2 rounded-full border border-indigo-200/40  animate-[spin_12s_linear_infinite_reverse]"}),Z("div",{className:"relative w-24 h-24 rounded-full bg-gradient-to-br from-sky-400 via-blue-400 to-indigo-400  shadow-lg shadow-sky-200/50 flex items-center justify-center  ring-2 ring-white ring-offset-2 ring-offset-sky-50 transform transition-all duration-300  group-hover:scale-105 overflow-hidden",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"}),W("div",{className:"absolute inset-0 bg-gradient-to-br from-sky-600/10 via-transparent to-indigo-600/10"}),W(s,{className:"w-12 h-12 text-white/95 relative z-10"}),W(n,{className:"absolute top-2 right-2 w-3 h-3 text-white/70 animate-pulse"}),W(o,{className:"absolute bottom-2 left-2 w-3 h-3 text-white/70 animate-pulse delay-300"})]})]}),Z("div",{className:"relative mt-4 text-center",children:[W("h3",{className:"text-xl font-bold bg-gradient-to-r from-slate-800 via-sky-700 to-slate-800  bg-clip-text text-transparent",children:x?.name||"مستخدم جديد"}),W("p",{className:"text-sm text-slate-500 mt-1",children:x?.phone})]})]}),W("div",{className:"grid grid-cols-2 gap-3 mt-6",children:q.map((e,t)=>Z("button",{onClick:e.onClick,className:"group relative overflow-hidden rounded-xl p-3  bg-white/80 backdrop-blur-sm border border-slate-100 shadow-md  hover:shadow-lg hover:border-sky-100 transition-all duration-300  transform hover:-translate-y-0.5 active:translate-y-0",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-sky-400/5 to-indigo-400/5  opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),W("div",{className:"absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r  from-sky-400 via-blue-400 to-indigo-400 scale-x-0 group-hover:scale-x-100  transition-transform duration-300 origin-left"}),Z("div",{className:"relative",children:[Z("div",{className:"w-6 h-6 mx-auto mb-2 relative",children:[W("div",{className:"absolute inset-0 bg-sky-100 rounded-full scale-0  group-hover:scale-100 transition-transform duration-300"}),W(e.icon,{className:"w-full h-full text-sky-500 relative z-10  transform group-hover:scale-110 transition-transform duration-300"})]}),W("p",{className:"text-xs font-medium text-slate-600 mb-1",children:e.label}),W("p",{className:"text-lg font-bold bg-gradient-to-br from-slate-800 to-slate-600  bg-clip-text text-transparent transform group-hover:scale-105  transition-transform duration-300",children:e.count})]})]},t))})]}),Z("div",{className:"relative px-4 py-4 space-y-3",children:[W("div",{className:"absolute inset-0 bg-gradient-to-b from-white to-slate-50/50"}),H.map(e=>Z("div",{className:"group bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-slate-100 hover:border-sky-100 hover:shadow-lg transition-all duration-300 relative overflow-hidden",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-sky-50 to-indigo-50  opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),W("div",{className:"absolute inset-0 bg-gradient-to-br from-sky-400/5 via-transparent to-indigo-400/5  opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),Z("div",{className:"relative flex items-center justify-between",children:[W("button",{onClick:e.onEdit,className:"p-2 rounded-lg bg-sky-50 hover:bg-sky-100 transition-all duration-300 group-hover:shadow-sm group",children:W(c,{className:"w-3.5 h-3.5 text-sky-500 group-hover:rotate-12 transition-transform"})}),Z("div",{className:"flex items-center gap-3 text-right",children:[Z("div",{className:"transform group-hover:translate-x-1 transition-transform duration-300",children:[W("p",{className:"text-xs font-medium text-slate-500 mb-1",children:e.title}),W("p",{className:"text-sm font-bold text-slate-800 group-hover:text-sky-500 transition-colors",children:e.value}),e.details&&W("p",{className:"text-xs text-slate-400 mt-1",children:e.details})]}),Z("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-sky-100 to-indigo-100  flex items-center justify-center group-hover:scale-105 transition-transform shadow-sm group-hover:shadow-md relative overflow-hidden",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-white/50 to-transparent"}),W(e.icon,{className:"w-5 h-5 text-sky-500 relative z-10  transform group-hover:rotate-12 transition-transform duration-300"})]})]})]})]},e.id))]}),Z("div",{className:"relative p-4 space-y-3",dir:"rtl",children:[Z("button",{onClick:()=>E(!0),className:"w-full bg-gradient-to-r from-sky-50 via-blue-50 to-indigo-50  rounded-xl p-4 flex items-center justify-between group hover:shadow-lg transition-all duration-300 relative overflow-hidden",children:[W("div",{className:"absolute inset-0 bg-gradient-to-r from-sky-100/50 to-indigo-100/50  opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),Z("div",{className:"relative flex items-center gap-3",children:[Z("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-sky-100 to-indigo-100  flex items-center justify-center group-hover:scale-105 transition-transform shadow-sm group-hover:shadow-md relative overflow-hidden",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-white/50 to-transparent"}),W(d,{className:"w-5 h-5 text-sky-500 relative z-10  transform group-hover:rotate-12 transition-transform duration-300"})]}),W("span",{className:"font-bold text-base bg-gradient-to-br from-slate-800 to-slate-600  bg-clip-text text-transparent group-hover:translate-x-1 transition-transform duration-300",children:"الدعم والمساعدة"})]}),W(u,{className:"w-5 h-5 text-slate-400 group-hover:translate-x-2  transition-transform duration-300"})]}),Z("button",{onClick:U,className:"w-full bg-gradient-to-r from-rose-50 to-rose-100/80 text-rose-500  rounded-xl py-3 px-4 font-bold hover:shadow-lg active:bg-rose-200  transition-all duration-300 flex items-center justify-center gap-2 relative overflow-hidden group",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-100 to-rose-200/50  opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),W(m,{className:"w-5 h-5 relative transform group-hover:rotate-12  transition-transform duration-300"}),W("span",{className:"text-base relative group-hover:translate-x-0.5  transition-transform duration-300",children:"تسجيل الخروج"})]})]})]})}),W(Oe,{isOpen:C,onClose:()=>S(!1),onUpdate:R,initialName:x?.name||""}),W(je,{isOpen:P,onClose:()=>O(!1),onUpdate:X,initialAddress:D}),W(Ie,{isOpen:j,onClose:()=>I(!1),onVerified:async e=>{$(!0);try{await L(e.phone_number)&&M(!1)}catch(a){throw t.error(a.message||"فشل تسجيل الدخول"),a}finally{$(!1)}},savedPhone:x?.phone||""}),W(Pe,{isOpen:T,onClose:()=>E(!1)})]})},Pe=({isOpen:e,onClose:a})=>{const r=[{icon:k,title:"تشكيلة واسعة",description:"أحدث موديلات الأحذية العصرية للرجال والنساء",color:"bg-rose-100 text-rose-600"},{icon:o,title:"جودة مضمونة",description:"منتجات أصلية 100% مع ضمان الجودة",color:"bg-sky-100 text-sky-600"},{icon:C,title:"توصيل سريع",description:"شحن لجميع المحافظات خلال 2-4 أيام",color:"bg-green-100 text-green-600"},{icon:S,title:"ضمان الاسترجاع",description:"استرجاع مجاني خلال 14 يوم",color:"bg-sky-100 text-sky-600"}],s=[{name:"Facebook",icon:j,color:"bg-sky-100 text-sky-600",url:"https://facebook.com/shozati"},{name:"Instagram",icon:I,color:"bg-pink-100 text-pink-600",url:"https://instagram.com/shozati"},{name:"TikTok",icon:()=>W("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:W("path",{d:"M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1.04-.1z"})}),color:"bg-gray-100 text-gray-600",url:"https://tiktok.com/@shozati"}],i=[{icon:P,label:"تحدث معنا",color:"bg-green-100 text-green-600",onClick:()=>{window.open("https://wa.me/+201033939828","_blank")}},{icon:l,label:"اتصل بنا",color:"bg-sky-100 text-sky-600",onClick:()=>{window.open("tel:+201033939828","_blank")}},{icon:O,label:"نسخ الرقم",color:"bg-purple-100 text-purple-600",onClick:()=>{navigator.clipboard.writeText("+201033939828"),t.success("تم نسخ رقم الهاتف")}}];return W(Ce,{isOpen:e,onClose:a,title:"مركز المساعدة | Trendy Corner",hideSupport:!0,children:Z("div",{className:"p-6 space-y-8",dir:"rtl",children:[Z("div",{className:"space-y-4",children:[Z("div",{className:"flex items-center gap-3 mb-4",children:[W(N,{className:"w-6 h-6 text-rose-600"}),W("h4",{className:"text-lg font-bold text-sky-800",children:"مرحباً بك في Trendy Corner"})]}),W("p",{className:"text-slate-600 leading-relaxed",children:"نحن متخصصون في تقديم أرقى تشكيلات الأحذية العصرية بجودة استثنائية وأسعار منافسة. نسعى دائماً لتقديم تجربة تسوق فريدة مع خدمة عملاء احترافية على مدار الساعة."})]}),W("div",{className:"grid grid-cols-2 gap-4",children:r.map((e,t)=>Z("div",{className:`${e.color} rounded-xl p-4 space-y-2 shadow-sm`,children:[W(e.icon,{className:"w-6 h-6"}),W("h5",{className:"font-bold text-sky-800",children:e.title}),W("p",{className:"text-sm text-slate-600",children:e.description})]},t))}),W("div",{className:"grid grid-cols-3 gap-3",children:i.map((e,t)=>Z("button",{onClick:e.onClick,className:`${e.color} rounded-xl p-4 flex flex-col items-center gap-2 \n                            hover:brightness-105 transition-all duration-300 shadow-sm hover:shadow-md`,children:[W(e.icon,{className:"w-6 h-6"}),W("span",{className:"text-sm text-sky-800 text-center whitespace-nowrap",children:e.label})]},t))}),Z("div",{className:"space-y-4",children:[W("h4",{className:"font-bold text-sky-800",children:"تابعنا على مواقع التواصل"}),W("div",{className:"grid grid-cols-3 gap-3",children:s.map((e,t)=>Z("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:`${e.color} rounded-xl p-4 flex flex-col items-center gap-2\n                                hover:brightness-105 transition-all duration-300 shadow-sm hover:shadow-md`,children:[W(e.icon,{className:"w-6 h-6"}),W("span",{className:"text-sm font-medium text-sky-800",children:e.name})]},t))})]}),W("div",{className:"bg-gradient-to-r from-rose-100 to-purple-100 rounded-xl p-4 shadow-sm",children:Z("div",{className:"flex items-center gap-3",children:[W(T,{className:"w-6 h-6 text-rose-600"}),Z("div",{children:[W("h4",{className:"font-bold text-sky-800 mb-1",children:"مواعيد العمل"}),Z("p",{className:"text-sm text-slate-600",children:["طوال أيام الأسبوع",W("br",{}),"من 10 صباحاً حتى 11 مساءً"]})]})]})})]})})},Oe=({isOpen:a,onClose:r,onUpdate:s,initialName:l=""})=>{const[i,n]=e.useState(l),[o,c]=e.useState(!1);return e.useEffect(()=>{n(l)},[l,a]),W(Ce,{isOpen:a,onClose:r,title:"تحديث الاسم",children:W("div",{className:"p-6 space-y-6",children:Z("div",{className:"space-y-4",children:[W("div",{className:"relative",children:W("input",{type:"text",placeholder:"أدخل اسمك",value:i,onChange:e=>n(e.target.value),className:"w-full bg-sky-50 text-sky-800 rounded-xl p-4  text-right text-lg border border-sky-100 focus:ring-4 focus:ring-sky-500/20 focus:border-sky-500 placeholder-sky-400 transition-all duration-300"})}),W("button",{onClick:async()=>{if(i.trim())try{c(!0),await s({name:i}),t.success("تم تحديث الاسم بنجاح"),r()}catch(e){t.error(e.message||"فشل تحديث الاسم")}finally{c(!1)}else t.error("يرجى إدخال الاسم")},disabled:!i.trim()||o,className:"w-full bg-gradient-to-r from-sky-500 to-sky-600 text-white  rounded-xl py-4 font-bold uppercase tracking-wider disabled:opacity-50 disabled:cursor-not-allowed hover:from-sky-500 hover:to-sky-600  transition-all duration-300 transform hover:-translate-y-0.5 shadow-sm hover:shadow-md",children:o?Z("div",{className:"flex items-center justify-center gap-2",children:[W(y,{className:"w-5 h-5 animate-spin"}),W("span",{children:"جاري التحديث..."})]}):"تحديث الاسم"})]})})})},je=({isOpen:t,onClose:a,onUpdate:r,initialAddress:s=null})=>{const[l,n]=e.useState(1),[o,c]=e.useState({governorate:s?.governorate||"",district:s?.district||"",details:s?.details||""}),[d,u]=e.useState(!1);e.useEffect(()=>{t&&(n(1),c({governorate:s?.governorate||"",district:s?.district||"",details:s?.details||""}))},[t,s]);const m=[{id:1,field:"governorate",label:"المحافظة",icon:i,placeholder:"اختر المحافظة"},{id:2,field:"district",label:"المدينة",icon:b,placeholder:"اختر المدينة"},{id:3,field:"details",label:"العنوان بالتفصيل",icon:f,placeholder:"ادخل العنوان بالتفصيل"}];return W(Ce,{isOpen:t,onClose:a,title:"تحديث العنوان",children:Z("div",{className:"p-6 space-y-6",dir:"rtl",children:[W("div",{className:"flex justify-center",children:m.map((e,t)=>Z("div",{className:"flex items-center",children:[W("div",{className:"w-8 h-8 rounded-full flex items-center justify-center\n                                       "+(l===e.id?"bg-sky-500 text-white":l>e.id?"bg-sky-200 text-sky-600":"bg-sky-50 text-sky-400"),children:l>e.id?W(p,{className:"w-4 h-4"}):e.id}),t<m.length-1&&W("div",{className:"h-0.5 w-16 \n                                          "+(l>e.id?"bg-sky-200":"bg-sky-50")})]},e.id))}),Z("div",{children:[Z("div",{className:"flex items-center gap-2 mb-4",children:[x.createElement(m[l-1].icon,{className:"w-6 h-6 text-sky-500"}),W("h3",{className:"text-xl font-bold text-sky-800",children:m[l-1].label})]}),W("input",{type:"text",value:o[m[l-1].field],onChange:e=>c(t=>({...t,[m[l-1].field]:e.target.value})),placeholder:m[l-1].placeholder,className:"w-full bg-sky-50 text-sky-800 rounded-xl p-4 text-right border border-sky-100 focus:ring-4 focus:ring-sky-500/20 focus:border-sky-500 placeholder-sky-400 transition-all duration-300"})]}),Z("div",{className:"flex gap-3",children:[l>1&&W("button",{onClick:()=>n(e=>e-1),className:"flex-1 bg-sky-50 text-sky-700 rounded-xl py-3 hover:bg-sky-100 transition-colors border border-sky-100",children:"السابق"}),W("button",{onClick:async()=>{if(l<m.length)n(e=>e+1);else try{u(!0),await r(o),a()}catch(e){}finally{u(!1)}},disabled:!o[m[l-1].field]||d,className:"flex-1 bg-gradient-to-r from-sky-500 to-sky-600  text-white rounded-xl py-3 font-bold disabled:opacity-50 hover:from-sky-500 hover:to-sky-600  transition-all duration-300 shadow-sm hover:shadow-md",children:d?Z("div",{className:"flex items-center justify-center gap-2",children:[W(y,{className:"w-5 h-5 animate-spin"}),W("span",{children:"جاري الحفظ..."})]}):l===m.length?"حفظ":"التالي"})]})]})})},Ie=({isOpen:a,onClose:r,onVerified:s,loading:i,savedPhone:n="",isLogin:o=!1})=>{const[c,d]=e.useState(n),[u,m]=e.useState(!1),[b,f]=e.useState(!1);return e.useEffect(()=>{const e=/^01[0125][0-9]{8}$/.test(c);f(e)},[c]),W(Ce,{isOpen:a,onClose:r,title:o?"تسجيل الدخول":"تحديث رقم الهاتف",hideSupport:o,children:Z("div",{className:"p-6 space-y-8",children:[Z("div",{className:"w-24 h-24 rounded-full mx-auto \n                    flex items-center justify-center relative overflow-hidden\n                    bg-gradient-to-br from-sky-400 to-sky-500 shadow-md",children:[W("div",{className:"absolute inset-0 bg-gradient-to-t from-sky-900/10 to-transparent"}),W(o?h:l,{className:"w-12 h-12 text-white relative z-10"})]}),Z("div",{className:"text-center",children:[W("h4",{className:"text-xl font-bold text-sky-800 mb-2",children:o?"مرحباً بك":"تحديث رقم الهاتف"}),W("p",{className:"text-slate-500 mb-2",children:o?"قم بإدخال رقم هاتفك للمتابعة":"أدخل رقم هاتفك الجديد"}),W("p",{className:"text-sm text-sky-500",children:"يفضل إدخال رقم الواتساب لتسهيل التواصل"})]}),Z("div",{className:"space-y-4",children:[Z("div",{className:"relative",children:[W("input",{type:"tel",placeholder:"01xxxxxxxxx",value:c,onChange:e=>d(e.target.value),className:"w-full bg-sky-50 text-sky-800 rounded-xl p-4  text-center text-xl tracking-wide border border-sky-100 focus:ring-4 focus:ring-sky-500/20 focus:border-sky-500 placeholder-sky-300 transition-all duration-300",dir:"ltr"}),c&&W("div",{className:"absolute left-4 top-1/2 -translate-y-1/2",children:b?W(p,{className:"w-6 h-6 text-green-500 animate-pulse"}):W(g,{className:"w-6 h-6 text-red-500 animate-pulse"})})]}),W("button",{onClick:async()=>{try{m(!0),await s({phone_number:c}),t.success(o?"تم تسجيل الدخول بنجاح":"تم تحديث رقم الهاتف بنجاح"),r()}catch(e){t.error(e.message||(o?"فشل تسجيل الدخول":"فشل تحديث رقم الهاتف"))}finally{m(!1)}},disabled:!b||u||i,className:"w-full text-white rounded-xl py-4 font-bold  uppercase tracking-wider disabled:opacity-50  disabled:cursor-not-allowed transition-all duration-300  transform hover:-translate-y-0.5 shadow-sm hover:shadow-md bg-gradient-to-r from-sky-500 to-sky-600  hover:from-sky-500 hover:to-sky-600",children:u||i?Z("div",{className:"flex items-center justify-center gap-2",children:[W(y,{className:"w-5 h-5 animate-spin"}),W("span",{children:o?"جاري تسجيل الدخول...":"جاري التحديث..."})]}):o?"تسجيل الدخول":"تحديث رقم الهاتف"})]})]})})},Te=()=>Z("svg",{width:"40",height:"40",viewBox:"0 0 40 40",className:"absolute inset-0 w-full h-full opacity-10",children:[W("defs",{children:Z("pattern",{id:"premium-pattern",x:"0",y:"0",width:"10",height:"10",patternUnits:"userSpaceOnUse",children:[W("circle",{cx:"5",cy:"5",r:"0.5",fill:"currentColor"}),W("circle",{cx:"0",cy:"0",r:"0.3",fill:"currentColor"}),W("circle",{cx:"10",cy:"10",r:"0.3",fill:"currentColor"})]})}),W("rect",{width:"100%",height:"100%",fill:"url(#premium-pattern)"})]}),Ee=({icon:t,onClick:a,isActive:r,label:s})=>{const[l,i]=e.useState(!1);return Z(w.button,{onHoverStart:()=>i(!0),onHoverEnd:()=>i(!1),onClick:a,whileHover:{scale:1.05},whileTap:{scale:.95},className:"relative p-3 rounded-2xl overflow-hidden group",children:[W("div",{className:"absolute inset-0 bg-gradient-to-br from-white via-gray-50 to-white \r backdrop-blur-xl transition-all duration-300"}),W("div",{className:"absolute inset-0 text-blue-500/10",children:W(Te,{})}),W(w.div,{className:"absolute inset-0 opacity-0 group-hover:opacity-100",animate:{background:l?["linear-gradient(45deg, rgba(59, 130, 246, 0.15) 0%, transparent 100%)","linear-gradient(45deg, transparent 0%, rgba(59, 130, 246, 0.15) 100%)"]:"none"},transition:{duration:2.5,repeat:1/0,repeatType:"reverse"}}),W(w.div,{className:"absolute inset-0 opacity-0 group-hover:opacity-100 rounded-2xl",animate:{boxShadow:l?["inset 0 0 0 1px rgba(59, 130, 246, 0.3), 0 4px 12px rgba(59, 130, 246, 0.1)","inset 0 0 0 1px rgba(59, 130, 246, 0.5), 0 4px 12px rgba(59, 130, 246, 0.2)"]:"none"},transition:{duration:1.8,repeat:1/0,repeatType:"reverse"}}),W(w.div,{animate:{scale:l?1.15:1,rotate:l?[0,8,-8,0]:0,y:l?-2:0},transition:{scale:{duration:.3,ease:"easeOut"},rotate:{duration:.6,ease:"easeInOut"},y:{duration:.2}},className:"relative",children:W(t,{className:"w-6 h-6 transition-all duration-300\n                       "+(l?"text-blue-500 filter drop-shadow-lg":"text-blue-600")})}),s&&W(v,{children:l&&W(w.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:5},className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 \r text-xs font-medium text-sky-600 whitespace-nowrap",children:s})})]})},Ae=()=>W(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative px-4",children:Z("div",{className:"relative inline-block",children:[W("img",{src:"/logo.png",alt:"Shozati Logo",className:"h-10 w-auto"}),W(w.div,{className:"absolute -inset-2 bg-gradient-to-r from-sky-500/20 via-sky-400/20 to-sky-500/20 \r blur-xl opacity-0 rounded-full",animate:{opacity:[0,.6,0],scale:[.9,1.1,.9],rotate:[0,5,0]},transition:{duration:4,repeat:1/0,repeatType:"reverse"}})]})}),$e=({onOrdersClick:r,onProfileClick:l})=>{const{isAuthenticated:i,login:n}=e.useContext(ue),[o,c]=e.useState(!1),[d,u]=e.useState(!1),m=async e=>{i?"orders"===e?r():"profile"===e&&l():c(!0)};return Z(w.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"sticky top-0 z-40",children:[W("div",{className:"absolute inset-0 bg-gradient-to-b from-sky-50/95 via-white/90 to-sky-50/95 \r backdrop-blur-lg shadow-lg shadow-sky-100/50"}),W("div",{className:"relative px-4 py-2",children:Z("div",{className:"flex justify-between items-center max-w-6xl mx-auto",children:[W(Ee,{icon:s,onClick:()=>m("profile"),label:"Profile"}),W(Ae,{}),W(Ee,{icon:a,onClick:()=>m("orders"),label:"Orders"})]})}),W(Ie,{isOpen:o,onClose:()=>c(!1),onVerified:async e=>{u(!0);try{await n(e.phone_number)&&c(!1)}catch(a){throw t.error(a.message||"Login failed"),a}finally{u(!1)}},loading:d,isLogin:!0})]})},ze=({isOpen:t,onClose:a,imageUrl:r})=>{const[s,l]=e.useState({scale:1,translateX:0,translateY:0}),i=e.useRef(null),n=e.useRef(null),o=e.useRef([]),c=e.useRef(null),d=e.useRef({scale:1,translateX:0,translateY:0}),u=e.useRef({time:0,x:0,y:0}),m=e.useRef({x:0,y:0}),h=e.useRef(Date.now()),p=e.useRef(null),g=e.useRef({x:0,y:0}),y=e.useCallback(()=>{if(!n.current||!i.current)return;const e=i.current.getBoundingClientRect(),t=n.current.getBoundingClientRect(),a=t.width*s.scale,r=t.height*s.scale;g.current={x:Math.max(0,(a-e.width)/2),y:Math.max(0,(r-e.height)/2)}},[s.scale]),b=e.useCallback((e,t)=>{const a=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(a*a+r*r)},[]),f=e.useCallback((e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),[]),x=e.useCallback((e,t)=>{const{x:a,y:r}=g.current;return{x:Math.max(-a,Math.min(a,e)),y:Math.max(-r,Math.min(r,t))}},[]),v=e.useCallback(()=>{Math.abs(m.current.x)<.01&&Math.abs(m.current.y)<.01?cancelAnimationFrame(p.current):(l(e=>{const t=e.translateX+m.current.x,a=e.translateY+m.current.y,r=x(t,a);return m.current.x*=.95,m.current.y*=.95,{...e,translateX:r.x,translateY:r.y}}),p.current=requestAnimationFrame(v))},[x]),w=e.useCallback((e,t)=>{const a=Date.now(),r=u.current;a-r.time<300&&Math.abs(e-r.x)<30&&Math.abs(t-r.y)<30?(l(e=>({scale:1===e.scale?2.5:1,translateX:0,translateY:0})),u.current={time:0,x:0,y:0}):u.current={time:a,x:e,y:t}},[]),N=e.useCallback(e=>{cancelAnimationFrame(p.current),m.current={x:0,y:0},o.current=[...e.touches],h.current=Date.now(),1===e.touches.length&&w(e.touches[0].clientX,e.touches[0].clientY),2===e.touches.length&&(c.current=b(e.touches[0],e.touches[1]),d.current=s)},[b,w,s]),k=e.useCallback(e=>{e.preventDefault();const t=Date.now(),a=t-h.current;if(1===e.touches.length&&s.scale>1){const t=e.touches[0],r=o.current[0];if(r){const e=t.clientX-r.clientX,s=t.clientY-r.clientY;m.current={x:e/a*16,y:s/a*16},l(t=>{const a=t.translateX+e,r=t.translateY+s,l=x(a,r);return{...t,translateX:l.x,translateY:l.y}})}}if(2===e.touches.length){const t=b(e.touches[0],e.touches[1]),a=c.current,r=f(e.touches[0],e.touches[1]);if(a){const e=Math.min(Math.max(d.current.scale*(t/a),1),5),s=i.current?.getBoundingClientRect();if(s){const t=r.x-s.left-s.width/2,a=r.y-s.top-s.height/2;l(r=>({scale:e,translateX:1===e?0:t*(e/r.scale-1)+r.translateX,translateY:1===e?0:a*(e/r.scale-1)+r.translateY}))}}}o.current=[...e.touches],h.current=t},[x,b,f,s.scale]),C=e.useCallback(e=>{0===e.touches.length&&s.scale>1&&v(),0===e.touches.length&&(c.current=null),o.current=[...e.touches]},[v,s.scale]);e.useEffect(()=>{if(t&&i.current){const e=i.current;return e.addEventListener("touchstart",N,{passive:!0}),e.addEventListener("touchmove",k,{passive:!1}),e.addEventListener("touchend",C,{passive:!0}),()=>{e.removeEventListener("touchstart",N),e.removeEventListener("touchmove",k),e.removeEventListener("touchend",C)}}},[t,N,k,C]),e.useEffect(()=>{y()},[y,s.scale]),e.useEffect(()=>(t||(l({scale:1,translateX:0,translateY:0}),d.current={scale:1,translateX:0,translateY:0},cancelAnimationFrame(p.current)),()=>cancelAnimationFrame(p.current)),[t]);const S=e.useCallback(()=>{l(e=>({...e,scale:Math.min(e.scale+.5,5)}))},[]),P=e.useCallback(()=>{l(e=>({scale:Math.max(e.scale-.5,1),translateX:e.scale<=1.5?0:e.translateX,translateY:e.scale<=1.5?0:e.translateY}))},[]);return t?Z("div",{className:"fixed inset-0 z-50 bg-black/95 backdrop-blur-lg",children:[W("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-full bg-black/20 text-white\r hover:bg-black/30 transition-all duration-200 z-50 hover:scale-105",children:W(E,{className:"w-6 h-6"})}),Z("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-50",children:[W("button",{onClick:P,disabled:1===s.scale,className:"p-3 rounded-full bg-black/20 text-white hover:bg-black/30 \r transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\r hover:scale-105",children:W(A,{className:"w-6 h-6"})}),W("button",{onClick:S,disabled:5===s.scale,className:"p-3 rounded-full bg-black/20 text-white hover:bg-black/30 \r transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\r hover:scale-105",children:W($,{className:"w-6 h-6"})})]}),Z("div",{ref:i,className:"w-full h-full flex items-center justify-center overflow-hidden touch-none",children:[1===s.scale&&W("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:W("div",{className:"bg-black/50 backdrop-blur-sm rounded-full px-6 py-3 text-white/80",children:"Double tap or pinch to zoom"})}),W("img",{ref:n,src:r,alt:"Product view",className:"max-w-full max-h-full object-contain select-none will-change-transform",style:{transform:`scale(${s.scale}) translate(${s.translateX/s.scale}px, ${s.translateY/s.scale}px)`,transition:1===s.scale?"transform 0.3s ease-out":"none"},draggable:"false"})]})]}):null},Le=e=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Fe={_cache:new Set,preload(e){return!e||this._cache.has(e)?Promise.resolve():new Promise((t,a)=>{const r=new Image;r.onload=()=>{this._cache.add(e),t(e)},r.onerror=a,r.src=e})},preloadBatch(e=[],t=[]){return e.length?Promise.all(t.map(e=>this.preload(e))):Promise.resolve()},isLoaded(e){return this._cache.has(e)}},Me=e.memo(({variants:t,selectedVariant:a,onVariantSelect:r,showCollapsed:s=!0,maxVisible:l=10})=>{const[i,n]=e.useState(!1),o=s&&t.length>l,c=i?t:t.slice(0,l),d=t.length-l;return e.useEffect(()=>{const e=t.map(e=>e.images[0]);Fe.preloadBatch(e,[a?.images[0]])},[t,a]),W("div",{className:"relative",children:Z("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar py-1 px-1",dir:"rtl",children:[c.map(e=>Z(w.button,{onClick:()=>r(e),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"relative p-0.5 rounded-full transition-all "+(a?.id===e.id?"ring-2 ring-sky-500 ring-offset-1 ring-offset-white":""),children:[W("div",{className:"w-6 h-6 rounded-full border border-gray-200 shadow-sm",style:{backgroundColor:e.colorCode}}),a?.id===e.id&&W(w.div,{layoutId:"selectedColor",className:"absolute inset-0 flex items-center justify-center",children:W(p,{className:"w-3 h-3 text-white drop-shadow"})})]},e.id)),o&&!i&&W(w.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>n(!0),className:"flex items-center justify-center px-2 py-1 rounded-full \r bg-gray-100 hover:bg-gray-200 transition-colors border \r border-gray-200 shadow-sm",children:Z("span",{className:"text-xs text-gray-600",children:["+",d]})}),o&&i&&W(w.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>n(!1),className:"flex items-center justify-center px-2 rounded-full \r hover:bg-gray-100 transition-colors",children:W(R,{className:"w-4 h-4 text-gray-400"})})]})})}),De=e.memo(({sizes:t,selectedSize:a,onSizeSelect:r})=>{const s=e.useMemo(()=>(e=>{const t={35:1,36:2,37:3,38:4,39:5,40:6,41:7,42:8,43:9,44:10,45:11,XXS:1,XS:2,S:3,M:4,L:5,XL:6,XXL:7,"2XL":7,"3XL":8,"4XL":9,"٣٥":1,"٣٦":2,"٣٧":3,"٣٨":4,"٣٩":5,"٤٠":6,"٤١":7,"٤٢":8,"٤٣":9,"٤٤":10,"٤٥":11};return[...e].sort((e,a)=>{const r=e.size.toString().toUpperCase(),s=a.size.toString().toUpperCase();if(void 0!==t[r]&&void 0!==t[s])return t[r]-t[s];const l=parseFloat(r),i=parseFloat(s);return isNaN(l)||isNaN(i)?r.localeCompare(s):l-i})})(t),[t]);return W("div",{className:"grid grid-cols-4 gap-2",children:s.map(e=>Z("button",{onClick:()=>e.inStock&&r(e),disabled:!e.inStock,className:"relative p-4 mb-6 rounded-xl font-bold text-sm transition-all\n                        "+(e.inStock?a?.size===e.size?"bg-gradient-to-r from-blue-500 to-blue-600 text-white ring-2 ring-blue-500/50 shadow-lg":"bg-white text-slate-800 hover:bg-gray-50 border border-gray-200 shadow-sm":"bg-gray-50 text-gray-400 cursor-not-allowed border border-gray-200"),children:[e.size,!e.inStock&&W("span",{className:"absolute -bottom-6 right-1/2 translate-x-1/2 \r text-xs text-rose-500 whitespace-nowrap",children:"نفذت الكمية"})]},e.size))})});Me.displayName="ColorSelector",De.displayName="SizeSelector";const qe=e.memo(({rating:t,tag:a,tagColor:r})=>{const s=e.useMemo(()=>{if(!r)return null;const e=parseInt(r.slice(1,3),16),t=parseInt(r.slice(3,5),16),a=parseInt(r.slice(5,7),16);return{lighter:`rgba(${e+.2*(255-e)}, ${t+.2*(255-t)}, ${a+.2*(255-a)}, 0.9)`,darker:`rgba(${.8*e}, ${.8*t}, ${.8*a}, 1)`}},[r]),l=e.useMemo(()=>r?(e=>{const t=e.replace("#","");return parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16),"text-white"})(r):"text-white",[r]);return Z("div",{className:"absolute top-4 right-3 flex flex-col gap-2 z-10",children:[t>0&&Z(w.div,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,type:"spring"},className:"bg-gradient-to-r from-white/95 to-white/85\r backdrop-blur-md rounded-full px-3 py-1.5\r shadow-lg shadow-amber-100/30 \r border border-amber-100/50\r hover:border-amber-200/60\r hover:shadow-xl hover:shadow-amber-100/40\r flex items-center gap-1.5\r transition-all duration-300",children:[W(o,{className:"w-4 h-4 text-amber-500 fill-amber-400"}),W("span",{className:"text-sm font-semibold bg-gradient-to-r \r from-amber-600 to-amber-500\r bg-clip-text text-transparent",children:t.toFixed(1)})]}),a&&r&&W(w.div,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,type:"spring"},className:"relative overflow-hidden",children:W("div",{className:"rounded-full px-3 py-1.5 text-sm font-medium\r shadow-lg backdrop-blur-md\r hover:shadow-xl transition-all duration-300\r flex items-center gap-2",style:{background:`linear-gradient(to right, ${r}, ${s?.lighter})`,boxShadow:`0 4px 6px -1px ${r}20, 0 2px 4px -1px ${r}10`},children:W("span",{className:`relative ${l}`,children:a})})})]})});qe.displayName="Badges";const He=e.memo(({src:t,alt:a,className:r,onLoad:s,fallback:l=null,loadingClass:i=""})=>{const[n,o]=e.useState(!Fe.isLoaded(t)),[c,d]=e.useState(!1),u=e.useRef(null);return e.useEffect(()=>{o(!Fe.isLoaded(t)),d(!1);const e=()=>{o(!1),s&&s()},a=()=>{o(!1),d(!0)},r=u.current;if(r)return r.addEventListener("load",e),r.addEventListener("error",a),()=>{r.removeEventListener("load",e),r.removeEventListener("error",a)}},[t,s]),e.useEffect(()=>{const e=new IntersectionObserver(([a])=>{a.isIntersecting&&(Fe.preload(t).then(()=>o(!1)).catch(()=>d(!0)),e.disconnect())},{threshold:.1,rootMargin:"200px"});return u.current&&e.observe(u.current),()=>e.disconnect()},[t]),Z("div",{className:`relative ${r}`,children:[n&&W("div",{className:`absolute inset-0 flex items-center justify-center bg-gray-100/50 ${i}`,children:W("div",{className:"w-8 h-8 border-2 border-sky-500 border-t-transparent rounded-full animate-spin"})}),W("img",{ref:u,src:t,alt:a,className:`w-full h-full object-cover ${n?"opacity-0":"opacity-100"} transition-opacity duration-300`,loading:"lazy"}),c&&l]})});He.displayName="LazyImage";const Re=e.memo(({product:t,onSelect:a,checkAuthAndProceed:s})=>{const{isAuthenticated:l}=e.useContext(ue),[i,n]=e.useState(t.variants[0]),[o,c]=e.useState(0),[d,u]=e.useState(!1),[m,h]=e.useState(!1),[p,g]=e.useState(!1),[b,f]=e.useState({}),{getFavoriteStatus:x,toggleFavorite:N,isPending:k}=fe(),C=x(t.id),S=k(t.id),P=e.useRef(null);e.useEffect(()=>{const e=i.images[o];if(Fe.preload(e),P.current&&clearTimeout(P.current),i.images.length>1){const e=(o+1)%i.images.length;P.current=setTimeout(()=>{Fe.preload(i.images[e])},300)}return()=>{P.current&&clearTimeout(P.current)}},[i,o]),e.useEffect(()=>{if(i.images.length<=1||p||d)return;const e=setInterval(()=>{c(e=>(e+1)%i.images.length)},3e3);return()=>clearInterval(e)},[i.images.length,p,d]);const O=e.useCallback(e=>{f(t=>({...t,[e]:!0}))},[]),j=e.useCallback(async e=>{e.stopPropagation(),await s({requiresAuth:!0,onSuccess:async()=>{await N(t.id)}})},[s,t.id,N]),I=e.useCallback(()=>h(!0),[]),T=e.useCallback(()=>h(!1),[]),E=e.useCallback(e=>{const t=(o+e+i.images.length)%i.images.length;c(t)},[o,i.images.length]),A=e.useCallback(e=>{e.id!==i.id&&(u(!0),Fe.preload(e.images[0]).then(()=>{n(e),c(0),setTimeout(()=>u(!1),300)}).catch(()=>{n(e),c(0),setTimeout(()=>u(!1),300)}))},[i]);return Z(w.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},whileHover:{scale:1.02,transition:{duration:.3,ease:"easeOut"}},whileTap:{scale:.98},onTapStart:I,onTapEnd:T,className:"relative overflow-hidden group",onClick:()=>a(t),style:{willChange:"transform, opacity"},children:[Z("div",{className:"relative bg-gradient-to-br from-white via-sky-50/30 to-sky-100/20\r rounded-3xl border border-sky-100/60 overflow-hidden\r shadow-lg shadow-sky-100/20 hover:shadow-xl hover:shadow-sky-200/30\r transition-all duration-500",children:[Z("div",{className:"relative aspect-[4/5] overflow-hidden",children:[W(w.div,{animate:{scale:m?1.05:1,transition:{duration:.4,type:"spring"}},className:"absolute inset-0",children:W(v,{mode:"wait",children:W(w.div,{initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.3,type:"spring"},className:"w-full h-full",children:W(He,{src:i.images[o],alt:t.name,className:"w-full h-full",onLoad:()=>O(i.images[o]),loadingClass:"bg-gray-100/80",fallback:W("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:W("div",{className:"text-gray-400",children:"صورة غير متوفرة"})})})},`${i.id}-${o}`)})}),W(w.div,{className:"absolute inset-0 bg-gradient-to-t from-white/90 via-white/20 to-white/10\r backdrop-blur-sm opacity-0 group-hover:opacity-100\r transition-all duration-700"}),i.images.length>1&&W("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 \r flex justify-between px-2 opacity-0 group-hover:opacity-100\r transition-opacity duration-300",children:[R,R].map((e,t)=>W(w.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),E(0===t?-1:1)},className:"bg-white/80 backdrop-blur-md p-2 rounded-full\r shadow-lg shadow-sky-100/30 border border-sky-100/60",children:W(e,{className:"w-5 h-5 text-sky-600 "+(0===t?"rotate-90":"-rotate-90")})},t))}),W(qe,{rating:t.rating,tag:t.tag,tagColor:t.tagColor}),l&&W(w.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:j,className:"absolute top-3 left-3 p-3 rounded-full z-10\n                                      backdrop-blur-md transition-all duration-500\n                                      "+(C?"bg-rose-50/90 shadow-lg shadow-rose-200/50":"bg-white/90 shadow-lg shadow-sky-200/30"),children:S?W(y,{className:"w-5 h-5 text-sky-500 animate-spin"}):W(r,{className:"w-5 h-5 transition-all duration-500\n                                              "+(C?"text-rose-500 fill-rose-500 scale-110":"text-gray-600 hover:text-rose-500")})}),W("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 z-10",children:W(w.div,{whileHover:{y:-4},className:"backdrop-blur-md rounded-full p-1\r shadow-sm shadow-sky-100/30 border border-sky-100/50",children:W(Me,{variants:t.variants,selectedVariant:i,onVariantSelect:A,showCollapsed:!0,maxVisible:3})})})]}),Z("div",{className:"relative px-4 py-2 pt-3 pb-4 space-y-3 bg-white/80 backdrop-blur-md",children:[W(w.div,{className:"relative",children:W("h3",{className:"font-bold text-base line-clamp-2 text-right\r bg-gradient-to-r from-sky-900 to-sky-700\r bg-clip-text text-transparent",children:t.name})}),Z("div",{className:"flex items-baseline gap-2 justify-end",children:[W(w.span,{className:"text-lg font-bold bg-gradient-to-r \r from-sky-600 to-sky-500\r bg-clip-text text-transparent",whileHover:{scale:1.05},children:Le(t.discountPrice||t.basePrice)}),t.discountPrice&&W("span",{className:"text-sm text-sky-400/90 line-through",children:Le(t.basePrice)})]})]})]}),W(w.div,{className:"absolute inset-0 bg-sky-100/20 rounded-3xl pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:m?1.2:0,opacity:m?1:0},transition:{duration:.3,type:"spring"},style:{willChange:"transform, opacity"}})]})});Re.displayName="ProductCard";const Xe=e.memo(({products:t,loading:a,error:r,onLoadMore:s,onProductSelect:l,checkAuthAndProceed:i})=>{e.useRef(null);const n=e.useRef(null),[o,c]=e.useState(null),{refresh:d}=ge(),u=e.useRef(null),[m,h]=e.useState({start:0,end:20}),p=t?.length>20;e.useEffect(()=>{const e=new IntersectionObserver(e=>{e[0].isIntersecting&&!a&&s()},{threshold:.1,rootMargin:"200px"}),t=n.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[a,s]),e.useEffect(()=>{if(!p||!u.current)return;const e=()=>{if(!u.current)return;const e=window.scrollY,a=window.innerHeight,r=u.current.offsetTop,s=Math.max(0,Math.floor((e-r)/350)-5),l=Math.min(t.length,Math.ceil((e-r+a)/350)+5);h({start:s,end:l})};return e(),window.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[p,t?.length]);const b=e.useCallback(e=>{c(e)},[]),f=e.useMemo(()=>p&&t?t.slice(m.start,m.end):t||[],[t,p,m.start,m.end]);return r?Z("div",{className:"flex flex-col items-center justify-center min-h-96 p-8",children:[W(g,{className:"w-12 h-12 text-rose-500 mb-4"}),W("h3",{className:"text-xl font-bold text-gray-800 mb-3",children:"حدث خطأ"}),W("p",{className:"text-gray-600 text-center mb-6",children:r}),W("button",{onClick:d,className:"px-6 py-3 bg-gradient-to-r from-violet-500 to-indigo-500 \r text-white rounded-xl hover:from-violet-600 hover:to-indigo-600 \r transition-all duration-300 shadow-lg shadow-indigo-100/50",children:"إعادة المحاولة"})]}):!a||t&&0!==t.length?Z("div",{className:"",ref:u,children:[Z("div",{className:"grid grid-cols-2 gap-6 p-6",style:{minHeight:p?175*t.length:"auto"},children:[p&&m.start>0&&W("div",{style:{gridColumn:"span 2",height:175*m.start}}),f.map(e=>W(Re,{product:e,onSelect:b,checkAuthAndProceed:i},e.id))]}),a&&W("div",{ref:n,className:"flex items-center justify-center p-6",children:W("div",{className:"p-3 bg-white rounded-xl shadow-lg shadow-indigo-100/30",children:W(y,{className:"w-8 h-8 text-indigo-500 animate-spin"})})}),o&&W(Ue,{product:o,isOpen:!!o,onClose:()=>c(null),checkAuthAndProceed:i})]}):Z("div",{className:"flex flex-col items-center justify-center min-h-96 \r bg-gradient-to-b from-white to-gray-50",children:[W(y,{className:"w-12 h-12 text-indigo-500 animate-spin"}),W("p",{className:"text-gray-600 mt-4 font-medium",children:"جاري تحميل المنتجات..."})]})},(e,t)=>{if(e.products!==t.products){if(e.products?.length!==t.products?.length)return!1;for(let a=0;a<e.products.length;a++)if(e.products[a].id!==t.products[a].id)return!1}return e.loading===t.loading&&e.error===t.error&&e.onLoadMore===t.onLoadMore&&e.onProductSelect===t.onProductSelect&&e.checkAuthAndProceed===t.checkAuthAndProceed});Xe.displayName="ProductGrid";const Ue=e.memo(({product:a,isOpen:s,onClose:l,checkAuthAndProceed:i})=>{const{getFavoriteStatus:n,toggleFavorite:c,isPending:d}=fe(),u=n(a?.id),m=d(a?.id),{addToCart:h}=e.useContext(me),[g,b]=e.useState(null),[f,x]=e.useState(null),[N,C]=e.useState(1),[S,O]=e.useState(0),[j,I]=e.useState(!1),[T,E]=e.useState(!0);e.useEffect(()=>{if(s&&a){const e=a.variants[0];if(b(e),x(null),C(1),O(0),e){const t=e.images||[];Fe.preloadBatch(t,[t[0]]);const r=a.variants.filter(t=>t.id!==e.id).map(e=>e.images[0]);r.length>0&&(window.requestIdleCallback?window.requestIdleCallback(()=>{Fe.preloadBatch(r)}):setTimeout(()=>{Fe.preloadBatch(r)},1e3))}}},[s,a]);const A=e.useCallback(()=>{E(!1)},[]),$=e.useCallback(async()=>{a&&await i({requiresAuth:!0,onSuccess:async()=>{await c(a.id)}})},[i,a,c]),R=e.useCallback(e=>{if(!e||e.id===g?.id)return;E(!0);const t=e.images||[];t.length>0?Fe.preload(t[0]).then(()=>{b(e),x(null),O(0),E(!1),t.length>1&&Fe.preloadBatch(t.slice(1))}).catch(()=>{b(e),x(null),O(0),E(!1)}):(b(e),x(null),O(0),E(!1))},[g]),X=e.useCallback(()=>{a&&g&&f?(h(a,g,f.size,N),t.success("تم إضافة المنتج للسلة"),l()):t.error("يرجى اختيار المقاس")},[a,g,f,N,h,l]);if(!a||!s)return null;const U=(_=a.basePrice,(V=a.discountPrice)?Math.round((_-V)/_*100):null);var _,V;return Z(K,{children:[W(Ce,{isOpen:s,onClose:l,title:"تفاصيل المنتج",children:Z("div",{className:"p-6 space-y-6 bg-gray-50",dir:"rtl",children:[Z("div",{className:"relative aspect-square rounded-2xl overflow-hidden shadow-lg",children:[g&&W(v,{mode:"wait",children:Z(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"w-full h-full",children:[W(He,{src:g.images[S],alt:a.name,className:"w-full h-full cursor-zoom-in",onLoad:A,loadingClass:"bg-gray-100/80 backdrop-blur-sm",fallback:W("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:W("div",{className:"text-gray-400",children:"صورة غير متوفرة"})})}),W("div",{className:"absolute inset-0",onClick:()=>I(!0)})]},`${g.id}-${S}`)}),g?.images.length>1&&W("div",{className:"absolute bottom-4 inset-x-4 flex justify-center gap-2",children:g.images.map((e,t)=>W("button",{onClick:()=>O(t),className:"w-2 h-2 rounded-full transition-all\n                                        "+(S===t?"bg-sky-500 w-4":"bg-white/80")},t))}),Z("div",{className:"absolute top-4 right-4 bg-white/90 backdrop-blur-sm \r rounded-xl p-3 text-right shadow-md",children:[Z("div",{className:"flex items-baseline gap-2",children:[W("span",{className:"text-2xl font-bold text-gray-900",children:Le(a.discountPrice||a.basePrice)}),a.discountPrice&&W("span",{className:"text-sm text-gray-400 line-through",children:Le(a.basePrice)})]}),U&&Z("div",{className:"flex items-center gap-1 mt-1",children:[W(z,{className:"w-4 h-4 text-rose-500"}),Z("span",{className:"text-rose-500 text-sm font-medium",children:["خصم ",U,"%"]})]})]}),W("button",{onClick:$,className:"absolute top-4 left-4 p-2 rounded-full \n                                backdrop-blur-sm transition-all shadow-md\n                                "+(u?"bg-rose-100":"bg-white/90 hover:bg-rose-50"),children:m?W(y,{className:"w-5 h-5 text-rose-500 animate-spin"}):W(r,{className:"w-5 h-5 transition-transform\n                                    "+(u?"text-rose-500 fill-rose-500 scale-110":"text-gray-700")})})]}),Z("div",{className:"space-y-4",children:[Z("div",{className:"flex justify-between items-start",children:[Z("div",{className:"flex items-center gap-2",children:[a.rating>0&&Z("div",{className:"flex items-center gap-1",children:[W(o,{className:"w-5 h-5 text-amber-400 fill-amber-400"}),W("span",{className:"text-gray-900 font-bold",children:a.rating.toFixed(1)})]}),a.ratingCount>0&&Z("span",{className:"text-gray-500 text-sm",children:["(",a.ratingCount," تقييم)"]})]}),a.salesCount>0&&Z("span",{className:"text-sm text-gray-500",children:[a.salesCount," عملية شراء"]})]}),W("h1",{className:"text-2xl font-bold text-gray-900",children:a.name}),a.description&&W("p",{className:"text-gray-600 leading-relaxed",children:a.description})]}),Z("div",{className:"space-y-4",children:[Z("div",{className:"flex justify-between items-center",children:[Z("div",{className:"flex items-center gap-2",children:[W(L,{className:"w-5 h-5 text-sky-500"}),W("h3",{className:"font-bold text-gray-900",children:"اللون"})]}),W("span",{className:"text-sm text-gray-600",children:g?.colorName})]}),W(Me,{variants:a.variants,selectedVariant:g,onVariantSelect:R,showCollapsed:!1})]}),g?.sizes?.length>0&&Z("div",{className:"space-y-4",children:[Z("div",{className:"flex justify-between items-center",children:[Z("div",{className:"flex items-center gap-2",children:[W(F,{className:"w-5 h-5 text-sky-500"}),W("h3",{className:"font-bold text-gray-900",children:"المقاس"})]}),W("span",{className:"text-sm text-gray-600",children:f?.size||"اختر المقاس"})]}),W(De,{sizes:g.sizes,selectedSize:f,onSizeSelect:x})]}),a.features?.length>0&&Z("div",{className:"space-y-4",children:[Z("div",{className:"flex items-center gap-2 p-2",children:[W(p,{className:"w-5 h-5 text-sky-500"}),W("h3",{className:"font-bold text-gray-900",children:"مميزات المنتج"})]}),W("div",{className:"space-y-2",children:a.features.map((e,t)=>Z("div",{className:"bg-white rounded-xl p-3 \r flex items-center gap-3 shadow-sm border border-gray-100",children:[W("div",{className:"w-8 h-8 rounded-xl bg-sky-50\r flex items-center justify-center flex-shrink-0",children:W(p,{className:"w-4 h-4 text-sky-500"})}),W("span",{className:"text-gray-700",children:e})]},t))})]}),Z("div",{className:"space-y-4",children:[W("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:Z("div",{className:"flex justify-between items-center",children:[Z("div",{className:"flex items-center gap-3",children:[W("button",{onClick:()=>C(e=>Math.max(1,e-1)),className:"w-10 h-10 rounded-xl bg-gray-50 text-gray-700 flex items-center justify-center hover:bg-gray-100 transition-colors border border-gray-200",children:W(M,{className:"w-4 h-4"})}),W("span",{className:"text-xl font-bold text-gray-900 w-8 text-center",children:N}),W("button",{onClick:()=>C(e=>e+1),className:"w-10 h-10 rounded-xl bg-gray-50 text-gray-700 flex items-center justify-center hover:bg-gray-100 transition-colors border border-gray-200",children:W(D,{className:"w-4 h-4"})})]}),Z("div",{className:"text-right",children:[W("p",{className:"text-sm text-gray-500",children:"السعر الإجمالي"}),W("span",{className:"text-xl font-bold text-sky-500",children:Le((a.discountPrice||a.basePrice)*N)})]})]})}),Z("div",{className:"bg-white rounded-xl p-4 space-y-3 shadow-sm border border-gray-100",children:[Z("div",{className:"flex items-center gap-2",children:[W(q,{className:"w-5 h-5 text-sky-500"}),W("span",{className:"text-sm font-medium text-gray-900",children:"متطلبات الشراء"})]}),Z("div",{className:"flex gap-2 items-center justify-center",children:[Z("div",{className:"flex items-center gap-1 px-2 py-1.5 rounded-lg "+(g?"bg-green-50 text-green-600":"bg-gray-50 text-gray-500"),children:[W(L,{className:"w-4 h-4"}),W("span",{className:"text-xs",children:"اللون"}),g&&W(p,{className:"w-3.5 h-3.5"})]}),Z("div",{className:"flex items-center gap-1 px-2 py-1.5 rounded-lg "+(f?"bg-green-50 text-green-600":"bg-gray-50 text-gray-500"),children:[W(F,{className:"w-4 h-4"}),W("span",{className:"text-xs",children:"المقاس"}),f&&W(p,{className:"w-3.5 h-3.5"})]}),Z("div",{className:"flex items-center gap-1 px-2 py-1.5 rounded-lg bg-green-50 text-green-600",children:[W(H,{className:"w-4 h-4"}),W("span",{className:"text-xs",children:"الكمية"}),W(p,{className:"w-3.5 h-3.5"})]})]})]}),Z("button",{onClick:X,disabled:!f,className:"w-full bg-gradient-to-r from-sky-500 to-sky-600 text-white rounded-xl py-4 font-bold hover:brightness-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-md",children:[W(k,{className:"w-5 h-5"}),W("span",{children:"إضافة للسلة"})]})]}),Z("button",{onClick:()=>window.open("https://wa.me/+201033939828","_blank"),className:"w-full bg-emerald-50 text-emerald-600 rounded-xl p-4 \r flex items-center justify-center gap-2 hover:brightness-105 \r transition-all shadow-sm border border-emerald-100",children:[W(P,{className:"w-5 h-5"}),W("span",{children:"تحتاج مساعدة؟ تواصل معنا"})]})]})}),j&&g&&W(ze,{isOpen:j,onClose:()=>I(!1),imageUrl:g.images[S],className:"bg-white",onBeforeShow:()=>Fe.preload(g.images[S])})]})});Ue.displayName="ProductSheet";const _e=({onSelect:t})=>{const{slides:a,loading:r,error:s,fetchSlides:l}=be(),[i,n]=e.useState(0),[o,c]=e.useState(!1),[d,u]=e.useState(null),m=e.useRef({start:0,end:0}),h=e.useRef(null),p=e.useRef(null),y=e.useCallback(e=>{let t=e;e<0?t=a?.length-1:e>=a?.length&&(t=0),n(t)},[a?.length]),b=e.useCallback(e=>{u(e),y("right"===e?i-1:i+1),setTimeout(()=>u(null),300)},[i,y]);return e.useEffect(()=>{if(!(!a?.length||a.length<=1||o))return h.current=setInterval(()=>{b("left")},5e3),()=>h.current&&clearInterval(h.current)},[a,o,b]),r?W("div",{className:"relative h-48 md:h-96 rounded-xl overflow-hidden bg-primary-50",children:W("div",{className:"absolute inset-0 flex items-center justify-center",children:W(X,{className:"w-8 h-8 text-primary-500 animate-spin"})})}):s?W("div",{className:"relative h-48 md:h-96 rounded-xl overflow-hidden bg-primary-50 flex items-center justify-center",children:Z("div",{className:"text-center",children:[W(g,{className:"w-12 h-12 text-rose-500 mx-auto mb-4"}),W("p",{className:"text-slate-700 mb-4",children:"فشل في تحميل المحتوى"}),W("button",{onClick:l,className:"btn-primary",children:"إعادة المحاولة"})]})}):a?.length?W("div",{className:"relative h-48 md:h-96 rounded-xl overflow-hidden bg-gray-50 shadow-md",children:Z("div",{ref:p,className:"absolute inset-0 transition-transform duration-300",dir:"rtl",onTouchStart:e=>{c(!0),m.current={start:e.touches[0].clientX,startTime:Date.now(),end:e.touches[0].clientX}},onTouchMove:e=>{m.current.end=e.touches[0].clientX;const t=m.current.start-m.current.end,a=p.current;a&&(a.style.transform=`translateX(${.5*-t}px)`)},onTouchEnd:()=>{c(!1);const e=p.current;e&&(e.style.transform="");const{start:t,end:a,startTime:r}=m.current,s=t-a,l=Date.now()-r,i=Math.abs(s/l);(Math.abs(s)>50||i>.5)&&b(s>0?"left":"right"),m.current={start:0,end:0}},children:[W(v,{initial:!1,mode:"wait",children:a.map((e,a)=>W(w.div,{initial:{opacity:0,x:"left"===d?100:-100},animate:{opacity:a===i?1:0,x:a===i?0:"left"===d?-100:100,transition:{duration:.3}},exit:{opacity:0,x:"left"===d?-100:100},className:"absolute inset-0 cursor-pointer",onClick:()=>t?.(e.product),children:Z("div",{className:"relative h-full",children:[W("img",{src:e.imageUrl,alt:e.title,className:"w-full h-full object-cover",loading:0===a?"eager":"lazy"}),W("div",{className:"absolute"}),Z("div",{className:"absolute bottom-0 right-0 p-6 text-right max-w-2xl",children:[W("h3",{className:"text-2xl font-bold text-white mb-2 drop-shadow-lg",children:e.title}),W("p",{className:"text-sm text-gray-100 drop-shadow-md",children:e.description})]})]})},e.id))}),W("div",{className:"absolute bottom-2 inset-x-0 flex justify-center gap-2 z-20",children:a.map((e,t)=>W("button",{onClick:e=>{e.stopPropagation(),y(t)},className:"group","aria-label":`الانتقال إلى الشريحة ${t+1}`,children:W(w.div,{animate:{width:i===t?24:8,opacity:i===t?1:.7},className:"h-2 bg-white rounded-full transition-all duration-300 \r shadow-sm group-hover:opacity-90"})},t))})]})}):null},Ve=({status:e})=>{const t={pending:{icon:T,text:"قيد التنفيذ",class:"bg-gradient-to-r from-primary-50 to-primary-100 text-primary-600 border-primary-200",iconClass:"text-primary-500",shadowClass:"shadow-primary-200/20"},processing:{icon:a,text:"جاري التجهيز",class:"bg-gradient-to-r from-primary-50 to-primary-100 text-primary-600 border-primary-200",iconClass:"text-primary-500",shadowClass:"shadow-primary-200/20"},shipping:{icon:C,text:"في الطريق",class:"bg-gradient-to-r from-warning-50 to-warning-100 text-warning-600 border-warning-200",iconClass:"text-warning-500",shadowClass:"shadow-warning-200/20"},delivered:{icon:S,text:"تم التوصيل",class:"bg-gradient-to-r from-success-50 to-success-100 text-success-600 border-success-200",iconClass:"text-success-500",shadowClass:"shadow-success-200/20"},cancelled:{icon:E,text:"ملغي",class:"bg-gradient-to-r from-error-50 to-error-100 text-error-600 border-error-200",iconClass:"text-error-500",shadowClass:"shadow-error-200/20"}},r=t[e]||t.pending,s=r.icon;return Z("div",{className:`px-4 py-2 rounded-2xl text-sm inline-flex items-center gap-2 \n                    border shadow-sm hover:shadow-md transition-all duration-300\n                    backdrop-blur-xl ${r.class} ${r.shadowClass}`,children:[W(s,{className:`w-4 h-4 ${r.iconClass}`}),W("span",{className:"font-medium",children:r.text})]})},Ye=({order:e,onSelect:t})=>{return W(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"group cursor-pointer",onClick:()=>t(e),children:Z("div",{className:"relative overflow-hidden backdrop-blur-xl rounded-3xl \r border border-gray-200 bg-gradient-to-b from-white to-gray-50 p-5\r hover:border-gray-300 hover:shadow-lg\r transition-all duration-500",children:[W("div",{className:"absolute inset-0 bg-gradient-to-tr from-blue-100/20 to-indigo-100/20 \r opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),Z("div",{className:"relative",children:[Z("div",{className:"flex justify-between items-start mb-6",children:[W(Ve,{status:e.status}),Z("div",{className:"flex items-center gap-2 text-sky-600",children:[W(U,{className:"w-4 h-4"}),W("span",{className:"text-sm",children:(r=e.createdAt,new Date(r).toLocaleDateString("ar-EG",{month:"long",day:"numeric"}))})]})]}),W("div",{className:"flex gap-3 mb-6 overflow-x-auto hide-scrollbar py-2",children:e.items.map((e,t)=>Z("div",{className:"relative flex-shrink-0 group/item",children:[W("div",{className:"w-20 h-20 rounded-2xl overflow-hidden border-2 border-sky-200\r group-hover:border-sky-300 transition-all duration-500\r shadow-sm group-hover:shadow-md",children:W("img",{src:e.image||"http://localhost:5000/uploads/3fdf62c5-d260-4c86-8a24-617fe4035232.png",alt:e.productName,className:"w-full h-full object-cover transform group-hover/item:scale-110 \r transition-transform duration-500"})}),W("div",{className:"absolute -top-2 -right-2 w-6 h-6 rounded-full \r bg-gradient-to-r from-sky-500 to-sky-600\r flex items-center justify-center text-xs font-bold text-white\r shadow-md shadow-sky-400/25",children:e.quantity})]},t))}),Z("div",{className:"flex justify-between items-center pt-4 border-t border-sky-200",children:[Z("div",{className:"flex items-center gap-3",children:[W("div",{className:"p-2 rounded-xl bg-sky-100",children:W(k,{className:"w-4 h-4 text-sky-500"})}),Z("span",{className:"text-sky-600 text-sm",children:[e.totalQuantity," منتج"]})]}),Z("div",{className:"flex items-center gap-2",children:[W("span",{className:"text-sky-500 font-bold text-lg",children:(a=e.total,new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a))}),W(_,{className:"w-4 h-4 text-sky-500 transform \r group-hover:translate-x-1 group-hover:-translate-y-1\r transition-transform duration-300"})]})]})]})]})});var a,r},Je=({steps:t})=>{const r={pending:T,processing:a,shipping:C,delivered:S,cancelled:E},s=e.useMemo(()=>[...t].sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)).map((e,t,a)=>({...e,isLatest:0===t,isOldest:t===a.length-1})),[t]);return Z("div",{className:"relative py-4 px-4",children:[Z("div",{className:"absolute right-12 w-0 overflow-hidden h-full",children:[W("div",{className:"absolute inset-0 bg-gradient-to-b from-sky-300/0 via-sky-400/50 to-sky-300/0"}),W(w.div,{className:"absolute inset-0 bg-gradient-to-b from-sky-300/0 via-sky-400 to-sky-300/0",animate:{y:["0%","200%"],opacity:[0,1,0]},transition:{duration:3,repeat:1/0,ease:"linear"}})]}),s.map((e,t)=>{const a=e.completed,l=t===s.length-1,i=r[e.status]||T;return W(w.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{delay:.15*t},className:"relative "+(l?"":"mb-6"),children:Z("div",{className:"relative flex gap-6",children:[Z("div",{className:"relative",children:[W(w.div,{className:`w-8 h-8 rounded-xl relative z-10\n                           flex items-center justify-center\n                           transition-all duration-500 \n                           border-2 ${a?"bg-gradient-to-br from-sky-400 to-sky-500 border-sky-300":"bg-gradient-to-br from-white to-sky-50 border-sky-200"}\n                           'ring-4 ring-sky-200/50'\n                           shadow-lg shadow-sky-200/20 hover:shadow-xl hover:shadow-sky-300/30`,whileHover:{scale:1.1},whileTap:{scale:.95},children:W(i,{className:"w-4 h-4 text-sky-400"})}),!l&&W("div",{className:"absolute top-8 right-4 bottom-0 w-px bg-gradient-to-b from-sky-200 to-transparent"})]}),Z(w.div,{className:`flex-1 p-4 rounded-2xl backdrop-blur-xl\n                         border transition-all duration-300\n                         bg-gradient-to-br from-sky-50 to-white border-sky-200\n                         ${e.isLatest,"shadow-lg shadow-sky-200/30"}\n                         hover:shadow-xl hover:shadow-sky-300/20\n                         group`,whileHover:{scale:1.02,x:5},transition:{duration:.2},children:[Z("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full mb-2\n                              text-sm font-medium backdrop-blur-xl\n                              bg-gradient-to-r from-sky-100 to-sky-50 text-sky-600\n                              shadow-sm group-hover:shadow-md transition-all duration-300",children:[W("div",{className:"w-2 h-2 rounded-full bg-sky-500 animate-pulse"}),W("span",{children:e.description})]}),Z("div",{className:"flex items-center gap-2 text-sm",children:[W(U,{className:"w-4 h-4 "+(a?"text-sky-500":"text-slate-400")}),W("span",{className:(a?"text-sky-900":"text-slate-500")+" text-sm",children:new Intl.DateTimeFormat("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e.timestamp))})]}),!e.isLatest&&W("div",{className:"mt-2 text-xs text-sky-400 opacity-0 group-hover:opacity-100 transition-opacity",children:Be(e.timestamp)})]})]})},t)})]})},Be=e=>{const t=new Date(e),a=new Date,r=Math.floor((a-t)/1e3),s=Math.floor(r/60),l=Math.floor(s/60),i=Math.floor(l/24);return i>0?`${i} days ago`:l>0?`${l} hours ago`:s>0?`${s} minutes ago`:"Just now"},Ge=()=>W("div",{className:"grid grid-cols-2 gap-4 p-6 pt-0",children:[{icon:P,label:"محادثة واتساب",color:"text-sky-600",gradient:"from-sky-50/80 via-sky-100/50 to-white",onClick:()=>window.open("https://wa.me/+201033939828","_blank")},{icon:l,label:"اتصل بنا",color:"text-sky-600",gradient:"from-sky-50/80 via-sky-100/50 to-white",onClick:()=>window.open("tel:+201033939828","_blank")}].map((e,t)=>Z(w.button,{whileHover:{scale:1.03,y:-3},whileTap:{scale:.97},onClick:e.onClick,className:`bg-gradient-to-br ${e.gradient} \n                     rounded-2xl p-4 flex flex-col items-center gap-3\n                     border border-sky-200/60 backdrop-blur-xl \n                     shadow-lg shadow-sky-200/30\n                     hover:shadow-xl hover:border-sky-300/60\n                     transition-all duration-300 group`,children:[W(w.div,{className:`p-3 rounded-xl bg-gradient-to-br from-white to-sky-50 ${e.color}\n                       group-hover:scale-110 transition-all duration-300 \n                       shadow-md shadow-sky-200/40 ring-1 ring-sky-100`,whileHover:{rotate:[0,-10,10,-10,0]},transition:{duration:.5},children:W(e.icon,{className:"w-6 h-6"})}),W("span",{className:"text-sm text-sky-900 font-medium",children:e.label})]},t))}),Qe=({order:e,onCancel:t})=>{if(!e)return null;const a=e=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return Z("div",{className:"space-y-8 pt-8 pb-0",dir:"rtl",children:[e.tracking&&e.tracking.length>0&&W(Je,{steps:e.tracking}),Z("div",{className:"px-6 space-y-4",children:[Z("div",{className:"flex items-center justify-between",children:[W("h3",{className:"text-lg font-bold text-sky-900",children:"المنتجات"}),Z("span",{className:"text-sm text-sky-600",children:[e.totalQuantity," منتج"]})]}),W("div",{className:"space-y-4",dir:"ltr",children:e.items.map((e,t)=>W(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"group bg-gradient-to-br from-sky-50 via-white to-sky-50\r backdrop-blur-xl rounded-2xl p-4 border border-sky-200\r shadow-lg shadow-sky-200/20 hover:shadow-xl \r hover:shadow-sky-300/20 transition-all duration-300",children:Z("div",{className:"flex gap-4",children:[Z("div",{className:"relative w-24 h-24 rounded-xl overflow-hidden border-2 border-sky-200\r group-hover:border-sky-300 transition-all duration-300 shadow-md",children:[W("img",{src:e.image,alt:e.productName,className:"w-full h-full object-cover transform group-hover:scale-110 \r transition-transform duration-500"}),W("div",{className:"absolute inset-0 bg-gradient-to-t from-sky-900/30 to-transparent"}),Z("div",{className:"absolute bottom-2 right-2 bg-sky-900/40 backdrop-blur-md\r rounded-full px-2 py-1 text-xs text-white shadow-lg",children:[e.quantity,"×"]})]}),W("div",{className:"flex-1",children:Z("div",{className:"flex justify-between",children:[W("span",{className:"font-bold text-sky-500",children:a(e.totalPrice)}),Z("div",{className:"text-right",children:[W("h4",{className:"font-bold text-sky-900 mb-1",children:e.productName}),W("p",{className:"text-sm text-sky-600",children:e.variant}),W("p",{className:"text-sm text-sky-400 mt-1",children:e.size})]})]})})]})},t))})]}),W("div",{className:"px-6",children:Z("div",{className:"bg-gradient-to-br from-sky-50 via-white to-sky-50 backdrop-blur-xl\r rounded-2xl p-5 border border-sky-200 space-y-4 shadow-lg shadow-sky-200/20\r hover:shadow-xl hover:shadow-sky-300/20 transition-all duration-300",children:[Z("div",{className:"flex justify-between items-center",children:[W("span",{className:"text-sky-600",children:"المجموع"}),W("span",{className:"text-sky-900",children:a(e.subtotal)})]}),e.coupon&&Z("div",{className:"flex justify-between items-center",children:[Z("div",{className:"flex items-center gap-2",children:[W(z,{className:"w-4 h-4 text-teal-500"}),Z("span",{className:"text-teal-600",children:["كوبون ",e.coupon.code]}),Z("span",{className:"text-sm text-teal-500",children:["(","percentage"===e.coupon.discountType?`${e.coupon.discountValue}%`:a(e.coupon.discountValue),")"]})]}),Z("span",{className:"text-teal-500 font-medium",children:["- ",a(e.discount)]})]}),Z("div",{className:"flex justify-between items-center",children:[W("span",{className:"text-sky-600",children:"الشحن"}),W("span",{className:"text-sky-500 font-medium",children:0===e.shippingFee?"مجاناً":a(e.shippingFee)})]}),W("div",{className:"h-px bg-gradient-to-r from-transparent via-sky-200 to-transparent"}),Z("div",{className:"flex justify-between items-center",children:[W("span",{className:"font-bold text-sky-900",children:"الإجمالي"}),W("span",{className:"text-xl font-bold bg-gradient-to-r from-sky-500 to-sky-600 \r bg-clip-text text-transparent",children:a(e.total)})]})]})}),["pending","processing"].includes(e.status)&&W("div",{className:"px-6 pt-4 pb-0",children:W(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>t(e.id),className:"w-full bg-gradient-to-r from-rose-50 to-rose-100\r text-rose-600 rounded-2xl py-4 px-6 font-medium\r shadow-lg shadow-rose-200/20 hover:shadow-xl\r hover:shadow-rose-300/20 transition-all duration-300\r border border-rose-200 backdrop-blur-xl",children:"إلغاء الطلب"})}),W(Ge,{})]})},We=({onClose:t,initialOrderId:r=null})=>{const{orders:s,loading:l,error:i,fetchOrders:n,cancelOrder:o}=ye(),[c,d]=e.useState(null),[u,m]=e.useState("all"),[h,p]=e.useState(!0);if(e.useRef(0),e.useEffect(()=>{if(r&&s.length){const e=s.find(e=>e.id===r);e&&d(e)}},[s,r]),l)return W(w.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-white z-50 flex items-center justify-center",children:Z("div",{className:"relative",children:[W("div",{className:"w-16 h-16 rounded-full border-4 border-sky-300/30 \r animate-spin border-t-sky-500 shadow-lg"}),W("div",{className:"absolute inset-0 flex items-center justify-center",children:W(a,{className:"w-6 h-6 text-sky-500"})})]})});if(i)return W(w.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-white z-50 flex items-center justify-center p-4",dir:"rtl",children:Z("div",{className:"max-w-md w-full bg-gradient-to-br from-white to-sky-50 backdrop-blur-xl \r rounded-3xl p-8 border border-sky-200 text-center shadow-xl shadow-sky-200/20",children:[W(g,{className:"w-16 h-16 text-rose-500 mx-auto mb-4"}),W("h3",{className:"text-xl font-bold text-sky-900 mb-2",children:"حدث خطأ"}),W("p",{className:"text-sky-600 mb-6",children:i}),W(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:n,className:"bg-gradient-to-r from-sky-500 to-sky-600 text-white \r rounded-xl px-6 py-3 font-medium shadow-lg shadow-sky-500/25 \r hover:shadow-xl hover:shadow-sky-500/30 \r transition-all duration-300",children:"إعادة المحاولة"})]})});const y=s.filter(e=>"all"===u||e.status===u);return Z(K,{children:[W("div",{className:"fixed inset-0 bg-white z-40",children:Z("div",{className:"h-full flex flex-col",children:[Z(w.div,{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-xl border-b border-sky-100\r shadow-sm",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[W("div",{className:"px-4 py-4",children:Z("div",{className:"flex justify-between items-center",children:[W(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:t,className:"p-2 rounded-xl bg-sky-50 text-sky-500 \r hover:bg-sky-100 transition-colors",children:W(E,{className:"w-5 h-5"})}),W("h2",{className:"text-xl font-bold text-sky-900",children:"طلباتي"}),W("div",{className:"w-9"})]})}),W(w.div,{className:"px-4 pb-4 overflow-hidden",animate:{height:h?"auto":0},transition:{duration:.3},children:W("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar py-1",children:[{id:"all",label:"الكل"},{id:"pending",label:"قيد التنفيذ"},{id:"processing",label:"جاري التجهيز"},{id:"shipping",label:"في الطريق"},{id:"delivered",label:"تم التوصيل"},{id:"cancelled",label:"ملغي"}].map((e,t)=>W(w.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*t},onClick:()=>m(e.id),className:"px-4 py-2 rounded-xl text-sm whitespace-nowrap transition-all\n                              shadow-sm "+(u===e.id?"bg-gradient-to-r from-sky-500 to-sky-600 text-white font-medium shadow-lg shadow-sky-500/25":"bg-sky-50 text-sky-600 hover:bg-sky-100"),children:e.label},e.id))})})]}),W("div",{className:"flex-1 overflow-auto hide-scrollbar",children:W("div",{className:"px-4 py-4 space-y-4",children:W(v,{mode:"popLayout",children:y.length>0?y.map((e,t)=>W(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*t},children:W(Ye,{order:e,onSelect:d})},e.id)):Z(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-16",children:[Z("div",{className:"w-24 h-24 mx-auto mb-6 relative",children:[W("div",{className:"absolute inset-0 bg-sky-400/20 rounded-full animate-ping"}),W("div",{className:"relative w-full h-full rounded-full bg-gradient-to-b \r from-sky-50 to-white flex items-center justify-center\r border border-sky-200 shadow-lg shadow-sky-200/20",children:W(a,{className:"w-12 h-12 text-sky-500"})})]}),W("h3",{className:"text-xl font-bold text-sky-900 mb-2",children:"لا توجد طلبات"}),W("p",{className:"text-sky-600 mb-8",children:"ابدأ التسوق الآن واستمتع بمجموعتنا المميزة"}),W(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:t,className:"bg-gradient-to-r from-sky-500 to-sky-600 \r text-white rounded-2xl px-8 py-3 font-medium\r shadow-lg shadow-sky-500/25 hover:shadow-xl \r hover:shadow-sky-500/30 transition-all duration-300",children:"تسوق الآن"})]})})})})]})}),W(Ce,{isOpen:!!c,onClose:()=>d(null),title:"تفاصيل الطلب",children:W(Qe,{order:c,onCancel:o})})]})},Ze=({onClose:t,onProductSelect:a,checkAuthAndProceed:s})=>{const{favorites:l,loading:i}=fe(),[n,o]=e.useState(!1),[c,d]=e.useState(null);e.useRef(!1);const u=e.useCallback(()=>{o(!0),setTimeout(t,200)},[t]);return i&&0===l.length?W(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-white z-40 flex items-center justify-center",children:Z("div",{className:"relative",children:[W("div",{className:"w-16 h-16 rounded-full border-4 border-primary-200 \r animate-spin border-t-primary-500 shadow-lg"}),W("div",{className:"absolute inset-0 flex items-center justify-center",children:W(r,{className:"w-6 h-6 text-primary-500"})})]})}):Z(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-white z-40",children:[Z("div",{className:"h-full flex flex-col",children:[W("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-xl border-b border-gray-200 shadow-sm",children:W("div",{className:"px-4 py-4",children:Z("div",{className:"flex justify-between items-center",children:[W(w.button,{onClick:u,whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 rounded-xl bg-gray-50 text-slate-600 \r hover:bg-gray-100 hover:text-slate-800 transition-all duration-200",children:W(E,{className:"w-6 h-6"})}),W("h2",{className:"text-2xl font-bold text-slate-800",children:"المفضلة"}),W("div",{className:"w-10"})," "]})})}),W(w.div,{className:"flex-1 overflow-auto pb-8",initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{duration:.2},children:W("div",{className:"p-4 space-y-4",children:l.length>0?Z(K,{children:[W("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:l.map(e=>W(Re,{product:e,onSelect:()=>{d(e),a?.(e)},checkAuthAndProceed:s},e.id))}),i&&W("div",{className:"flex justify-center py-4",children:Z("div",{className:"relative",children:[W("div",{className:"w-10 h-10 rounded-full border-3 border-primary-200 \r animate-spin border-t-primary-500"}),W("div",{className:"absolute inset-0 flex items-center justify-center",children:W(r,{className:"w-4 h-4 text-primary-500"})})]})})]}):Z(w.div,{className:"text-center py-12",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[Z("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-primary-50 to-white \r mx-auto mb-6 flex items-center justify-center relative overflow-hidden\r border border-primary-200 shadow-lg shadow-primary-200/20",children:[W("div",{className:"absolute inset-0 bg-gradient-to-tr from-primary-400/20 to-primary-400/0 \r animate-spin-slow rounded-full"}),W(r,{className:"w-12 h-12 text-primary-500 relative z-10"})]}),W("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"قائمة المفضلة فارغة"}),W("p",{className:"text-slate-600 mb-6",children:"اكتشف منتجاتنا وأضف ما يعجبك إلى المفضلة"}),W(w.button,{onClick:u,whileHover:{scale:1.02},whileTap:{scale:.98},className:"btn-primary",children:"تسوق الآن"})]})})})]}),c&&W(ProductSheet,{product:c,isOpen:!0,onClose:()=>d(null),checkAuthAndProceed:s})]})},Ke=e=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),et=x.memo(({item:t,onRemove:r,onUpdateQuantity:s})=>{const[l,i]=e.useState(!1),[n,o]=e.useState(!1),c=e.useCallback(e=>{i(!0),e<1?o(!0):(s(t.cartItemId,e),setTimeout(()=>i(!1),300))},[t.cartItemId,s]),d=e.useCallback(()=>{n?(r(t.cartItemId),o(!1)):o(!0)},[n,t.cartItemId,r]);return Z("div",{className:"group relative card p-3 sm:p-4 \r transition-all duration-200",dir:"rtl",children:[n&&W("div",{className:"absolute inset-0 z-20 rounded-2xl \r bg-white/95 backdrop-blur-sm\r flex items-center justify-center\r transition-opacity duration-200",children:Z("div",{className:"flex flex-col items-center gap-3 p-4 text-center",children:[W(g,{className:"w-8 h-8 text-red-500"}),W("p",{className:"text-slate-800 font-medium",children:"هل تريد حذف هذا المنتج؟"}),Z("div",{className:"flex gap-2 mt-2",children:[W("button",{onClick:d,className:"px-4 py-2 bg-rose-500 text-white rounded-xl\r font-medium hover:bg-rose-600 \r transition-colors duration-200",children:"تأكيد الحذف"}),W("button",{onClick:()=>o(!1),className:"btn-secondary",children:"إلغاء"})]})]})}),W(v,{children:l&&W(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-10 rounded-2xl bg-sky-50/30 \r flex items-center justify-center",children:W("div",{className:"bg-white/90 p-2 rounded-full shadow-lg",children:W(p,{className:"w-5 h-5 text-sky-500"})})})}),Z("div",{className:"relative flex gap-3 sm:gap-4",children:[W("div",{className:"relative flex-none w-20 sm:w-28 aspect-square",children:Z("div",{className:"relative h-full rounded-xl overflow-hidden \r bg-gradient-to-b from-gray-50 to-white\r ring-1 ring-gray-100 group-hover:ring-sky-100\r transition-all duration-300",children:[W("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover transform transition-all \r duration-500 group-hover:scale-105"}),Z(w.div,{layout:!0,className:"absolute bottom-1.5 left-1.5 \r bg-white/95 backdrop-blur-sm\r px-2 py-0.5 text-xs font-semibold\r text-sky-600 rounded-full shadow-md\r ring-1 ring-sky-100",children:["×",t.quantity]})]})}),W(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>!l&&o(!0),className:" absolute left-0 top-0 z-10 flex-left p-2 sm:p-2.5 rounded-xl\r bg-red-50 text-red-500 hover:bg-red-100\r transition-all duration-300\r disabled:opacity-50",disabled:l,"aria-label":"حذف المنتج",children:W(Y,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),Z("div",{className:"flex-1 min-w-0 flex flex-col justify-between gap-2",children:[Z("div",{className:"space-y-1",children:[W("h3",{className:"font-bold text-gray-900 \r group-hover:text-sky-600 \r transition-colors duration-300\r text-sm sm:text-base truncate",children:t.name}),Z("div",{className:"flex items-center gap-1.5",children:[W(a,{className:"w-3.5 h-3.5 text-gray-400"}),Z("p",{className:"text-xs sm:text-sm text-gray-500",children:[t.size," - ",t.colorName]})]}),Z("div",{className:"flex items-baseline gap-1.5",children:[W(w.span,{layout:!0,className:"text-base sm:text-lg font-bold \r bg-gradient-to-l from-sky-600 to-sky-500 \r bg-clip-text text-transparent",children:Ke(t.price)}),W("span",{className:"text-xs sm:text-sm text-gray-400",children:"/ القطعة"})]})]}),Z("div",{className:"flex justify-between items-end \r pt-2 sm:pt-3 mt-1 sm:mt-2\r border-t border-gray-100",children:[Z("div",{className:"flex items-center gap-1 p-1 \r bg-gray-50 rounded-lg \r group-hover:bg-sky-50/50",children:[W(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(t.quantity+1),className:"w-7 h-7 sm:w-8 sm:h-8 rounded-md bg-white \r text-gray-600 flex items-center justify-center \r shadow-sm hover:bg-sky-50 hover:text-sky-600",disabled:l,children:W(D,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),W(w.div,{layout:!0,className:"w-8 sm:w-10 text-center",children:W("span",{className:"text-gray-800 font-semibold \r text-sm sm:text-base",children:t.quantity})}),W(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(t.quantity-1),className:"w-7 h-7 sm:w-8 sm:h-8 rounded-md bg-white \r text-gray-600 flex items-center justify-center \r shadow-sm hover:bg-sky-50 hover:text-sky-600\r disabled:opacity-50 disabled:cursor-not-allowed",disabled:t.quantity<=1||l,children:W(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]}),Z("div",{className:"text-right ",children:[W("span",{className:"text-xs sm:text-sm text-gray-500",children:"الإجمالي"}),W(w.div,{layout:!0,className:"text-base sm:text-lg font-bold \r bg-gradient-to-l from-sky-600 to-sky-500 \r bg-clip-text text-transparent",children:Ke(t.price*t.quantity)})]})]})]})]})]})}),tt=({isProcessing:t,onApplyCoupon:a})=>{const[r,s]=e.useState(""),l=e.useRef(null),{cartTotal:i}=e.useContext(me),{validateCoupon:n,currentCoupon:o,validatingCoupon:c,error:d,clearError:u,calculateDiscount:m,clearCoupon:h}=pe();e.useEffect(()=>()=>{h()},[h]);const p=e.useCallback(async e=>{if(e?.preventDefault(),!r.trim()||c||t)return;const s=await n(r,i);if(s){const e=m(i);a({...s,discount:e})}},[r,c,t,n,i,m,a]),b=e.useCallback(e=>{const t=e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"");s(t),d&&u()},[d,u]),f=e.useCallback(()=>{s(""),h(),a(null)},[h,a]);return Z("div",{className:"space-y-3",dir:"rtl",children:[Z("form",{onSubmit:p,className:"relative group",children:[Z("div",{className:"relative",children:[W("input",{ref:l,type:"text",value:r,onChange:b,placeholder:"أدخل كود الخصم",maxLength:8,className:"w-full px-4 py-3 rounded-xl bg-white border border-sky-100\r focus:border-sky-500 focus:ring-2 focus:ring-sky-200\r transition-all duration-300 text-gray-800\r placeholder:text-gray-400 tracking-wide\r disabled:opacity-60 disabled:cursor-not-allowed\r group-hover:border-sky-200",disabled:t||c}),r&&Z(w.span,{initial:{opacity:0},animate:{opacity:1},className:"absolute left-28 top-1/2 -translate-y-1/2 text-xs text-gray-400",children:[r.length,"/8"]}),Z(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:!r.trim()||t||c,className:"absolute left-2 top-2 px-4 py-1.5 bg-sky-500 text-white rounded-lg\r font-medium hover:bg-sky-600 transition-all duration-300\r disabled:opacity-50 disabled:cursor-not-allowed\r hover:shadow-md hover:shadow-sky-100\r flex items-center gap-2",children:[c?W(y,{className:"w-4 h-4 animate-spin"}):W(V,{className:"w-4 h-4"}),W("span",{children:"تطبيق"})]})]}),W(w.p,{initial:!1,animate:{opacity:r?0:.7},className:"absolute -bottom-6 right-2 text-xs text-gray-500 pointer-events-none",children:"ادخل كود الخصم الخاص بك للحصول على خصم إضافي"})]}),Z(v,{mode:"wait",children:[d&&Z(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 text-red-600 bg-red-50/80 \r backdrop-blur-sm px-4 py-3 rounded-xl text-sm\r border border-red-100 shadow-sm",children:[W(g,{className:"w-4 h-4"}),W("span",{children:d})]}),o&&Z(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center justify-between gap-2 \r bg-emerald-50/80 backdrop-blur-sm px-4 py-3 rounded-xl\r border border-emerald-100 shadow-sm",children:[Z("div",{className:"flex items-center gap-3",children:[W("div",{className:"bg-emerald-100 p-2 rounded-lg",children:W(V,{className:"w-5 h-5 text-emerald-600"})}),Z("div",{children:[W("p",{className:"font-bold text-emerald-700",children:"percentage"===o.discountType?`خصم ${o.discountValue}%`:`خصم ${Ke(o.discountValue)}`}),W("p",{className:"text-sm text-emerald-600",children:"تم تطبيق كود الخصم بنجاح"})]})]}),Z("div",{className:"flex flex-col items-end",children:[W("span",{className:"font-bold text-emerald-600",children:Ke(m(i))}),W(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:f,className:"text-xs text-emerald-600 hover:text-emerald-700\r underline underline-offset-2",children:"إزالة"})]})]})]})]})},at=({orderDetails:t,handleConfirmOrder:a,onBack:r,isLoading:s})=>{const{cartTotal:l,cart:n}=e.useContext(me),{currentCoupon:o}=pe(),[c,d]=e.useState(null),{shippingCost:m,discount:h,finalTotal:g,itemsWithDiscount:b}=e.useMemo(()=>{const e=l>500?0:25,t=c||o,a=t?"percentage"===t.discountType?l*t.discountValue/100:t.discountValue:0,r=n.map(e=>{const r=e.price*e.quantity,s=t?"percentage"===t.discountType?r*t.discountValue/100:r/l*a:0;return{...e,originalTotal:r,discountAmount:Math.round(100*s)/100,finalTotal:Math.round(100*(r-s))/100}});return{shippingCost:e,discount:Math.round(100*a)/100,finalTotal:Math.round(100*(l+e-a))/100,itemsWithDiscount:r}},[n,l,o,c]),f=e.useCallback(()=>{a(c?.code||"")},[a,c,l,m,h,g,b]);return Z(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4 font-arabic",children:[Z("div",{className:"bg-gradient-to-br from-white to-sky-50 rounded-3xl p-6 space-y-6\r border border-sky-100 shadow-sm relative overflow-hidden",children:[W("div",{className:"absolute inset-0 opacity-5 bg-repeat"}),Z("div",{className:"relative space-y-2",dir:"rtl",children:[W("div",{className:"flex items-center justify-between",children:Z("div",{className:"flex items-center gap-3",children:[W("div",{className:"bg-sky-100 rounded-full p-2",children:W(V,{className:"w-5 h-5 text-sky-600"})}),W("h4",{className:"font-bold text-xl text-gray-800",children:"كوبون الخصم"})]})}),W(tt,{onApplyCoupon:d,isProcessing:s})]}),Z("div",{className:"relative space-y-2 pt-4 border-t border-sky-100",dir:"rtl",children:[Z("div",{className:"flex items-center gap-3",children:[W("div",{className:"bg-sky-100 rounded-full p-2",children:W(i,{className:"w-5 h-5 text-sky-600"})}),W("h4",{className:"font-bold text-xl text-gray-800",children:"عنوان التوصيل"})]}),Z(w.div,{className:"bg-white rounded-2xl p-5 space-y-3 border border-sky-100 shadow-sm\r hover:shadow-md transition-shadow duration-300",whileHover:{scale:1.01},children:[W("p",{className:"text-gray-800 text-lg leading-relaxed",children:t.address.details}),Z("p",{className:"text-gray-500 flex items-center gap-2",children:[W("span",{children:t.address.governorate}),W("span",{className:"text-sky-500",children:"•"}),W("span",{children:t.address.district})]})]})]}),W("div",{className:"relative space-y-4 pt-6 border-t border-sky-100",dir:"rtl",children:Z("div",{className:"space-y-4 bg-white rounded-2xl p-5 border border-sky-100",children:[b.map((e,t)=>Z("div",{className:"flex justify-between items-start pb-4 border-b border-gray-100 last:border-0 last:pb-0",children:[Z("div",{className:"space-y-1",children:[Z("div",{className:"flex items-center gap-2",children:[W("span",{className:"font-medium text-gray-800",children:e.name}),Z("span",{className:"text-gray-500",children:["×",e.quantity]})]}),e.discountAmount>0&&Z(w.div,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-emerald-600",children:["وفرت ",Ke(e.discountAmount)]})]}),Z("div",{className:"text-left",children:[W("div",{className:"font-bold text-gray-800",children:Ke(e.originalTotal)}),e.discountAmount>0&&W(w.div,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-emerald-600 font-bold",children:Ke(e.finalTotal)})]})]},t)),Z("div",{className:"space-y-3 pt-4 border-t border-sky-100",children:[Z("div",{className:"flex justify-between text-gray-600",children:[W("span",{children:"المجموع الفرعي"}),W("span",{className:"font-bold",children:Ke(l)})]}),Z("div",{className:"flex justify-between text-gray-600",children:[W("span",{children:"رسوم التوصيل"}),W("span",{className:"font-bold "+(0===m?"text-emerald-600":""),children:0===m?"مجاناً":Ke(m)})]}),h>0&&Z("div",{className:"flex justify-between text-emerald-600",children:[W("span",{children:"الخصم"}),Z("span",{className:"font-bold",children:["- ",Ke(h)]})]}),Z("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",dir:"ltr",children:[W("span",{className:"text-xl font-bold text-sky-600",children:Ke(g)}),W("span",{className:"text-lg text-gray-800",children:"المجموع الكلي"})]})]})]})})]}),Z("div",{className:"space-y-3",children:[W(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},disabled:s,onClick:f,className:"w-full bg-gradient-to-r from-sky-500 to-sky-600 \r text-white rounded-xl py-4 font-bold text-lg\r disabled:opacity-50 flex items-center justify-center gap-3",children:s?W(y,{className:"w-6 h-6 animate-spin"}):Z(K,{children:[W(p,{className:"w-6 h-6"}),W("span",{children:"تأكيد الطلب"})]})}),Z(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:r,className:"w-full bg-gray-100 text-gray-700 rounded-xl py-4 \r font-bold text-lg flex items-center justify-center gap-3",children:[W(u,{className:"w-6 h-6"}),W("span",{children:"العودة للسلة"})]})]})]})},rt=({orderId:e,onViewOrders:t,emptyCart:a})=>Z(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-12 space-y-6",children:[W("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-emerald-100 to-emerald-50 mx-auto flex items-center justify-center shadow-md",children:W(w.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:W(p,{className:"w-12 h-12 text-emerald-500"})})}),W("div",{className:"space-y-4",children:W("h3",{className:"text-xl font-bold text-gray-800 p-2",children:"تم تأكيد طلبك بنجاح"})}),W(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{a(),t()},className:"bg-gradient-to-r from-sky-500 to-sky-600 text-white rounded-xl px-8 py-3 font-bold hover:shadow-lg hover:brightness-105 transition-all duration-300",children:"متابعة الطلب"})]}),st=()=>Z("div",{className:"text-center py-12 space-y-4 bg-sky-50 rounded-xl",children:[W("div",{className:"w-24 h-24 rounded-full bg-sky-100 mx-auto flex items-center justify-center",children:W(k,{className:"w-12 h-12 text-sky-600"})}),W("h3",{className:"text-xl font-bold text-gray-800",children:"السلة فارغة"}),W("p",{className:"text-gray-600",children:"لم تقم بإضافة أي منتجات للسلة بعد"})]}),lt=({onOrderCreated:a,checkAuthAndProceed:r})=>{const{cart:s,isCartOpen:l,setIsCartOpen:i,removeFromCart:n,updateQuantity:o,emptyCart:c}=e.useContext(me),{userInfo:d}=e.useContext(ue),{createOrder:u}=ye(),[m,h]=e.useState({isProcessing:!1,confirmation:{show:!1,orderId:null,success:!1,total:0},error:null}),p=e.useCallback(()=>{r({requiresAuth:!0,requiresAddress:!0,onSuccess:()=>{h(e=>({...e,confirmation:{show:!0,orderId:null,success:!1,total:0}}))}})},[r]),g=e.useCallback(async e=>{try{h(e=>({...e,isProcessing:!0,error:null}));const a={items:s.map(e=>({variant_id:e.variantId,size:e.size,quantity:e.quantity})),addressId:d.addresses[0].id,coupon:e||0},r=await u(a);r.success?(h(e=>({...e,isProcessing:!1,confirmation:{show:!0,orderId:r.order.id,success:!0,total:r.order.total,coupon:r.order.coupon}})),t.success("تم إنشاء طلبك بنجاح",{style:{background:"#EFF6FF",color:"#1E40AF"}})):(h(e=>({...e,isProcessing:!1,error:r.error})),t.error(r.error))}catch(a){h(e=>({...e,isProcessing:!1,error:a.message})),t.error(a.message)}},[s,d?.addresses,u]),y=e.useCallback(()=>{h(e=>({...e,confirmation:{show:!1,orderId:null,success:!1,total:0}}))},[]),b=e.useCallback(()=>{i(!1),h({isProcessing:!1,confirmation:{show:!1,orderId:null,success:!1,total:0},error:null}),a(m.confirmation.orderId)},[m.confirmation.orderId,a,i]);return W(Ce,{isOpen:l,onClose:()=>i(!1),title:"سلة التسوق",className:"bg-white",children:W("div",{className:"p-4",children:W(v,{mode:"wait",children:m.confirmation.success?W(rt,{orderId:m.confirmation.orderId,onViewOrders:b,emptyCart:c,className:"bg-white shadow-lg rounded-xl p-6"}):m.confirmation.show?W(at,{orderDetails:{address:d.addresses[0],items:s,error:m.error},handleConfirmOrder:g,onBack:y,isLoading:m.isProcessing,className:"bg-white shadow-lg rounded-xl p-6"}):0===s.length?W(st,{}):Z("div",{className:"space-y-6",children:[W("div",{className:"space-y-4",children:s.map(e=>W(et,{item:e,onRemove:n,onUpdateQuantity:o},`${e.id}-${e.variantId}-${e.size}`))}),Z(w.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:p,className:"w-full bg-gradient-to-r from-sky-500 to-sky-600 text-white rounded-xl py-4 font-bold hover:shadow-lg hover:brightness-105 transition-all duration-300 flex items-center justify-center gap-2",children:[W(k,{className:"w-5 h-5"}),W("span",{children:"متابعة الشراء"})]})]})})})})},it=e.memo(({selectedCategory:t,onSelect:a})=>{const r=e.useMemo(()=>[{id:"all",name:"الكل",icon:k,locked:!1,comingSoon:!1},{id:"women",name:"حريمي",icon:k,locked:!1,comingSoon:!1},{id:"men",name:"رجالي",icon:k,locked:!1,comingSoon:!1},{id:"bags",name:"شنط",icon:k,locked:!0,comingSoon:!0},{id:"accessories",name:"إكسسوارات",icon:k,locked:!0,comingSoon:!0}],[]);return Z("div",{className:"relative",dir:"rtl",children:[W("div",{className:"px-4 pt-3 pb-1",children:W("div",{className:"overflow-x-auto hide-scrollbar",children:W("div",{className:"flex gap-2 pb-2",children:r.map(e=>Z("button",{onClick:()=>!e.locked&&a(e.id),className:`relative min-w-max flex items-center gap-2 px-4 py-2.5 rounded-full \n                          text-sm font-medium transition-all duration-200 ${e.locked?"bg-primary-50/30 text-primary-600/50 opacity-80":t===e.id?"bg-gradient-primary text-white shadow-lg":"bg-gray-50 text-slate-700 hover:bg-gray-100 hover:shadow-sm"} ${e.locked?"":"hover:scale-102 active:scale-98"}`,disabled:e.locked,children:[W(e.icon,{className:"w-4 h-4 "+(e.locked?"text-primary-400/70":t===e.id?"text-white":"text-primary-600")}),W("span",{children:e.name}),e.comingSoon&&Z("div",{className:"flex items-center gap-1",children:[W(J,{className:"w-3.5 h-3.5 text-primary-400"}),W("span",{className:"text-xs text-primary-400",children:"قريباً"})]}),t===e.id&&!e.locked&&W("div",{className:"absolute -right-1 -top-1",children:W(n,{className:"w-4 h-4 text-white"})})]},e.id))})})}),W("div",{className:"absolute top-0 right-0 w-12 h-full bg-gradient-to-l from-white to-transparent pointer-events-none"}),W("div",{className:"absolute top-0 left-0 w-12 h-full bg-gradient-to-r from-white to-transparent pointer-events-none"})]})});it.displayName="HorizontalCategoryScroller";const nt={initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0}},ot=x.memo(({quantity:e})=>W("div",{className:"absolute -top-2 -right-2",children:W(w.div,{variants:nt,initial:"initial",animate:"animate",exit:"exit",className:"w-6 h-6 rounded-full bg-gradient-primary flex items-center justify-center shadow-lg",children:W("span",{className:"text-white text-xs font-bold",children:e>99?"99+":e})})})),ct=x.memo(({onFavoritesClick:t,onCartClick:a})=>{const{cart:s}=e.useContext(me),l=x.useMemo(()=>s?.reduce((e,t)=>e+t.quantity,0)||0,[s]);return Z("div",{className:"fixed bottom-6 right-6 flex flex-col gap-4 z-20",role:"group","aria-label":"Floating actions",children:[W("button",{onClick:t,className:"w-14 h-14 rounded-full bg-gradient-primary  flex items-center justify-center shadow-floating hover:scale-105 active:scale-95 transition-transform duration-200","aria-label":"Favorites",children:W(r,{className:"w-6 h-6 text-white"})}),Z("button",{onClick:a,className:"relative w-14 h-14 rounded-full bg-gradient-primary  flex items-center justify-center shadow-floating hover:scale-105 active:scale-95 transition-transform duration-200","aria-label":`Cart with ${l} items`,children:[W(Q,{className:"w-6 h-6 text-white"}),l>0&&W(ot,{quantity:l})]})]})}),dt=({productCode:t})=>{const{userInfo:a,isAuthenticated:r,login:s,updateAddress:l,addAddress:i}=e.useContext(ue),{isCartOpen:n,setIsCartOpen:o}=e.useContext(me),{products:c,loading:d,loadMore:u,updateFilters:m,setPage:h,totalPages:p}=ge({}),{slides:g,loading:y}=be(),[b,f]=e.useState(!1),[x,w]=e.useState({selectedCategory:"all",showProfile:!1,showOrders:!1,showFavorites:!1,showLogin:!1,showLocation:!1,selectedProduct:null,newOrderId:null}),N=e.useCallback((e={})=>{const{requiresAuth:t=!0,requiresAddress:s=!1,onSuccess:l,onNotAuthenticated:i,onNoAddress:n}=e;return t&&!r?(i?i():w(e=>({...e,showLogin:!0})),!1):s&&!a?.addresses?.length?(n?n():(B.error("يرجى إضافة عنوان التوصيل أولاً"),w(e=>({...e,showLocation:!0}))),!1):(l&&l(),!0)},[r,a?.addresses]),C=e.useCallback(()=>{w(e=>({...e,showProfile:!0}))},[]),S=e.useCallback(()=>{r?N({requiresAuth:!0,requiresAddress:!0,onSuccess:()=>{w(e=>({...e,showOrders:!0}))}}):w(e=>({...e,showLogin:!0}))},[N,r]),P=e.useCallback(()=>{w(r?e=>({...e,showFavorites:!0}):e=>({...e,showLogin:!0}))},[r]),O=e.useCallback(()=>{o(!0)},[o]),j=e.useCallback(e=>{w(t=>({...t,selectedProduct:e}))},[]),I=e.useCallback(e=>{w(t=>({...t,newOrderId:e,showOrders:!0}))},[]),T=e.useCallback(e=>{let t;switch(w(t=>({...t,selectedCategory:e})),m({category:"all"===e?"":e,search:"",minPrice:null,maxPrice:null,size:"",color:""}),h(1),e){case"women":t="حريمي";break;case"men":t="رجالي";break;case"all":t="كل المنتجات";break;default:t=e}B.loading(`جاري تحميل ${t}...`,{id:"category-loading",duration:1e3})},[m,h]),E=e.useCallback(e=>{w(t=>({...t,[e]:!1,..."showOrders"===e?{newOrderId:null}:{}}))},[]);return e.useEffect(()=>{(async()=>{if(t&&c.length>0){const e=c.find(e=>e.code===t);e&&w(t=>({...t,selectedProduct:e}))}})()},[t,c]),Z("div",{className:"min-h-screen bg-white",children:[W(G,{position:"top-center",toastOptions:{className:"bg-white backdrop-blur-xl border border-gray-200 rounded-2xl px-6 py-4 shadow-lg",duration:3e3,style:{color:"#1e293b",fontSize:"14px",fontWeight:"500"}}}),W("header",{children:W($e,{onOrdersClick:S,onProfileClick:C})}),W("nav",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-xl border-b border-gray-200",children:W(it,{selectedCategory:x.selectedCategory,onSelect:T})}),Z("main",{className:"pb-24",children:[W("div",{className:"p-4 pt-2 pb-2",children:W(_e,{slides:g,loading:y,onSelect:j})}),Z("div",{className:"px-6 pt-4 flex items-center justify-between",dir:"rtl",children:[W("h2",{className:"text-lg font-bold text-slate-800",children:"all"===x.selectedCategory?"كل المنتجات":"women"===x.selectedCategory?"منتجات حريمي":"men"===x.selectedCategory?"منتجات رجالي":`منتجات ${x.selectedCategory}`}),c.length>0&&W("div",{className:"text-sm text-slate-600",children:p>1?`${c.length} من ${p*c.length}`:`${c.length} منتج`})]}),d||0!==c.length?W(Xe,{products:c,loading:d,onLoadMore:u,onProductSelect:j,checkAuthAndProceed:N,currentCategory:x.selectedCategory}):Z("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[W("div",{className:"p-4 rounded-full bg-primary-50 mb-4",children:W(k,{className:"w-16 h-16 text-primary-400"})}),W("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"لا توجد منتجات"}),W("p",{className:"text-slate-600 text-center mb-6 max-w-sm",children:"لم نتمكن من العثور على منتجات في هذه الفئة"}),W("button",{onClick:()=>{m({category:"",subcategory:"",search:""}),w(e=>({...e,selectedCategory:"all"}))},className:"btn-primary",children:"عرض كل المنتجات"})]})]}),W(ct,{onFavoritesClick:P,onCartClick:O}),W(lt,{onOrderCreated:I,checkAuthAndProceed:N}),Z(v,{mode:"wait",children:[x.showProfile&&W(Se,{isOpen:!0,onClose:()=>E("showProfile"),onOpenOrders:()=>{E("showProfile"),w(e=>({...e,showOrders:!0}))},onOpenFavorites:()=>{E("showProfile"),w(e=>({...e,showFavorites:!0}))},onOpenLocation:()=>{E("showProfile"),w(e=>({...e,showLocation:!0}))},onOpenLogin:()=>{E("showProfile"),w(e=>({...e,showLogin:!0}))}}),x.selectedProduct&&W(Ue,{product:x.selectedProduct,isOpen:!0,onClose:()=>E("selectedProduct"),checkAuthAndProceed:N}),x.showOrders&&W(We,{onClose:()=>E("showOrders"),initialOrderId:x.newOrderId}),x.showFavorites&&W(Ze,{onClose:()=>E("showFavorites"),onProductSelect:j,checkAuthAndProceed:N}),x.showLogin&&W(Ie,{isOpen:!0,onClose:()=>E("showLogin"),onVerified:async e=>{f(!0);try{await s(e.phone_number)&&w(e=>({...e,showLogin:!1}))}catch(t){throw B.error(t.message||"فشل تسجيل الدخول"),t}finally{f(!1)}},isLoading:b,isLogin:!0}),x.showLocation&&W(je,{isOpen:!0,onClose:()=>E("showLocation"),onUpdate:async e=>{f(!0);try{a?.addresses?.length>0?await l(a.addresses[0].id,{...e,is_default:!0}):await i({...e,is_default:!0}),w(e=>({...e,showLocation:!1})),B.success("تم تحديث العنوان بنجاح")}catch(t){B.error(t.message||"فشل تحديث العنوان")}finally{f(!1)}},initialAddress:a?.addresses?.[0],isLoading:b})]})]})},ut=({productCode:e})=>W(xe,{children:W(ve,{children:W(dt,{productCode:e})})});export{ut as default};
